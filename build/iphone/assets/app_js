function Benchmark(){this.beginTime=new Date}var Alloy=require("alloy"),_=Alloy._,Backbone=Alloy.Backbone,DEBUG=!1;Titanium.App.serverDomain=DEBUG?"192.168.0.188":"atadclub.slavin.biz",Titanium.App.ApiVersion=0,Alloy.Collections.publicAdverts=Alloy.createCollection("publicAdvert"),Alloy.Collections.adverts=Alloy.createCollection("advert"),Alloy.Collections.blackList=Alloy.createCollection("blackList"),Alloy.Collections.publicDeals=Alloy.createCollection("publicDeal"),Alloy.Collections.banners=Alloy.createCollection("banner"),Alloy.Collections.similarDeals=Alloy.createCollection("similarDeal"),Alloy.Collections.homeDeals=Alloy.createCollection("homeDeal"),Alloy.Collections.companyDeals=Alloy.createCollection("companyDeal"),Alloy.Collections.deals=Alloy.createCollection("deal"),Alloy.Collections.products=Alloy.createCollection("product"),Alloy.Collections.companies=Alloy.createCollection("publicCompany"),Alloy.Collections.companiesWithDeals=Alloy.createCollection("companyWithDeals"),Alloy.Collections.offers=Alloy.createCollection("offer"),Alloy.Collections.chats=Alloy.createCollection("chat"),Alloy.Collections.messages=Alloy.createCollection("message"),Alloy.Collections.categories=Alloy.createCollection("category"),Alloy.Collections.subCategories=Alloy.createCollection("subCategory"),Alloy.Collections.supplierProducts=Alloy.createCollection("supplierProducts"),Object.defineProperty(Alloy.Collections.publicDeals.config,"URL",{writable:!1}),Titanium.include("lib/errors.js"),Alloy.Globals.errors=errors,Titanium.include("lib/categories.js"),Titanium.include("lib/subCategories.js"),Titanium.include("lib/geo.js"),Alloy.Globals.geo=geo,Titanium.include("lib/upload.js"),Alloy.Globals.upload=upload,Titanium.include("lib/imageSizes.js"),Alloy.Globals.imageSizes=imageSizes,Titanium.include("lib/checkBox.js"),Alloy.Globals.checkBox=checkBox;var uie=require("lib/indicator");Alloy.Globals.indicator=uie.createIndicatorWindow();var prog=require("lib/progress");Alloy.Globals.progress=prog.createProgressBar(),Titanium.include("lib/store.js"),Alloy.Globals.store=store,Alloy.Globals.Map=require("ti.map"),Ti.Map=require("ti.map"),Alloy.Globals.caches={},Alloy.Globals.LATITUDE_BASE=37.389569,Alloy.Globals.LONGITUDE_BASE=-122.050212,Titanium.include("lib/db.js");var loadingPage=null;Ti.App.addEventListener("pause",function(){Ti.API.info("pause");var e=Ti.App.Properties.getObject("messages");e.push("Paused app, time - "+(new Date).toString()),Ti.App.Properties.setObject("messages",e),Alloy.Globals.core.applicationPaused=!0,Alloy.Globals.chat.connecting=!1,Alloy.Globals.chat.source&&Alloy.Globals.chat.source.close()}),Alloy.Globals.core={debug:DEBUG,createRows:function(e,t,n,r){for(var o=[],a=0;a<e.models.length;a++){var i=e.models[a];o.push(t(i))}for(var s=[],a=0;a<o.length;a++){var u=o[a];s.push(Alloy.createController(r,{model:u}).getView())}n.setData(s)},token:!1,applicationPaused:!1,isSupplier:!1,showHideLoadIndicator:function(){},purchased:{},activeTab:function(e){for(var t=Alloy.Globals.tabGroup.tabs,n=0;n<t.length;n++){var r=t[n];if(r.titleid==e){r.setActive(!0);break}}},offlineModal:!1,createOfflineModal:function(){var e=this;e.offlineModal=Ti.UI.createAlertDialog({message:L("no_connection"),buttonNames:[L("try_again")]}),e.offlineModal.addEventListener("click",function(){Ti.Network.online?e.offlineModal.hide():e.offlineModal.show()})},localTime:function(e){var t=e.getTimezoneOffset(),n=e+t;return n},maxDealRenew:function(e){t=Titanium.Network.createHTTPClient();var t=Ti.Network.createHTTPClient({onload:function(){e(this.responseText)},onerror:function(){Ti.API.info(this.responseText)},timeout:1e4});t.open("GET","http://"+Titanium.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/automaticRenew"),t.send()},createTime:function(e){var t=new Date;return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),parseInt(parseInt(e)/60),parseInt(e)%60))},creatTimeSpan:function(e){return 60*e.getUTCHours()+e.getUTCMinutes()},viewTime:function(e){var t=e.getHours(),n=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),r="AM";return t>=12&&(r="PM",t-=12),t+":"+n+" "+r},currencyItems:[{title:"ILS ₪",data:{id:8362}},{title:"EUR €",data:{id:8364}},{title:"USD $",data:{id:36}},{title:"GBP £",data:{id:163}},{title:"JPY ¥",data:{id:165}},{title:"RUB RUR",data:{id:"RUR"}},{title:"AUD $",data:{id:36}},{title:"CHF Fr",data:{id:"Fr"}},{title:"CAD $",data:{id:36}},{title:"MXN $",data:{id:36}},{title:"CNY ¥",data:{id:165}},{title:"NZD $",data:{id:36}},{title:"SEK kr",data:{id:"kr"}},{title:"HKD $",data:{id:36}},{title:"SGD $",data:{id:36}},{title:"TRY Lr",data:{id:"Lr"}}],appUrl:"http://goo.gl/ul5vRk",dealType:[{title:"1 + 1",id:"0"},{title:"-10%",id:"1"},{title:"-20%",id:"2"},{title:"-25%",id:"3"},{title:"-30%",id:"4"},{title:"-35%",id:"5"},{title:"-40%",id:"6"},{title:"-45%",id:"7"},{title:"-50%",id:"8"},{title:"-55%",id:"9"},{title:"-60%",id:"10"},{title:"-65%",id:"11"},{title:"-70%",id:"12"},{title:"-75%",id:"13"},{title:"-80%",id:"14"},{title:"-85%",id:"15"},{title:"-90%",id:"16"},{title:L("vacancy"),id:"17"}],apiToken:function(e){return void 0==e?GetApiToken():e=SetToken(e)},selectedHomeCategories:{},selectedNewAdvertCategories:{},selectedNewDealsCategories:{},selectedNotificationsCategories:{},selectedCategories:{},selectedProducts:{},selectedCategoriesInEdit:{},currentSection:"",currentSectionCategories:function(){var e=this.currentSection;switch(e){case"home":return this.selectedHomeCategories;case"newadvert":return this.selectedNewAdvertCategories;case"newdealer":return this.selectedNewDealsCategories;case"notifications":return this.selectedNotificationsCategories;case"products":return this.selectedProducts;default:return this.selectedCategoriesInEdit}},categories:categories,subCategories:subCategories,rxs:{email:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,password:/^(?=.*\d)(?=.*[a-zA-Z])[0-9a-zA-Z]{6,}/,empty:/^[\s]*$/,phone:/^\+{0,1}\d{6,11}$/,number:/^[\w]{5,}$/,isUndefined:function(e){return"undefined"==typeof e}},showError:function(e){Alloy.Globals.core.showErrorDialog(L(e.error))},showErrorDialog:function(e){e&&""!==e&&Titanium.UI.createAlertDialog({title:e}).show()},showWaitScreen:function(){},closeWaitScreen:function(){},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){},waitWindow:!1,waitTimeout:!1,showWait:function(){Alloy.Globals.core.waitTimeout||(Alloy.Globals.core.waitTimeout=setTimeout(function(){Alloy.Globals.core.waitWindow||(Alloy.Globals.core.waitWindow=Alloy.createController("activity/index").getView(),Alloy.Globals.core.waitWindow.open())},50))},deviceToken:!1,hideWait:function(){Alloy.Globals.core.waitTimeout&&clearTimeout(Alloy.Globals.core.waitTimeout),Alloy.Globals.core.waitWindow&&(Alloy.Globals.core.waitWindow.close(),Alloy.Globals.core.waitWindow=!1)},DeviceToken:function(){return Ti.Network.online?void Titanium.Network.registerForPushNotifications({types:[Ti.Network.NOTIFICATION_TYPE_ALERT,Ti.Network.NOTIFICATION_TYPE_BADGE,Ti.Network.NOTIFICATION_TYPE_SOUND],success:function(e){return e.deviceToken},error:function(){return null},callback:function(){return null}}):void Alloy.Globals.core.showErrorDialog(L("network_off_line"))}},Alloy.Globals.chat={source:!1,connected:!1,connecting:!1,openChatId:!1,indicator:Alloy.Globals.indicator,items:[],notSendedMessage:!1,messagesWindow:!1,url:function(){return"ws://"+Titanium.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/"+Alloy.Globals.core.apiToken()+"/chat/get"},openConnect:function(){var e=this;return Ti.API.info("Connecting - "+e.connecting),Ti.API.info("Connected - "+e.connected),e.connecting||e.connected?void Ti.API.info("Websocket already connected"):(e.indicator.openIndicator(),e.source=require("net.iamyellow.tiws").createWS(),e.source.addEventListener("message",function(t){e.notSendedMessage&&(e.notSendedMessage=!1),console.log(t.data);var n=JSON.parse(t.data);if(e.openChatId==n.ChatId){var r=e.createRow(n);e.items.push(r),e.messagesWindow.setData(e.items),e.messagesWindow.data[0]&&e.messagesWindow.scrollToIndex(e.messagesWindow.data[0].rows.length-1);var o=Alloy.createModel("counts",{id:n.MessageId});n.FromUserId!==Alloy.Globals.profile.id&&o.save({},{})}else e.notify(n.FromUser,n.Text,n,function(e){var t=Alloy.createController("account/answers/answer",{newChat:!1,id:e.ChatId,toUser:e.FromUserId,UserName:e.FromUser}).getView();Alloy.Globals.tabGroup.activeTab?Alloy.Globals.tabGroup.activeTab.open(t):(Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount),Alloy.Globals.tabGroup.activeTab.open(t))})},!1),e.source.addEventListener("open",function(){console.log("open!"),e.connected=!0,e.connecting=!1,e.indicator.closeIndicator(),e.notSendedMessage&&e.source.send(e.notSendedMessage)}),e.source.addEventListener("close",function(){console.log("close!"),e.connected=!1,e.connecting=!1,e.indicator.closeIndicator()}),e.source.addEventListener("error",function(t){"error"==t.type,console.log("error"),e.indicator.closeIndicator(),e.connected=!1,e.connecting=!1}),Ti.API.info(e.url()),e.connecting=!0,void e.source.open(e.url()))},notify:function(e,t,n,r){function o(){d.close({transform:s,duration:l})}if(t){var a=Titanium.UI.create2DMatrix().translate(0,-60),i=Titanium.UI.create2DMatrix().translate(0,0),s=Titanium.UI.create2DMatrix().translate(0,-60),u=Titanium.UI.createAnimation(),l=200,c=5e3,d=Titanium.UI.createWindow({layout:"absolute",height:50,width:320,top:0,backgroundColor:"#f0f0f0",transform:a});u.transform=i,u.duration=l;var h=Titanium.UI.createLabel({text:e,height:20,width:280,top:5,left:10,color:"#555",font:{fontSize:"16dp",fontFamily:"Avenir Next Condensed",fontWeight:"Bold"}}),f=Titanium.UI.createLabel({text:t,height:20,width:280,top:25,left:10,color:"#555",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed",fontWeight:"Regular"}}),m=Titanium.UI.createView({height:1,width:320,top:49,left:0,backgroundColor:"#999"}),p=Titanium.UI.createButton({id:"closeBtn",title:"x",height:30,width:30,top:0,right:0,style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,color:"#555",font:{fontSize:"16dp"}});setTimeout(o,c),d.addEventListener("click",function(e){"closeBtn"!=e.source.id&&r&&(r(n),d.close())}),p.addEventListener("click",o),d.add(h),d.add(f),d.add(m),d.add(p),d.open(u)}},addMessage:function(e){for(var t=this,n=0;n<e.length;n++){var r=e[n],o=t.createRow(r);t.items.splice(0,0,o)}return t.items},createRow:function(e){var t=Ti.UI.createTableViewRow({layout:"absolute",height:Ti.UI.SIZE,bottom:"5dp",selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE}),n=Ti.UI.createImageView({id:"arrow",width:"10dp",heigth:"10dp",bottom:"2dp",font:{fontSize:"1dp"}});t.add(n);var r=Ti.UI.createView({width:"200dp",height:Ti.UI.SIZE,layout:"vertical"}),o=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,borderRadius:"15dp",borderWidth:"1dp",layout:"vertical"}),a=Ti.UI.createLabel({right:"7dp"}),i=Ti.UI.createLabel({text:e.Text,height:Ti.UI.SIZE,left:"7dp",top:"5dp",bottom:"5dp",font:{fontSize:"14dp"}}),s=Ti.UI.createLabel({visible:!1,width:"10dp",heigth:"10dp",bottom:"3dp",font:{fontSize:"1dp"}});return e.FromUserId==Alloy.Globals.profile.id?(r.right="12dp",o.backgroundColor="#007aff",o.borderColor="#007aff",o.right="0dp",i.color="#fff",n.image="images/messageOut.png",n.right="8dp"):(r.left="12dp",o.backgroundColor="#e7e4eb",o.borderColor="#e7e4eb",o.left="0dp",i.color="#1b1b1b",n.image="images/messageIn.png",n.left="8dp"),a.add(i),o.add(a),r.add(o),t.add(r),t.add(s),t}},Alloy.Globals.core.installId=Ti.App.installId;var stylesArray;Alloy.Globals.isHe=!1,"he"===Titanium.Platform.locale?(Alloy.Globals.isHe=!0,Titanium.include("lib/stylesRtl.js"),Alloy.Globals.Styles=stylesRtl):(Titanium.include("lib/styles.js"),Alloy.Globals.Styles=styles),Alloy.Globals.isHebrew="he"!=Ti.Platform.locale,Object.size=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},Benchmark.prototype={test:function(){return(new Date).getTime()-this.beginTime.getTime()}},Ti.App.addEventListener("addWindow",function(e,t){Ti.API.info("addWindow"),void 0===Alloy.Globals.tabs.tabs[e]&&(Alloy.Globals.tabs.tabs[e]=e);var n=Alloy.Globals.tabs.tabs[e];void 0===n.windows&&(n.windows=new Array),n.push(t)}),Ti.App.addEventListener("removeWindows",function(e){Ti.API.info("removeWindow");for(var t=0;t<Alloy.Globals.tabs.tabs[e].windows.length;t++){var n=Alloy.Globals.tabs.tabs[e].windows[t];n.close()}Alloy.Globals.tabs.tabs[e].windows=new Array}),Alloy.Globals.tabs={tabs:{}},Alloy.Globals.notifications={notifySettings:!1,startTimer:function(e){var t=this;Ti.API.info("Create notification geoposiotion timer"),t.timer=setInterval(function(){if(Ti.API.info("Start notification geoposiotion timer"),Alloy.Globals.core.applicationPaused&&Alloy.Globals.chat.connected&&Alloy.Globals.chat.source.close(),t.notifySettings){var e=Alloy.Globals.geo;Ti.API.info("Check position"),e.checkLocation(function(){if(e.location.status!=e.errors.NONE)return Alloy.Globals.core.showErrorDialog(L(e.location.status.message)),void Ti.API.info(e.location.status.message);Ti.API.info("lat="+e.location.latitude+", lng="+e.location.longitude+", notifySettings"+t.notifySettings);var n=Alloy.createModel("tracking",{id:t.notifySettings.id,lat:e.location.latitude,lng:e.location.longitude,offset:(new Date).getTimezoneOffset()});n.save({},{success:function(){Ti.API.info("Coordinates saved - "+(new Date).toLocaleString())},error:function(){Ti.API.info("error")}})})}else Ti.API.info("NotifySettings - "+t.notifySettings)},1e3*e)},stopTimer:function(){var e=this;clearInterval(e.timer),e.timer=!1,e.notifySettings=!1,Ti.API.info("Stop geoposition timer")},timer:!1},Ti.App.Properties.setInt("warmgps",0),Alloy.Globals.locations={updateLocation:function(e){Ti.API.info("enter update location"),Ti.API.info(JSON.stringify(e));var t=Ti.App.Properties.getObject("messages");if(t.push("Method - location; time - "+(new Date).toString()),!Ti.Network.online)return t.push("Network offline; time - "+(new Date).toString()),void Ti.App.Properties.setObject("messages",t);if(Ti.API.info(Ti.Geolocation.accuracy),Ti.API.info(Ti.Geolocation.distanceFilter),Ti.Geolocation.accuracy!=Titanium.Geolocation.ACCURACY_BEST&&10!=Ti.Geolocation.distanceFilter&&(Ti.Geolocation.accuracy=Titanium.Geolocation.ACCURACY_BEST,Ti.Geolocation.distanceFilter=10),e&&e.coords&&e.coords.latitude&&e.coords.longitude){var n=Ti.App.Properties.getInt("count");Ti.API.info("location");var r=e.coords.latitude,o=e.coords.longitude;n++,t.push("Lat - "+r+"; Lng - "+o+"; Count - "+n+"; time - "+(new Date).toString()),n>=5&&(Alloy.Globals.locations.send(r,o,!1,t),Ti.App.Properties.setInt("count",0)),Ti.App.Properties.setObject("messages",t),Ti.App.Properties.setInt("count",n)}else t.push("No coords;"+JSON.stringify(e)+" time - "+(new Date).toString()),e.error&&t.push("Error coords;"+JSON.stringify(e.error)+" time - "+(new Date).toString()),Ti.App.Properties.setObject("messages",t)},send:function(e,t,n,r){var o=Ti.App.Properties.getString("token");if(o){var a=Ti.Network.createHTTPClient({timeout:6e4}),i="http://"+Ti.App.serverDomain+"/api/0/tracking/Get?token="+o+"&lat="+e+"&lng="+t+"&offset="+(new Date).getTimezoneOffset();r.push("url - "+i+"; time - "+(new Date).toString()),a.onload=function(e){r.push("Location saved; time - "+(new Date).toString()),e.success&&(Ti.App.Properties.setInt("count",0),Ti.API.info("Coords saved!!!")),Ti.App.Properties.setObject("messages",r)},a.onerror=function(e){r.push("Save error;Text - "+JSON.stringify(e)+" time - "+(new Date).toString()),Ti.App.Properties.setObject("messages",r),Ti.API.error(e),Ti.API.error(e.error),Ti.App.Properties.setInt("count",0)},Ti.API.info(i),a.open("GET",i,n),a.send(),r.push("Sended location to server; async - "+n+"; time - "+(new Date).toString()),Ti.App.Properties.setObject("messages",r),Ti.API.info("send")}}},Alloy.Globals.messages=[],Ti.App.Properties.setObject("messages",Alloy.Globals.messages),Alloy.createController("index");