function location(t){var l=Ti.App.Properties.getObject("messages");if(l.push("Method - location; time - "+(new Date).toString()),!Ti.Network.online)return l.push("Network offline; time - "+(new Date).toString()),void Ti.App.Properties.setObject("messages",l);if(t&&t.coords&&t.coords.latitude&&t.coords.longitude){Ti.API.info(JSON.stringify(t));var e=Ti.App.Properties.getInt("count");Ti.API.info("location");var o=t.coords.latitude,i=t.coords.longitude;e++,l.push("Lat - "+o+"; Lng - "+i+"; Count - "+e+"; time - "+(new Date).toString()),e>=2&&(parseInt(Ti.Platform.version.split(".")[0])>=8?send(o,i,!1,l):send(o,i,!1,l),Ti.App.Properties.setInt("count",0)),Ti.App.Properties.setInt("count",e),Ti.App.Properties.setObject("messages",l),reloadLocationManager()}else l.push("No coords; time - "+(new Date).toString()),Ti.App.Properties.setObject("messages",l),Ti.API.info("unsubscribe"),reloadLocationManager()}function reloadLocationManager(){}function send(t,l,e,o){var i=Ti.Network.createHTTPClient({timeout:6e4}),s=Ti.App.Properties.getString("token");Ti.API.info(s);var r="http://"+Ti.App.serverDomain+"/api/0/tracking/Get?token="+s+"&lat="+t+"&lng="+l+"&offset="+(new Date).getTimezoneOffset();o.push("url - "+r+"; time - "+(new Date).toString()),i.onload=function(t){o.push("Location saved; time - "+(new Date).toString()),t.success&&(Ti.App.Properties.setInt("count",0),Ti.API.info("Coords saved!!!")),Ti.App.Properties.setObject("messages",o)},i.onerror=function(t){o.push("Save error;Text - "+JSON.stringify(t)+" time - "+(new Date).toString()),Ti.App.Properties.setObject("messages",o),Ti.API.error(t),Ti.API.error(t.source),Ti.App.Properties.setInt("count",0)},Ti.API.info(r),i.open("GET",r,e),i.send(),o.push("Sended location to server; async - "+e+"; time - "+(new Date).toString()),Ti.App.Properties.setObject("messages",o),Ti.API.info("send")}Ti.App.currentService.addEventListener("stop",function(){Ti.Geolocation.removeEventListener("location",location)}),Ti.Geolocation.addEventListener("location",location);