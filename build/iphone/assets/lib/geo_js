var geo={xhr:Ti.Network.createHTTPClient({timeout:2e4}),responseStatuses:{OK:"OK",INVALID_REQUEST:"INVALID_REQUEST",MAX_ELEMENTS_EXCEEDED:"MAX_ELEMENTS_EXCEEDED",OVER_QUERY_LIMIT:"OVER_QUERY_LIMIT",REQUEST_DENIED:"REQUEST_DENIED",UNKNOWN_ERROR:"UNKNOWN_ERROR"},elementStatuses:{OK:"OK",NOT_FOUND:"NOT_FOUND",ZERO_RESULTS:"ZERO_RESULTS"},errors:{NONE:{error:0,message:""},XHR_ERROR:{error:-1,message:"xhr_error"},JSON_ERROR:{error:-2,message:"json_error"},LOCATION_SERVICES_DISABLED:{error:-3,message:"err_geo_device_turned_off"},AUTHORIZATION_DENIED:{error:-4,message:"err_geo_running_services_disallowed"},AUTHORIZATION_RESTRICTED:{error:-5,message:"err_geo_system_services_disallowed"},ERROR_LOCATION_UNKNOWN:{error:-6,message:"err_geo_location_unknown"},ERROR_DENIED:{error:-7,message:"err_geo_access_denied"},ERROR_NETWORK:{error:-8,message:"err_geo_network_error"},ERROR_HEADING_FAILURE:{error:-9,message:"err_geo_failure_detect_heading"},ERROR_REGION_MONITORING_DENIED:{error:-10,message:"err_geo_region_monitoring_access_denied"},ERROR_REGION_MONITORING_FAILURE:{error:-11,message:"err_geo_region_monitoring_access_failure"},ERROR_REGION_MONITORING_DELAYED:{error:-12,message:"err_geo_region_monitoring_setup_delayed"},ERROR_UNKNOWN:{error:-13,message:"err_geo_region_monitoring_setup_delayed"}},location:{longitude:null,latitude:null,altitude:null,heading:null,accuracy:null,speed:null,timestamp:null,altitudeAccuracy:null,status:null},checkLocation:function(t){if(Ti.Geolocation.preferredProvider=Titanium.Geolocation.PROVIDER_GPS,Ti.Geolocation.purpose=L("geolocation_purpose"),!1===Titanium.Geolocation.locationServicesEnabled)return this.location.status=this.errors.LOCATION_SERVICES_DISABLED,void t();var l=Titanium.Geolocation.locationServicesAuthorization;if(l==Titanium.Geolocation.AUTHORIZATION_DENIED)return this.location.status=this.errors.AUTHORIZATION_DENIED,void t();if(l==Titanium.Geolocation.AUTHORIZATION_RESTRICTED)return this.location.status=this.errors.AUTHORIZATION_RESTRICTED,void t();Titanium.Geolocation.accuracy=Titanium.Geolocation.ACCURACY_BEST,Titanium.Geolocation.distanceFilter=50;var e=this;e.callback=t,Titanium.Geolocation.getCurrentPosition(function(t){if(!t.success||t.error){switch(t.code){case Ti.Geolocation.ERROR_LOCATION_UNKNOWN:e.location.status=e.errors.ERROR_LOCATION_UNKNOWN;break;case Ti.Geolocation.ERROR_DENIED:e.location.status=e.errors.ERROR_DENIED;break;case Ti.Geolocation.ERROR_NETWORK:e.location.status=e.errors.ERROR_NETWORK;break;case Ti.Geolocation.ERROR_HEADING_FAILURE:e.location.status=e.errors.ERROR_HEADING_FAILURE;break;case Ti.Geolocation.ERROR_REGION_MONITORING_DENIED:e.location.status=e.errors.ERROR_REGION_MONITORING_DENIED;break;case Ti.Geolocation.ERROR_REGION_MONITORING_FAILURE:e.location.status=e.errors.ERROR_REGION_MONITORING_FAILURE;break;case Ti.Geolocation.ERROR_REGION_MONITORING_DELAYED:e.location.status=e.errors.ERROR_REGION_MONITORING_DELAYED;break;default:e.location.status=e.errors.ERROR_UNKNOWN}return void e.callback()}e.location.longitude=t.coords.longitude,e.location.latitude=t.coords.latitude,e.location.altitude=t.coords.altitude,e.location.heading=t.coords.heading,e.location.accuracy=t.coords.accuracy,e.location.speed=t.coords.speed,e.location.timestamp=t.coords.timestamp,e.location.altitudeAccuracy=t.coords.altitudeAccuracy,e.location.status=e.errors.NONE,e.callback()})},geocoding:function(t,l){t=t.replace(" ","+"),t=Ti.Network.encodeURIComponent(t);var e="http://maps.googleapis.com/maps/api/geocode/json?sensor=true&address="+t+"&language="+Titanium.Locale.getCurrentLanguage();Ti.API.info(e);var o=this;o.callback=l,o.url=e,this.xhr.onload=function(){this.responseText;var t;try{t=JSON.parse(this.responseText)}catch(e){o.callback({error:o.errors.JSON_ERROR})}t.status!=o.responseStatuses.OK?l({error:t.status}):o.callback({error:!1,response:t})},this.xhr.onerror=function(){o.callback(o.errors.XHR_ERROR)};try{this.xhr.open("GET",e,!0),this.xhr.send()}catch(i){o.callback({error:o.errors.XHR_ERROR})}},reverseGeocoding:function(t,l,e,o){var i="http://maps.googleapis.com/maps/api/geocode/json?sensor=true&latlng="+t+","+l+"&language="+Titanium.Locale.getCurrentLanguage();o&&(i="http://dev.virtualearth.net/REST/v1/Locations/"+t+","+l+"?o=json&c="+Titanium.Locale.getCurrentLanguage()+"&key=AsVfU_xKdVN8M9muQCO-VMcGSuFSoX4PO-30i38RHIAk5Tr-IDWZ5GHtzZJVD7l5");var s=this;s.callback=e,s.url=i,this.xhr.onload=function(){this.responseText;var o;try{o=JSON.parse(this.responseText)}catch(i){s.callback({error:s.errors.JSON_ERROR})}o&&o.status&&o.status!=s.responseStatuses.OK?o.status===s.elementStatuses.ZERO_RESULTS||o.status===s.responseStatuses.OVER_QUERY_LIMIT?geo.reverseGeocoding(t,l,e,!0):e({error:o.status}):s.callback({error:!1,response:o})},this.xhr.onerror=function(){s.callback(s.errors.XHR_ERROR)};try{this.xhr.open("GET",i,!0),this.xhr.send()}catch(r){s.callback({error:s.errors.XHR_ERROR})}}};