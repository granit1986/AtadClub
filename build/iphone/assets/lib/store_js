var store={selectedProduct:{name:"",buy:!1,error:!1},statusCode:0,priceText:0,purchaseCompleteCallback:!1,indicator:Alloy.Globals.indicator,Storekit:!1,verifyingReceipts:!1,requestProduct:function(t,l){store.indicator.openIndicator(),store.Storekit.requestProducts([t],function(t){store.indicator.closeIndicator(),t.success?t.invalid?Alloy.Globals.core.showErrorDialog("ERROR: We requested an invalid product!"):l(t.products[0]):Alloy.Globals.core.showErrorDialog("ERROR: We failed to talk to Apple!")})},create:function(){function t(){var t=Titanium.Platform.version.split("."),l=parseInt(t[0],10);return l>=7?!0:!1}function l(t){Ti.API.info("Marking as purchased: "+t),Alloy.Globals.core.purchased[t]=!0}var e=this;e.purchaseCompleteCallback=!1,e.Storekit=require("ti.storekit");var o=t();e.Storekit.addEventListener("transactionState",function(t){switch(e.indicator.closeIndicator(),t.state){case e.Storekit.TRANSACTION_STATE_FAILED:e.selectedProduct.error||(e.selectedProduct.error=!0,Alloy.Globals.core.showErrorDialog(t.cancelled?"Purchase cancelled":"ERROR: Buying failed! "+t.message),t.transaction&&t.transaction.finish());break;case e.Storekit.TRANSACTION_STATE_PURCHASED:if(e.verifyingReceipts)if(o){var i=e.Storekit.validateReceipt()?"Receipt is Valid!":"Receipt is Invalid.";Alloy.Globals.core.showErrorDialog(i)}else e.Storekit.verifyReceipt(t,function(e){e.success?e.valid?(Alloy.Globals.core.showErrorDialog("Thanks! Receipt Verified"),l(t.productIdentifier)):Alloy.Globals.core.showErrorDialog("Sorry. Receipt is invalid"):Alloy.Globals.core.showErrorDialog(e.message)});else(e.selectedProduct.name=t.productIdentifier&&0==e.selectedProduct.buy)?(e.selectedProduct.buy=!0,l(t.productIdentifier),e.purchaseCompleteCallback&&e.purchaseCompleteCallback(),t.transaction&&t.transaction.finish()):t.transaction&&t.transaction.finish();t.downloads?e.Storekit.startDownloads({downloads:t.downloads}):t.transaction&&t.transaction.finish();break;case e.Storekit.TRANSACTION_STATE_PURCHASING:Ti.API.info("Purchasing "+t.productIdentifier);break;case e.Storekit.TRANSACTION_STATE_RESTORED:Ti.API.info("Restored "+t.productIdentifier),t.downloads&&Ti.API.info("Downloads available for restored product"),t.transaction&&t.transaction.finish()}}),e.Storekit.addTransactionObserver()}};