function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(e){e.source.id!==y.description.id&&y.description.blur()}function t(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBgOnTap}function l(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBg,"changeImage"==e.source.id?o():"sendOffer"==e.source.id?d():"deleteImage"==e.source.id&&n()}function o(){m.show()}function i(){Titanium.Media.openPhotoGallery({success:function(e){e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO&&a(e)}})}function s(){Titanium.Media.showCamera({success:function(e){e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO&&a(e)},cancel:function(){},error:function(){}})}function a(e){y.images.children.length>1&&y.images.remove(y.images.children[0]),h=e.media,y.imageView.image=h,y.imageView.height=Ti.UI.SIZE,y.imageView.bottom="10dp",y.imageView.visible=!0;var t=Ti.UI.createImageView({image:h,width:"55dp",height:"55dp",right:"5dp",bottom:"5dp"}),l=y.addPhoto;y.images.remove(y.addPhoto),y.images.add(t),y.images.add(l),g=!0,y.howToDeleteImageLbl.visible=!0}function r(e){"[object TiUIImageView]"===e.source.toString()&&(y.imageView.image=null,y.images.remove(e.source),y.imageView.height=0,y.imageView.bottom=0,y.howToDeleteImageLbl.visible=!1)}function n(){h=!1,g=!1,y.imageView.image=null,y.imageView.visible=!1,y.imageView.height="0",y.imageView.bottom="0",y.deleteImage.visible=!1}function d(){var e=Alloy.createModel("offer",{advertId:f.id,description:y.description.value});return Alloy.Globals.core.rxs.empty.test(e.attributes.description)?void u(errors.NO_DESCRIPTION):h?void e.save({},{success:function(e,t){if(h&&g){var l=Alloy.Globals.upload,o=[],i=1,s=400,a=h.height,r=h.width,n=Ti.UI.createImageView({image:h,width:r,height:a});a>r?(i=r/a,n.height=s,n.width=s*i):(i=a/r,n.width=s,n.height=s*i),h=n.toImage(),o.push(h),v.openBar(),l.start({type:l.types.barter,id:t,blobs:o,onerror:function(){Alloy.Globals.core.showErrorDialog(L("error_loading_image")),v.closeBar()},onload:function(){v.setBarValue(1),v.closeBar(),c()},onsendstream:function(e){v.setBarValue(e.progress),Ti.API.info("progress - "+e.progress)}})}else c();A.closeIndicator()},error:function(e,t){if(A.closeIndicator(),t&&t.Message){var l=Titanium.UI.createAlertDialog({title:L("upgrade_membership"),message:L(t.Message),buttonNames:[L("upgrade"),L("OK")]});l.addEventListener("click",function(e){if(!e.index){var t=Alloy.createController("account/upgradeSelect").getView();Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount),Alloy.Globals.tabGroup.activeTab.open(t)}}),l.show()}}}):void u(errors.NO_IMAGE)}function c(){Alloy.Globals.core.showErrorDialog(L("offer_sent")),y.window.close()}function u(e){switch(e){case errors.NO_DESCRIPTION:y.description.focus();break;case errors.NO_IMAGE:}var t=Ti.UI.createAlertDialog({title:L(e.error)});t.addEventListener("click",function(){y.scrollView.setContentOffset({x:0,y:0})}),t.show(),y.scrollView.setContentOffset({x:0,y:0})}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home/adverts/barterOffer",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var y=this,p={},b={};y.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"vertical",id:"window",fullscreen:"true",titleid:"my_barter_offer"}),y.__views.window&&y.addTopLevelView(y.__views.window),e?y.__views.window.addEventListener("click",e):b["$.__views.window!click!blur"]=!0,y.__views.scrollView=Ti.UI.createScrollView({layout:"vertical",left:"20dp",right:"20dp",id:"scrollView",scrollType:"vertical",contentWidth:"100%"}),y.__views.window.add(y.__views.scrollView),y.__views.__alloyId206=Ti.UI.createLabel({height:"80dp",width:Ti.UI.FILL,textAlign:"center",color:Alloy.Globals.Styles.titleColor,font:{fontSize:"25dp",fontFamily:"OleoScriptSwashCaps-Regular"},text:"Make your Barter offer",id:"__alloyId206"}),y.__views.scrollView.add(y.__views.__alloyId206),y.__views.descriptionLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"descriptionLbl",textid:"description"}),y.__views.scrollView.add(y.__views.descriptionLbl),y.__views.description=Ti.UI.createTextArea(function(){var e={};return Alloy.Globals.isHe&&_.extend(e,{textAlign:"right"}),_.extend(e,{width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputAreaHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"description"}),e}()),y.__views.scrollView.add(y.__views.description),y.__views.imageLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},top:"10dp",id:"imageLbl",textid:"picture"}),y.__views.scrollView.add(y.__views.imageLbl),y.__views.imageView=Ti.UI.createImageView({width:Alloy.Globals.Styles.inputWidth,bottom:"0",top:Alloy.Globals.Styles.inputUp,left:Alloy.Globals.Styles.inputLeft,id:"imageView",height:"0",visible:"false"}),y.__views.scrollView.add(y.__views.imageView),y.__views.__alloyId207=Ti.UI.createView({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"0dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",id:"__alloyId207"}),y.__views.scrollView.add(y.__views.__alloyId207),y.__views.images=Ti.UI.createView({height:Ti.UI.SIZE,top:"5dp",left:"5dp",id:"images",layout:"horizontal"}),y.__views.__alloyId207.add(y.__views.images),r?y.__views.images.addEventListener("click",r):b["$.__views.images!click!onClickImage"]=!0,y.__views.addPhoto=Ti.UI.createButton({width:"56dp",height:"56dp",right:"5dp",bottom:"5dp",backgroundColor:Alloy.Globals.Styles.buttonBg,backgroundImage:"images/icon_gallery.png",id:"addPhoto"}),y.__views.images.add(y.__views.addPhoto),o?y.__views.addPhoto.addEventListener("click",o):b["$.__views.addPhoto!click!addPhoto"]=!0,y.__views.howToDeleteImageLbl=Ti.UI.createLabel({width:Ti.UI.FILL,height:"20dp",bottom:"10dp",textAlign:Alloy.Globals.Styles.imageSelectTipTextAlign,font:{fontFamily:"Avenir Next Condensed",fontSize:"12dp"},color:"#555",id:"howToDeleteImageLbl",textid:"tap_to_delete_image",visible:"false"}),y.__views.scrollView.add(y.__views.howToDeleteImageLbl),y.__views.__alloyId208=Ti.UI.createView({height:"20dp",width:Ti.UI.FILL,id:"__alloyId208"}),y.__views.scrollView.add(y.__views.__alloyId208),y.__views.sendOffer=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"sendOffer",titleid:"send"}),y.__views.scrollView.add(y.__views.sendOffer),t?y.__views.sendOffer.addEventListener("touchstart",t):b["$.__views.sendOffer!touchstart!buttonTouchStart"]=!0,l?y.__views.sendOffer.addEventListener("touchend",l):b["$.__views.sendOffer!touchend!buttonTouchEnd"]=!0,p.destroy=function(){},_.extend(y,y.__views);var h=!1,g=!1,w={options:["Make Photo","Choose Photo","Cancel"],cancel:2},f=Alloy.Collections.publicAdverts.where({id:arguments[0].advertId})[0].toJSON(),v=Alloy.Globals.progress,A=Alloy.Globals.indicator,m=Titanium.UI.createOptionDialog(w);m.addEventListener("click",function(e){0==e.index&&s(),1==e.index&&i()}),b["$.__views.window!click!blur"]&&y.__views.window.addEventListener("click",e),b["$.__views.images!click!onClickImage"]&&y.__views.images.addEventListener("click",r),b["$.__views.addPhoto!click!addPhoto"]&&y.__views.addPhoto.addEventListener("click",o),b["$.__views.sendOffer!touchstart!buttonTouchStart"]&&y.__views.sendOffer.addEventListener("touchstart",t),b["$.__views.sendOffer!touchend!buttonTouchEnd"]&&y.__views.sendOffer.addEventListener("touchend",l),_.extend(y,p)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;