function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(){V.openIndicator();var e=Alloy.createController("categories/index",{closeCallback:function(){x=[];var e=!1;if(G.selectedHomeCategories._1)for(var t in G.selectedHomeCategories._1)e||(e=!0,k=!0),x.push(G.selectedHomeCategories._1[t]);if(!e){k=!1;for(var l in G.selectedHomeCategories){var o=G.selectedHomeCategories[l];for(var t in o)x.push(o[t])}}I.selectedCategories.text="";for(var l in G.selectedHomeCategories)if(Object.size(G.selectedHomeCategories[l])>0){l=l.replace("_","");var o=Alloy.Collections.categories.get(l);I.selectedCategories.text+=""==I.selectedCategories.text?o.attributes.name:", "+o.attributes.name}},win:Alloy.CFG.tabHome,forDeals:!1,sectionName:"home",withblock:!0}).getView();V.closeIndicator(),Alloy.CFG.tabHome.open(e)}function t(e){switch(e){case 100:I.scrollView.contentOffset={x:0,y:0};break;case 250:I.scrollView.contentOffset={x:65,y:0};break;case 500:I.scrollView.contentOffset={x:130,y:0};break;case 750:I.scrollView.contentOffset={x:195,y:0};break;case 1e3:I.scrollView.contentOffset={x:260,y:0};break;case 2e3:I.scrollView.contentOffset={x:325,y:0}}}function l(){return G.rxs.empty.test(I.address.value)?(V.closeIndicator(),void Alloy.Globals.core.showErrorDialog(L("no_address"))):G.rxs.empty.test(x)?(V.closeIndicator(),void Alloy.Globals.core.showErrorDialog(L("please_select_category"))):void(U&&N&&I.address.value===E||geo.geocoding(I.address.value,function(e){if(e.error==geo.elementStatuses.ZERO_RESULTS||e.error==geo.elementStatuses.NOT_FOUND)return V.closeIndicator(),void Alloy.Globals.core.showErrorDialog(L("address_not_found"));if(e.error)return Alloy.Globals.core.showErrorDialog(L(e.message)),void(I.findBtn.touchEnabled=!0);if(U=parseFloat(e.response.results[0].geometry.location.lat),N=parseFloat(e.response.results[0].geometry.location.lng),Ti.App.lat=U,Ti.App.lng=N,k){var t=Alloy.createController("home/adverts/index",{lat:U,lng:N,distance:F,subCategories:x}).getView();V.closeIndicator(),t.backButtonTitle=L("back"),Alloy.CFG.tabHome.open(t)}else{var l=Alloy.createController("home/deals/index",{lat:U,lng:N,distance:F,subCategories:x}).getView();V.closeIndicator(),l.backButtonTitle=L("back"),Alloy.CFG.tabHome.open(l)}}))}function o(){var e=Alloy.Globals.geo;e.checkLocation(function(){return e.location.status!=e.errors.NONE?(Alloy.Globals.core.showErrorDialog(L(e.location.status.message)),void V.closeIndicator()):(U=e.location.lat,N=e.location.lng,void e.reverseGeocoding(e.location.latitude,e.location.longitude,function(e){V.closeIndicator(),e&&e.error?Alloy.Globals.core.showErrorDialog(L(e.message?e.message:e.error)):e&&e.response&&(e.response.results&&e.response.results[0]&&e.response.results[0].formatted_address?I.address.value=e.response.results[0].formatted_address:e.response.resourceSets&&e.response.resourceSets[0]&&e.response.resourceSets[0].resources&&e.response.resourceSets[0].resources[0]&&e.response.resourceSets[0].resources[0].address&&e.response.resourceSets[0].resources[0].address.formattedAddress&&(I.address.value=e.response.resourceSets[0].resources[0].address.formattedAddress))}))})}function i(){var e=Alloy.Globals.geo;e.checkLocation(function(){return e.location.status!=e.errors.NONE?(Alloy.Globals.core.showErrorDialog(L(e.location.status.message)),void V.closeIndicator()):(U=e.location.latitude,N=e.location.longitude,V.openIndicator(),void Alloy.Collections.banners.fetch({data:{lat:U,lng:N},success:function(){function e(){t.close()}var t=Titanium.UI.createWindow({layout:"absolute",height:Ti.UI.FILL,width:Ti.UI.FILL,top:10,left:10,right:10,bottom:10,backgroundColor:"#f0f0f0",zIndex:1}),l=Titanium.UI.createButton({id:"closeBtn",title:"x",height:30,width:30,top:0,right:0,backgroundColor:Alloy.Globals.Styles.buttonBg,color:"#fff",zIndex:10}),o=Ti.UI.createImageView({zIndex:5,image:"http://"+Ti.App.serverDomain+"/images/"+arguments[1]});l.addEventListener("click",e),setTimeout(function(){t.add(l)},5e3),t.add(o),t.open()},error:function(){}}))})}function a(e){var t=e.toJSON();return t.price=t.currency+" "+t.price,t.distance=parseFloat(t.distance).toFixed(2)+" km",t.myLat=U,t.myLng=N,t.dealtype=Alloy.Globals.core.dealType[t.dealtype].title,t.endTime&&(t.endTime=Alloy.Globals.core.viewTime(Alloy.Globals.core.createTime(t.endTime))),t.images=t.images&&t.images.length>0?JSON.parse(t.images):[],t.images.length>0&&(t.image="http://"+Ti.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/image/"+t.images[0]+Alloy.Globals.imageSizes.deal.row()),P++,t}function s(e){Ti.App.Properties.setString("token",e.deviceToken),Alloy.Globals.core.deviceToken=e.deviceToken,Ti.API.info("Token - "+e.deviceToken);var t=Ti.App.Properties.getObject("messages");t.push("Register location service, time - "+(new Date).toString()),Ti.App.Properties.setObject("messages",t),Ti.Geolocation.addEventListener("location",Alloy.Globals.locations.updateLocation),i(),n(e.deviceToken)}function r(e){if(Ti.API.error(e),V.closeIndicator(),"Simulator"==Ti.Platform.model||"google_sdk"===Ti.Platform.model){var t="fake_device_ token";n(t)}}function n(e){V.openIndicator(),Alloy.Collections.categories.fetch({data:{lng:Ti.Platform.locale},cache:{name:"categories",validMinutes:60},success:function(){d(e)},error:function(){n(e),V.closeIndicator()}})}function d(e){V.openIndicator(),Alloy.Collections.subCategories.fetch({data:{lng:Ti.Platform.locale},cache:{name:"subCategories",validMinutes:60},success:function(){c(e)},error:function(){d(e),V.closeIndicator()}})}function c(e){V.openIndicator();var t=Alloy.createModel("notify");t.fetch({data:{deviceToken:e,appInstallId:Alloy.Globals.core.installId,appVersion:Ti.App.version,platformModel:Ti.Platform.model,platformVersion:Ti.Platform.version,platformOSName:Ti.Platform.osname,language:Ti.Locale.currentLanguage,lat:U,lng:N,offset:(new Date).getTimezoneOffset()},success:function(){t=t.toJSON(),Alloy.Globals.notify={id:t.id,subCategories:t.subcategories,period:t.period,for_:t.for_,from:t.from,to:t.to,deviceToken:t.devicetoken,lat:t.lat,lng:t.lng,distance:t.distance},Ti.App.fireEvent("notify:notifyload"),V.closeIndicator()},error:function(){c(e),V.closeIndicator()}})}function u(e){var t=!1,l=e.inBackground;if(e=e.data,Alloy.Globals.core.applicationPaused&&e.newChatMessage&&l){var o=JSON.parse(e.newChatMessage);o[1]!=Alloy.Globals.chat.openChatId&&(t=Alloy.createController("account/answers/answer",{newChat:!1,id:o[1],toUser:o[2],UserName:o[4]}).getView())}else if(e.newChatMessage&&!l){Ti.API.info("Connected - "+Alloy.Globals.chat.connected);var o=JSON.parse(e.newChatMessage);if(!Alloy.Globals.chat.connected)if(o[1]!=Alloy.Globals.chat.openChatId)Alloy.Globals.chat.notify(L("chat"),L("new_message"),o,function(e){t=Alloy.createController("account/answers/answer",{newChat:!1,id:e[1],toUser:e[2],UserName:e[4]}).getView(),Alloy.Globals.tabGroup.activeTab?Alloy.Globals.tabGroup.activeTab.open(t):(Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount),Alloy.Globals.tabGroup.activeTab.open(t))});else{V.openIndicator();var i=Alloy.createCollection("message");i.fetch({data:{chatId:Alloy.Globals.chat.openChatId,offset:0,length:10},success:function(e,t){Alloy.Globals.chat.items=[];var l=Alloy.Globals.chat.addMessage(t);Alloy.Globals.chat.messagesWindow.setData(l),Alloy.Globals.chat.messagesWindow.data[0]&&Alloy.Globals.chat.messagesWindow.scrollToIndex(Alloy.Globals.chat.messagesWindow.data[0].rows.length-1)},error:function(){V.closeIndicator()}}),Alloy.Collections.messages.fetch({data:{chatId:Alloy.Globals.chat.openChatId},success:function(){V.closeIndicator()}})}}else if(e.offer){var a=JSON.parse(e.offer),t=!1;Alloy.Globals.core.applicationPaused?t=a.FromUserId!=Alloy.Globals.profile.id?Alloy.createController("account/offers/offer",{offerId:a.Id}).getView():Alloy.createController("account/offers/myOffer",{offerId:a.Id}).getView():Alloy.Globals.chat.notify(L("offer"),e.alert,e,function(e){t=e.FromUserId!=Alloy.Globals.profile.id?Alloy.createController("account/offers/offer",{offerId:a.Id}).getView():Alloy.createController("account/offers/myOffer",{offerId:a.Id}).getView(),Alloy.Globals.tabGroup.activeTab?Alloy.Globals.tabGroup.activeTab.open(t):(Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount),Alloy.Globals.tabGroup.activeTab.open(t))})}else e.newDeals?Alloy.Globals.chat.notify(L("new_deals"),e.alert,e):e.deals&&Alloy.Globals.chat.notify(L("deals"),e.alert,e);t&&(Alloy.Globals.tabGroup.activeTab?Alloy.Globals.tabGroup.activeTab.open(t):(Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount),Alloy.Globals.tabGroup.activeTab.open(t)))}function y(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBgOnTap}function p(e){switch(V.openIndicator(),e.source.backgroundColor=Alloy.Globals.Styles.buttonBg,e.source.id){case"findBtn":l();break;case"customLocation":o();break;case"settings":w()}}function w(){V.closeIndicator(),Alloy.createController("notifications/index").getView(),Alloy.CFG.tabNotifications.setActive(!0)}function b(){geo.geocoding(I.address.value,function(e){if(e.error)return void Alloy.Globals.core.showErrorDialog(L(e.message));if(e.error==geo.elementStatuses.ZERO_RESULTS||e.error==geo.elementStatuses.NOT_FOUND)return void Alloy.Globals.core.showErrorDialog(L("address_not_found"));for(var t=[],l=0;l<e.response.results.length;l++){var o=e.response.results[l];t.push({title:o.formatted_address,data:{lat:o.geometry.location.lat,lng:o.geometry.location.lng}})}var i=Alloy.createController("picker/genericPicker",{callback:function(e,t,l){I.address.value=e.title?e.title:e,e.data&&(U=e.data.lat,N=e.data.lng),l&&(W=l),t&&I.pickerWrap.removeAllChildren()},rowIndex:W,items:t}).getView();h(),I.pickerWrap.removeAllChildren(),I.pickerWrap.add(i)})}function g(){V.openIndicator(),t(2e3),O(),"Simulator"==Ti.Platform.model&&(U||N||(U=59,9885368,N=30,2922766),n(Alloy.CFG.deviceToken))}function v(e){"address"!=e.source.id&&h()}function h(){I.address.blur()}function f(e){m(e)}function m(){V.openIndicator(),R=!0,Alloy.Globals.core.apiToken();var e=new Date;C.fetch({add:!0,silent:!0,data:{offset:C.length,lat:U,lng:N,clientTimeZoneOffset:e.getTimezoneOffset(),distance:2e3,token:Alloy.Globals.core.apiToken(),deviceToken:Alloy.Globals.core.deviceToken,subcategoriesOnly:!0,appInstallId:Alloy.Globals.core.installId,appVersion:Ti.App.version,platformModel:Ti.Platform.model,platformVersion:Ti.Platform.version,platformOSName:Ti.Platform.osname,language:Ti.Locale.currentLanguage,subcategories:JSON.stringify(B)},success:function(e,t){Alloy.Globals.core.createRows(C,a,I.deals,"home/deals/defaultSearchRow");for(var l=I.deals.data[0].rows,o=0,i=0;i<l.length;i++){var s=l[i],r=s.toImage();o+=r.height}I.deals.setHeight(o),t.length<M&&(I.loadMore.hide(),I.noLoad.show()),Ti.API.info(P),R=!1,V.closeIndicator(),P=0},error:function(){R=!1,V.closeIndicator()}})}function A(){var e=new Date;if(V.openIndicator(),B=[],Alloy.Globals.notify.subCategories&&!(Alloy.Globals.notify.subCategories.length<3)){for(var t=JSON.parse(Alloy.Globals.notify.subCategories),l=0;l<t.length;l++){var o=t[l];B.push(o.Id?o.Id:o)}C.fetch({data:{lat:U,lng:N,clientTimeZoneOffset:e.getTimezoneOffset(),distance:Alloy.Globals.notify.distance,token:Alloy.Globals.core.apiToken(),subCategoriesOnly:!0,deviceToken:Alloy.Globals.core.deviceToken,appInstallId:Alloy.Globals.core.installId,appVersion:Ti.App.version,platformModel:Ti.Platform.model,platformVersion:Ti.Platform.version,platformOSName:Ti.Platform.osname,language:Ti.Locale.currentLanguage,subcategories:JSON.stringify(B)},success:function(e,t){if(0===C.models.length)return void V.closeIndicator();Alloy.Globals.core.createRows(C,a,I.deals,"home/deals/defaultSearchRow");for(var l=I.deals.data[0].rows,o=0,i=0;i<l.length;i++){var s=l[i],r=s.toImage();o+=r.height}I.deals.setHeight(o),R=!1,V.closeIndicator(),t.length<M?(I.loadMore.hide(),I.noLoad.show()):(I.loadMore.show(),I.noLoad.hide()),Ti.API.info(P),P=0},error:function(){R=!0,V.closeIndicator()}})}}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home/index",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var I=this,S={},T={};I.__views.mainWindow=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"absolute",titleImage:"images/headTitle@2x.png",fullscreen:"true",id:"mainWindow"}),I.__views.mainWindow&&I.addTopLevelView(I.__views.mainWindow),v?I.__views.mainWindow.addEventListener("click",v):T["$.__views.mainWindow!click!winOnClick"]=!0,g?I.__views.mainWindow.addEventListener("open",g):T["$.__views.mainWindow!open!open"]=!0,I.__views.__alloyId172=Ti.UI.createScrollView({layout:"vertical",top:"0",id:"__alloyId172"}),I.__views.mainWindow.add(I.__views.__alloyId172),I.__views.__alloyId173=Ti.UI.createView({left:"20dp",right:"20dp",layout:"vertical",height:Ti.UI.SIZE,id:"__alloyId173"}),I.__views.__alloyId172.add(I.__views.__alloyId173),I.__views.__alloyId174=Ti.UI.createLabel({height:"80dp",width:Ti.UI.FILL,textAlign:"center",color:Alloy.Globals.Styles.titleColor,font:{fontSize:"25dp",fontFamily:"OleoScriptSwashCaps-Regular"},textid:"what_looking",id:"__alloyId174"}),I.__views.__alloyId173.add(I.__views.__alloyId174),I.__views.scrollView=Ti.UI.createScrollView({layout:"horizontal",width:"280dp",height:Alloy.Globals.Styles.inputHeight,top:"-10dp",bottom:"20dp",left:"0dp",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",backgroundImage:"images/icon_horizontalPicker.png",id:"scrollView",borderRadius:"10dp"}),I.__views.__alloyId173.add(I.__views.scrollView),I.__views.__alloyId175=Ti.UI.createView({width:"50dp",height:"30dp",distance:"0",id:"__alloyId175"}),I.__views.scrollView.add(I.__views.__alloyId175),I.__views.__alloyId176=Ti.UI.createView({width:"65dp",height:"30dp",distance:"0",id:"__alloyId176"}),I.__views.scrollView.add(I.__views.__alloyId176),I.__views.__alloyId177=Ti.UI.createLabel({color:Alloy.Globals.Styles.titleColor,font:{fontSize:"15dp",fontFamily:"OleoScriptSwashCaps-Regular"},textid:"distance_wheel",id:"__alloyId177"}),I.__views.__alloyId176.add(I.__views.__alloyId177),I.__views.__alloyId178=Ti.UI.createView({width:"65dp",height:"30dp",distance:"100",id:"__alloyId178"}),I.__views.scrollView.add(I.__views.__alloyId178),I.__views.__alloyId179=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"100 m",id:"__alloyId179"}),I.__views.__alloyId178.add(I.__views.__alloyId179),I.__views.__alloyId180=Ti.UI.createView({width:"65dp",height:"30dp",distance:"250",id:"__alloyId180"}),I.__views.scrollView.add(I.__views.__alloyId180),I.__views.__alloyId181=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"250 m",id:"__alloyId181"}),I.__views.__alloyId180.add(I.__views.__alloyId181),I.__views.__alloyId182=Ti.UI.createView({width:"65dp",height:"30dp",distance:"500",id:"__alloyId182"}),I.__views.scrollView.add(I.__views.__alloyId182),I.__views.__alloyId183=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"500 m",id:"__alloyId183"}),I.__views.__alloyId182.add(I.__views.__alloyId183),I.__views.__alloyId184=Ti.UI.createView({width:"65dp",height:"30dp",distance:"750",id:"__alloyId184"}),I.__views.scrollView.add(I.__views.__alloyId184),I.__views.__alloyId185=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"750 m",id:"__alloyId185"}),I.__views.__alloyId184.add(I.__views.__alloyId185),I.__views.__alloyId186=Ti.UI.createView({width:"65dp",height:"30dp",distance:"1000",id:"__alloyId186"}),I.__views.scrollView.add(I.__views.__alloyId186),I.__views.__alloyId187=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"1000 m",id:"__alloyId187"}),I.__views.__alloyId186.add(I.__views.__alloyId187),I.__views.__alloyId188=Ti.UI.createView({width:"65dp",height:"30dp",distance:"2000",id:"__alloyId188"}),I.__views.scrollView.add(I.__views.__alloyId188),I.__views.__alloyId189=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"2000 m",id:"__alloyId189"}),I.__views.__alloyId188.add(I.__views.__alloyId189),I.__views.__alloyId190=Ti.UI.createView({width:"65dp",height:"30dp",distance:"0",id:"__alloyId190"}),I.__views.scrollView.add(I.__views.__alloyId190),I.__views.__alloyId191=Ti.UI.createLabel({color:Alloy.Globals.Styles.titleColor,font:{fontSize:"15dp",fontFamily:"OleoScriptSwashCaps-Regular"},textid:"distance_wheel",id:"__alloyId191"}),I.__views.__alloyId190.add(I.__views.__alloyId191),I.__views.__alloyId192=Ti.UI.createView({width:"37dp",height:"30dp",distance:"0",id:"__alloyId192"}),I.__views.scrollView.add(I.__views.__alloyId192),I.__views.categoriesLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"categoriesLbl",textid:"categories"}),I.__views.__alloyId173.add(I.__views.categoriesLbl),I.__views.categoriesBtn=Ti.UI.createButton({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,textAlign:"left",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,title:"",id:"categoriesBtn"}),I.__views.__alloyId173.add(I.__views.categoriesBtn),e?I.__views.categoriesBtn.addEventListener("click",e):T["$.__views.categoriesBtn!click!clickCategories"]=!0,I.__views.__alloyId193=Ti.UI.createLabel({width:Ti.UI.SIZE,left:"5dp",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:"15dp",fontFamily:"Arial"},textid:"select_category",id:"__alloyId193"}),I.__views.categoriesBtn.add(I.__views.__alloyId193),I.__views.selectedCategories=Ti.UI.createLabel({height:"20dp",left:"52dp",right:"15dp",top:"7dp",color:"#aaa",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:"12dp",fontFamily:"Arial"},id:"selectedCategories"}),I.__views.categoriesBtn.add(I.__views.selectedCategories),I.__views.__alloyId194=Ti.UI.createLabel({width:"20dp",height:"20dp",right:"5dp",top:"5dp",backgroundImage:"images/icon_listItem.png",backgroundRepeat:!1,id:"__alloyId194"}),I.__views.categoriesBtn.add(I.__views.__alloyId194),I.__views.addressLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"addressLbl",textid:"address"}),I.__views.__alloyId173.add(I.__views.addressLbl),I.__views.__alloyId195=Ti.UI.createView({layout:"absolute",width:Alloy.Globals.Styles.inputWidth,height:"30dp",top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"__alloyId195"}),I.__views.__alloyId173.add(I.__views.__alloyId195),I.__views.address=Ti.UI.createTextField({width:"160dp",height:"30dp",top:"0dp",left:"2dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},color:Alloy.Globals.Styles.inputColor,paddingLeft:"5dp",id:"address",returnKeyType:Ti.UI.RETURNKEY_SEARCH}),I.__views.__alloyId195.add(I.__views.address),b?I.__views.address.addEventListener("return",b):T["$.__views.address!return!search"]=!0,I.__views.customLocation=Ti.UI.createButton({width:"30dp",height:"30dp",bottom:"0dp",right:"0dp",font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,backgroundImage:"images/icon_location.png",backgroundRepeat:!1,id:"customLocation"}),I.__views.__alloyId195.add(I.__views.customLocation),y?I.__views.customLocation.addEventListener("touchstart",y):T["$.__views.customLocation!touchstart!findTouchStart"]=!0,p?I.__views.customLocation.addEventListener("touchend",p):T["$.__views.customLocation!touchend!findTouchEnd"]=!0,I.__views.findBtn=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"findBtn",titleid:"find_button"}),I.__views.__alloyId173.add(I.__views.findBtn),y?I.__views.findBtn.addEventListener("touchstart",y):T["$.__views.findBtn!touchstart!findTouchStart"]=!0,p?I.__views.findBtn.addEventListener("touchend",p):T["$.__views.findBtn!touchend!findTouchEnd"]=!0,I.__views.__alloyId196=Ti.UI.createLabel({height:Ti.UI.SIZE,width:Ti.UI.SIZE,textAlign:"center",bottom:"12dp",color:Alloy.Globals.Styles.titleColor,font:{fontSize:"18dp",fontFamily:"OleoScriptSwashCaps-Regular"},textid:"default_search",id:"__alloyId196"}),I.__views.__alloyId172.add(I.__views.__alloyId196),I.__views.__alloyId197=Ti.UI.createButton({width:"31dp",height:"31dp",backgroundColor:"transparent",backgroundFocusedColor:"transparent",backgroundRepeat:!1,backgroundImage:"images/ic_action_turn_right.png",backgroundSelectedImage:"images/ic_action_turn_right1.png",id:"__alloyId197"}),I.__views.__alloyId172.add(I.__views.__alloyId197),D?I.__views.__alloyId197.addEventListener("click",D):T["$.__views.__alloyId197!click!getHomeDeals"]=!0,I.__views.deals=Ti.UI.createTableView({backgroundColor:"transparent",id:"deals",height:Ti.UI.SIZE}),I.__views.__alloyId172.add(I.__views.deals),I.__views.loadMore=Ti.UI.createLabel({width:Ti.UI.FILL,height:"15dp",top:"5dp",textAlign:"center",font:{fontFamily:"Avenir Next Condensed",fontSize:"17dp"},color:"#999",textid:"isTap",id:"loadMore"}),I.__views.__alloyId172.add(I.__views.loadMore),f?I.__views.loadMore.addEventListener("click",f):T["$.__views.loadMore!click!add"]=!0,I.__views.noLoad=Ti.UI.createLabel({width:Ti.UI.FILL,height:"15dp",top:"5dp",textAlign:"center",font:{fontFamily:"Avenir Next Condensed",fontSize:"17dp"},color:"#999",textid:"isDone",id:"noLoad",visible:"false"}),I.__views.__alloyId172.add(I.__views.noLoad),I.__views.__alloyId198=Ti.UI.createView({height:"20dp",width:Ti.UI.FILL,id:"__alloyId198"}),I.__views.__alloyId172.add(I.__views.__alloyId198),I.__views.mapView=Ti.UI.createView({visible:"false",id:"mapView",height:"0dp"}),I.__views.__alloyId172.add(I.__views.mapView),I.__views.pickerWrap=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,bottom:"0",id:"pickerWrap"}),I.__views.mainWindow.add(I.__views.pickerWrap),S.destroy=function(){},_.extend(I,I.__views),Alloy.Globals.chat.openChatId=!1;var G=Alloy.Globals.core,x=[],C=Alloy.Collections.homeDeals,k=!1,E=Ti.App.address||!1,U=Ti.App.lat||!1,N=Ti.App.lng||!1;Ti.App.address&&(I.address.value=Ti.App.address),Ti.App.Properties.setString("str","");var V=Alloy.Globals.indicator;I.address.setHintText(L("enter_address")),I.scrollView.contentOffset={x:45,y:0};var F=100;I.scrollView.addEventListener("scroll",function(e){F=e.x>=325?2e3:e.x>=260?1e3:e.x>=195?750:e.x>=130?500:e.x>=65?250:100});var P=0,D=function(){var e=Alloy.Globals.geo;e.checkLocation(function(){return e.location.status!=e.errors.NONE?(Alloy.Globals.core.showErrorDialog(L(e.location.status.message)),void V.closeIndicator()):(U=e.location.latitude,N=e.location.longitude,A(),void e.reverseGeocoding(e.location.latitude,e.location.longitude,function(e){e&&e.error?Alloy.Globals.core.showErrorDialog(L(e.message?e.message:e.error)):e&&e.response&&(e.response.results&&e.response.results[0]&&e.response.results[0].formatted_address?I.address.value=e.response.results[0].formatted_address:e.response.resourceSets&&e.response.resourceSets[0]&&e.response.resourceSets[0].resources&&e.response.resourceSets[0].resources[0]&&e.response.resourceSets[0].resources[0].address&&e.response.resourceSets[0].resources[0].address&&e.response.resourceSets[0].resources[0].address.formattedAddress&&(I.address.value=e.response.resourceSets[0].resources[0].address.formattedAddress))}))})},B=[],O=function(){function e(){Ti.Network.registerForPushNotifications({success:s,error:r,callback:u}),Ti.App.iOS.removeEventListener("usernotificationsettings",e)}return Ti.Network.online?void(parseInt(Ti.Platform.version.split(".")[0])>=8?(Ti.App.iOS.addEventListener("usernotificationsettings",e),Titanium.App.iOS.registerUserNotificationSettings({types:[Ti.App.iOS.USER_NOTIFICATION_TYPE_ALERT,Ti.App.iOS.USER_NOTIFICATION_TYPE_SOUND,Ti.App.iOS.USER_NOTIFICATION_TYPE_BADGE]})):Ti.Network.registerForPushNotifications({types:[Ti.Network.NOTIFICATION_TYPE_ALERT,Ti.Network.NOTIFICATION_TYPE_BADGE,Ti.Network.NOTIFICATION_TYPE_SOUND],success:s,error:r,callback:u})):(Alloy.Globals.core.showErrorDialog(L("network_off_line")),void V.closeIndicator())};Ti.App.Properties.setInt("count",0),Ti.App.addEventListener("resumed",function(){Ti.API.info("resumed!!!!!"),Alloy.Globals.notify&&Ti.App.Properties.setObject("notify",Alloy.Globals.notify);var e=Alloy.Globals.core.apiToken();if(!Ti.Network.online)return Alloy.Globals.core.offlineModal||Alloy.Globals.core.createOfflineModal(),void Alloy.Globals.core.offlineModal.show();if(D(),Ti.App.Properties.setObject("messages",[]),Alloy.Globals.core.applicationPaused=!1,e&&(Alloy.Globals.chat.connected&&Alloy.Globals.chat.source.close(),Alloy.Globals.chat.openConnect(),Alloy.Globals.chat.openChatId>0)){var t=Alloy.Globals.indicator;t.openIndicator();var l=Alloy.createCollection("message");l.fetch({data:{chatId:Alloy.Globals.chat.openChatId,offset:0,length:10},success:function(e,t){Alloy.Globals.chat.items=[];var l=Alloy.Globals.chat.addMessage(t);Alloy.Globals.chat.messagesWindow.setData(l),Alloy.Globals.chat.messagesWindow.data[0]&&Alloy.Globals.chat.messagesWindow.scrollToIndex(Alloy.Globals.chat.messagesWindow.data[0].rows.length-1)},error:function(){t.closeIndicator()}}),Alloy.Collections.messages.fetch({data:{chatId:Alloy.Globals.chat.openChatId},success:function(){t.closeIndicator()}})}});var W;Ti.App.addEventListener("home:defaultsearch",function(){update=!1,D()});var $=function(){var e=1;this.next=function(){return e++,e}},R=!0;new $;var M=10;T["$.__views.mainWindow!click!winOnClick"]&&I.__views.mainWindow.addEventListener("click",v),T["$.__views.mainWindow!open!open"]&&I.__views.mainWindow.addEventListener("open",g),T["$.__views.categoriesBtn!click!clickCategories"]&&I.__views.categoriesBtn.addEventListener("click",e),T["$.__views.address!return!search"]&&I.__views.address.addEventListener("return",b),T["$.__views.customLocation!touchstart!findTouchStart"]&&I.__views.customLocation.addEventListener("touchstart",y),T["$.__views.customLocation!touchend!findTouchEnd"]&&I.__views.customLocation.addEventListener("touchend",p),T["$.__views.findBtn!touchstart!findTouchStart"]&&I.__views.findBtn.addEventListener("touchstart",y),T["$.__views.findBtn!touchend!findTouchEnd"]&&I.__views.findBtn.addEventListener("touchend",p),T["$.__views.__alloyId197!click!getHomeDeals"]&&I.__views.__alloyId197.addEventListener("click",D),T["$.__views.loadMore!click!add"]&&I.__views.loadMore.addEventListener("click",f),_.extend(I,S)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;