function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(){a()}function t(e){var t=e.toJSON();return t.price=t.currency+" "+t.price,t.images=t.images&&t.images.length>0?JSON.parse(t.images):[],t.distance=parseFloat(t.distance).toFixed(2),t.dealtype=Alloy.Globals.core.dealType[t.dealtype].title,t.endTime&&(t.endTime=Alloy.Globals.core.viewTime(Alloy.Globals.core.createTime(t.endTime))),t.images.length>0&&(t.image="http://"+Ti.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/image/"+t.images[0]+Alloy.Globals.imageSizes.deal.row()),t}function l(e){return w?void e.success():(w=!0,void o(e))}function o(e){y.openIndicator(),w=!0,Alloy.Globals.core.apiToken();var l=new Date;u.fetch({add:!0,silent:!0,data:{offset:u.length,lat:c.lat,sort:g,length:b,lng:c.lng,distance:2e3,clientTimeZoneOffset:l.getTimezoneOffset(),token:Alloy.Globals.core.apiToken(),subcategories:c.subCategories},success:function(l,o){return w=!1,y.closeIndicator(),o.length?(Alloy.Globals.core.createRows(u,t,r.deals,"home/deals/row"),void(o.length<b?e.done():e.success())):void e.done()},error:function(){e.done(),w=!1,y.closeIndicator()}})}function i(e){return g==e.index+1?!1:(g=e.index+1,void a())}function a(){var e=new Date;y.openIndicator(),u.fetch({data:{sort:g,lat:c.lat,lng:c.lng,distance:2e3,length:b,token:Alloy.Globals.core.apiToken(),subcategories:c.subCategories,clientTimeZoneOffset:e.getTimezoneOffset()},success:function(){Alloy.Globals.core.createRows(u,t,r.deals,"home/deals/row"),w=!1,y.closeIndicator()},error:function(){w=!1,y.closeIndicator()}})}if(require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home/deals/similardeals",arguments[0]){var s=__processArg(arguments[0],"__parentSymbol");__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate")}var r=this,n={},d={};r.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"vertical",id:"window",fullscreen:"true",titleid:"similardeals"}),r.__views.window&&r.addTopLevelView(r.__views.window),e?r.__views.window.addEventListener("open",e):d["$.__views.window!open!open"]=!0,r.__views.wrapper=Ti.UI.createView({id:"wrapper"}),r.__views.window.add(r.__views.wrapper),r.__views.sortsLbl=Ti.UI.createLabel({width:"280dp",height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:"20dp",right:Alloy.Globals.Styles.labelRight,textAlign:"center",font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},top:"10dp",id:"sortsLbl",textid:"sort_by"}),r.__views.wrapper.add(r.__views.sortsLbl),r.__views.sorts=Ti.UI.iOS.createTabbedBar({top:"40dp",left:"20dp",width:"280dp",height:"30dp",style:Ti.UI.iPhone.SystemButtonStyle.BAR,backgroundColor:"#007aff",font:{fontSize:"12dp",fontFamily:"Avenir Next Condensed"},id:"sorts",index:"0"}),r.__views.wrapper.add(r.__views.sorts),i?r.__views.sorts.addEventListener("click",i):d["$.__views.sorts!click!Sort"]=!0,r.__views.is=Alloy.createWidget("nl.fokkezb.infiniteScroll","widget",{id:"is",__parentSymbol:s}),l?r.__views.is.on("end",l):d["$.__views.is!end!add"]=!0,r.__views.deals=Ti.UI.createTableView({backgroundColor:"#00ffffff",layout:"vertical",top:"70dp",bottom:"5dp",footerView:r.__views.is.getProxyPropertyEx("footerView",{recurse:!0}),id:"deals"}),r.__views.wrapper.add(r.__views.deals),n.destroy=function(){},_.extend(r,r.__views);var c=arguments[0].deal||null,u=Alloy.createCollection("similarDeal"),y=Alloy.Globals.indicator,p=function(){var e=1;this.next=function(){return e++,e}},w=!0;new p;var b=10;r.sorts.labels=[L("rating"),L("price"),L("distance"),L("dealtype")];var g=1;d["$.__views.window!open!open"]&&r.__views.window.addEventListener("open",e),d["$.__views.sorts!click!Sort"]&&r.__views.sorts.addEventListener("click",i),d["$.__views.is!end!add"]&&r.__views.is.on("end",l),_.extend(r,n)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;