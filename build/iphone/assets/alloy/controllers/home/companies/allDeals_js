function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(e){var t=e.toJSON();return t.price=t.currency+" "+t.price,t.dealtype=Alloy.Globals.core.dealType[t.dealtype].title,t.images=t.images&&t.images.length>0?JSON.parse(t.images):[],t.myLat=y,t.myLng=p,t.endTime&&(t.endTime=Alloy.Globals.core.viewTime(Alloy.Globals.core.createTime(t.endTime))),t.images.length>0&&(t.image="http://"+Ti.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/image/"+t.images[0]+Alloy.Globals.imageSizes.deal.row()),t}function t(e){return g?void e.success():(g=!0,void l(e))}function l(t){v.openIndicator(),g=!0;var l=new Date,o=Alloy.Globals.core.apiToken();w.fetch({add:!0,silent:!0,data:{token:o,offset:w.length,length:h,clientTimeZoneOffset:l.getTimezoneOffset(),supplierId:c,lat:y,lng:p},success:function(l,o){return g=!1,v.closeIndicator(),o.length?(Alloy.Globals.core.createRows(w,e,r.deals,"home/deals/row"),void(o.length<h?t.done():t.success())):void t.done()},error:function(){t.done(),g=!1,v.closeIndicator()}})}function o(){var t=Alloy.Globals.core.apiToken(),l=new Date;v.openIndicator(),w.fetch({data:{token:t,length:h,clientTimeZoneOffset:l.getTimezoneOffset(),supplierId:c,lat:y,lng:p},success:function(){g=!1,Alloy.Globals.core.createRows(w,e,r.deals,"home/deals/row"),v.closeIndicator()},error:function(){g=!1,v.closeIndicator()}})}function i(){w.reset()}function s(){o()}if(require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home/companies/allDeals",arguments[0]){var a=__processArg(arguments[0],"__parentSymbol");__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate")}var r=this,n={},d={};r.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"vertical",id:"window",fullscreen:"true",titleid:"deals"}),r.__views.window&&r.addTopLevelView(r.__views.window),s?r.__views.window.addEventListener("open",s):d["$.__views.window!open!open"]=!0,i?r.__views.window.addEventListener("close",i):d["$.__views.window!close!close"]=!0,r.__views.is=Alloy.createWidget("nl.fokkezb.infiniteScroll","widget",{id:"is",__parentSymbol:a}),t?r.__views.is.on("end",t):d["$.__views.is!end!add"]=!0,r.__views.deals=Ti.UI.createTableView({backgroundColor:"transparent",footerView:r.__views.is.getProxyPropertyEx("footerView",{recurse:!0}),id:"deals"}),r.__views.window.add(r.__views.deals),r.__views.loading=Ti.UI.createLabel({text:"Loading",id:"loading"}),r.__views.window.add(r.__views.loading),n.destroy=function(){},_.extend(r,r.__views);var c=arguments[0].id,u=arguments[0].supplierName,y=arguments[0].lat||null,p=arguments[0].lng||null;r.window.title=u+"'s deals";var b=function(){var e=1;this.next=function(){return e++,e}},w=Alloy.Collections.companyDeals,g=!0;new b;var h=10,v=Alloy.Globals.indicator;d["$.__views.window!open!open"]&&r.__views.window.addEventListener("open",s),d["$.__views.window!close!close"]&&r.__views.window.addEventListener("close",i),d["$.__views.is!end!add"]&&r.__views.is.on("end",t),_.extend(r,n)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;