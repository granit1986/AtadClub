function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(e){d.image.image=e.logo+e.logoId+"/_100_100",d.nameVal.text=e.name,d.addressVal.text=e.address,d.emailVal.text=e.email,d.phoneVal.text=e.phone,d.aboutVal.text=e.about,d.hoursVal.text=e.workingHours,d.termsVal.text=e.terms,d.window.title=e.name,d.companyNumber.text=e.number}function t(){m.show()}function l(){var e=Ti.UI.createEmailDialog();e.toRecipients=[w.email],e.open()}function o(){var e=Alloy.createController("home/companies/companyMap",{company:w}).getView();Alloy.CFG.tabHome.open(e)}function i(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBgOnTap}function s(e){S.openIndicator(),e.source.backgroundColor=Alloy.Globals.Styles.buttonBg,e.source&&e.source.id&&a(e.source.id)}function a(e){var t=!1;switch(e){case"products":t=Alloy.createController("account/products/indexForUser",{supplierId:w.id}).getView();break;case"deals":t=Alloy.createController("home/companies/allDeals",{id:w.id,supplierName:w.name,lat:g,lng:h}).getView();break;case"send":var l;Alloy.Collections.chats.fetch({success:function(){l=Alloy.Collections.chats.where({To:p})[0],"undefined"!=typeof l?(l=l.toJSON(),t=Alloy.createController("account/answers/answer",{id:l.ChatId,toUser:l.To,newChat:!1}).getView(),S.closeIndicator(),Alloy.CFG.tabHome.open(t)):Alloy.createModel("chat",{from:Alloy.Globals.profile.id,to:p}).save({},{success:function(){t=Alloy.createController("account/answers/answer",{id:arguments[1],newChat:!0,toUser:p}).getView(),S.closeIndicator(),Alloy.CFG.tabHome.open(t)},error:function(){S.closeIndicator(),Alloy.Globals.core.showErrorDialog(L("chat_open_error"))}})},error:function(){Alloy.Globals.core.showErrorDialog(L("chat_open_error")),S.closeIndicator()}})}t&&Alloy.CFG.tabHome.open(t),S.openIndicator()}function r(){T.show()}function n(){Titanium.Platform.openURL("tel:"+w.phone)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home/companies/company",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var d=this,c={},u={};d.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"vertical",fullscreen:"true",id:"window"}),d.__views.window&&d.addTopLevelView(d.__views.window),d.__views.__alloyId214=Ti.UI.createScrollView({layout:"vertical",id:"__alloyId214"}),d.__views.window.add(d.__views.__alloyId214),d.__views.image=Ti.UI.createImageView({width:"80dp",height:"80dp",top:"20dp",left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,borderColor:"#ccc",borderWidth:"1dp",backgroundColor:"#fff",id:"image"}),d.__views.__alloyId214.add(d.__views.image),d.__views.nameVal=Ti.UI.createLabel({height:"80dp",top:"-80dp",left:Alloy.Globals.Styles.titleLbl_left,right:Alloy.Globals.Styles.titleLbl_right,textAlign:"center",color:"#a80062",verticalAlign:"center",font:{fontSize:"20dp",fontFamily:"Georgia"},id:"nameVal"}),d.__views.__alloyId214.add(d.__views.nameVal),d.__views.addressLbl=Ti.UI.createLabel({top:"20dp",left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#007aff",font:{fontSize:"20dp",fontFamily:"Avenir Next Condensed"},id:"addressLbl",textid:"address"}),d.__views.__alloyId214.add(d.__views.addressLbl),d.__views.addressVal=Ti.UI.createLabel({left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#00accb",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},id:"addressVal"}),d.__views.__alloyId214.add(d.__views.addressVal),o?d.__views.addressVal.addEventListener("click",o):u["$.__views.addressVal!click!onClickAddress"]=!0,d.__views.emailLbl=Ti.UI.createLabel({top:"20dp",left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#007aff",font:{fontSize:"20dp",fontFamily:"Avenir Next Condensed"},id:"emailLbl",textid:"email"}),d.__views.__alloyId214.add(d.__views.emailLbl),d.__views.emailVal=Ti.UI.createLabel({left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#00accb",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},id:"emailVal"}),d.__views.__alloyId214.add(d.__views.emailVal),t?d.__views.emailVal.addEventListener("click",t):u["$.__views.emailVal!click!onClickEmail"]=!0,d.__views.companyNumberLbl=Ti.UI.createLabel({top:"20dp",left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#007aff",font:{fontSize:"20dp",fontFamily:"Avenir Next Condensed"},id:"companyNumberLbl",textid:"company_number"}),d.__views.__alloyId214.add(d.__views.companyNumberLbl),d.__views.companyNumber=Ti.UI.createLabel({left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#555",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},id:"companyNumber"}),d.__views.__alloyId214.add(d.__views.companyNumber),d.__views.phoneLbl=Ti.UI.createLabel({top:"20dp",left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#007aff",font:{fontSize:"20dp",fontFamily:"Avenir Next Condensed"},id:"phoneLbl",textid:"phone"}),d.__views.__alloyId214.add(d.__views.phoneLbl),d.__views.phoneVal=Ti.UI.createLabel({left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#00accb",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},id:"phoneVal"}),d.__views.__alloyId214.add(d.__views.phoneVal),r?d.__views.phoneVal.addEventListener("click",r):u["$.__views.phoneVal!click!onClickPhone"]=!0,d.__views.aboutLbl=Ti.UI.createLabel({top:"20dp",left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#007aff",font:{fontSize:"20dp",fontFamily:"Avenir Next Condensed"},id:"aboutLbl",textid:"about_company"}),d.__views.__alloyId214.add(d.__views.aboutLbl),d.__views.aboutVal=Ti.UI.createLabel({left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#555",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},id:"aboutVal"}),d.__views.__alloyId214.add(d.__views.aboutVal),d.__views.hoursLbl=Ti.UI.createLabel({top:"20dp",left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#007aff",font:{fontSize:"20dp",fontFamily:"Avenir Next Condensed"},id:"hoursLbl",textid:"working_hours"}),d.__views.__alloyId214.add(d.__views.hoursLbl),d.__views.hoursVal=Ti.UI.createLabel({left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#555",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},id:"hoursVal"}),d.__views.__alloyId214.add(d.__views.hoursVal),d.__views.termsLbl=Ti.UI.createLabel({top:"20dp",left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#007aff",font:{fontSize:"20dp",fontFamily:"Avenir Next Condensed"},id:"termsLbl",textid:"terms_company"}),d.__views.__alloyId214.add(d.__views.termsLbl),d.__views.termsVal=Ti.UI.createLabel({left:Alloy.Globals.Styles.account_imageLeft,right:Alloy.Globals.Styles.account_imageRight,textAlign:Alloy.Globals.Styles.titleLbl_textAlign,color:"#555",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},id:"termsVal"}),d.__views.__alloyId214.add(d.__views.termsVal),d.__views.__alloyId215=Ti.UI.createView({height:"20dp",width:Ti.UI.FILL,id:"__alloyId215"}),d.__views.__alloyId214.add(d.__views.__alloyId215),d.__views.products=Ti.UI.createButton({width:"180dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"products",titleid:"products"}),d.__views.__alloyId214.add(d.__views.products),i?d.__views.products.addEventListener("touchstart",i):u["$.__views.products!touchstart!buttonTouchStart"]=!0,s?d.__views.products.addEventListener("touchend",s):u["$.__views.products!touchend!buttonTouchEnd"]=!0,d.__views.deals=Ti.UI.createButton({width:"180dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"deals",titleid:"deals"}),d.__views.__alloyId214.add(d.__views.deals),i?d.__views.deals.addEventListener("touchstart",i):u["$.__views.deals!touchstart!buttonTouchStart"]=!0,s?d.__views.deals.addEventListener("touchend",s):u["$.__views.deals!touchend!buttonTouchEnd"]=!0,d.__views.send=Ti.UI.createButton({width:"180dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"send",titleid:"contact_supplier"}),d.__views.__alloyId214.add(d.__views.send),i?d.__views.send.addEventListener("touchstart",i):u["$.__views.send!touchstart!buttonTouchStart"]=!0,s?d.__views.send.addEventListener("touchend",s):u["$.__views.send!touchend!buttonTouchEnd"]=!0;var y=[];y.push("Ok"),y.push("Cancel"),d.__views.dialog=Ti.UI.createAlertDialog({buttonNames:y,id:"dialog",titleid:"Block",messageid:"block_supplier",cancel:"1"}),c.destroy=function(){},_.extend(d,d.__views);var p=arguments[0].id||null,b=arguments[0].callback||null,w=!1,g=arguments[0].lat||!1,h=arguments[0].lng||!1,v=Ti.UI.createAlertDialog({title:L("block"),message:L("block_supplier"),cancel:1,buttonNames:[L("ok"),L("cancel")]});if(Alloy.Globals.profile){var f=Ti.UI.createButton({title:L("block")});f.addEventListener("click",function(){v.show()}),d.window.setRightNavButton(f)}v.addEventListener("click",function(e){switch(e.index){case 0:var t=Alloy.createModel("blackList",{id:p});t.save({},{success:function(){d.window.close(),b&&b(!0)},error:function(e,t){t.Message&&Titanium.UI.createAlertDialog({title:t.Message}).show()}});break;case 1:}}),p&&(Alloy.Globals.profile&&p!=Alloy.Globals.profile.id||(d.send.visible=!1),Alloy.createModel("publicCompany",{id:p}).fetch({success:function(t){w=t.toJSON(),e(w)}}));var A={options:["Write the company","Cancel"],cancel:1},m=Titanium.UI.createOptionDialog(A);m.addEventListener("click",function(e){0==e.index&&l()});var S=Alloy.Globals.indicator,I={options:["Call the company","Cancel"],cancel:1},T=Titanium.UI.createOptionDialog(I);T.addEventListener("click",function(e){0==e.index&&n()}),u["$.__views.addressVal!click!onClickAddress"]&&d.__views.addressVal.addEventListener("click",o),u["$.__views.emailVal!click!onClickEmail"]&&d.__views.emailVal.addEventListener("click",t),u["$.__views.phoneVal!click!onClickPhone"]&&d.__views.phoneVal.addEventListener("click",r),u["$.__views.products!touchstart!buttonTouchStart"]&&d.__views.products.addEventListener("touchstart",i),u["$.__views.products!touchend!buttonTouchEnd"]&&d.__views.products.addEventListener("touchend",s),u["$.__views.deals!touchstart!buttonTouchStart"]&&d.__views.deals.addEventListener("touchstart",i),u["$.__views.deals!touchend!buttonTouchEnd"]&&d.__views.deals.addEventListener("touchend",s),u["$.__views.send!touchstart!buttonTouchStart"]&&d.__views.send.addEventListener("touchstart",i),u["$.__views.send!touchend!buttonTouchEnd"]&&d.__views.send.addEventListener("touchend",s),_.extend(d,c)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;