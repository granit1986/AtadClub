function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(e){t(e)}function t(e){e.source.id!==r.subject.id&&r.pickerWrap.removeAllChildren(),e.source.id!==r.text.id&&r.text.blur()}function l(e){t(e)}function o(){if(!r.text.value)return void Alloy.Globals.core.showErrorDialog(L("complaint_requited"));var e=u.supplierId,t=Alloy.Globals.profile?Alloy.Globals.profile.id:null,l=r.text.value,o=r.subject.value,i=Alloy.createModel("complain",{toSupplierId:e,fromUserId:t,subject:o,DealId:u.id,Text:l});p.openIndicator(),i.save({},{success:function(){p.closeIndicator(),y&&y(),r.complainwin.close(),Alloy.Globals.core.showErrorDialog(L("complaint_sended"))},error:function(e,t){p.closeIndicator(),Alloy.Globals.core.showErrorDialog(t&&t.Message?t.Message:L("error"))}})}function i(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBgOnTap}function s(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBg,o()}function a(){var e=Alloy.createController("picker/genericPicker",{items:c,rowIndex:h,callback:function(e,t,l){r.subject.value=e.title?e.title:e,l>=0&&(h=l),t&&r.pickerWrap.removeAllChildren()}}).getView();r.pickerWrap.removeAllChildren(),r.pickerWrap.add(e)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="complaints/index",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var r=this,n={},d={};r.__views.complainwin=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"absolute",fullscreen:"true",id:"complainwin",titleid:"win_add_complaint"}),r.__views.complainwin&&r.addTopLevelView(r.__views.complainwin),e?r.__views.complainwin.addEventListener("click",e):d["$.__views.complainwin!click!blur"]=!0,r.__views.__alloyId167=Ti.UI.createScrollView({layout:"vertical",left:"20dp",right:"20dp",top:"0",id:"__alloyId167"}),r.__views.complainwin.add(r.__views.__alloyId167),r.__views.__alloyId168=Ti.UI.createView({height:"20dp",width:Ti.UI.FILL,id:"__alloyId168"}),r.__views.__alloyId167.add(r.__views.__alloyId168),r.__views.subjectLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"subjectLbl",textid:"subject"}),r.__views.__alloyId167.add(r.__views.subjectLbl),r.__views.subject=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"subject",enabled:"false"}),r.__views.__alloyId167.add(r.__views.subject),a?r.__views.subject.addEventListener("click",a):d["$.__views.subject!click!clickSubject"]=!0,r.__views.__alloyId169=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"complaint",id:"__alloyId169"}),r.__views.__alloyId167.add(r.__views.__alloyId169),r.__views.text=Ti.UI.createTextArea(function(){var e={};return Alloy.Globals.isHe&&_.extend(e,{textAlign:"right"}),_.extend(e,{width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputAreaHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"text"}),e}()),r.__views.__alloyId167.add(r.__views.text),l?r.__views.text.addEventListener("focus",l):d["$.__views.text!focus!focus"]=!0,r.__views.sendButton=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"sendButton",titleid:"send"}),r.__views.__alloyId167.add(r.__views.sendButton),i?r.__views.sendButton.addEventListener("touchstart",i):d["$.__views.sendButton!touchstart!buttonTouchStart"]=!0,s?r.__views.sendButton.addEventListener("touchend",s):d["$.__views.sendButton!touchend!buttonTouchEnd"]=!0,r.__views.pickerWrap=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,bottom:"0",id:"pickerWrap"}),r.__views.complainwin.add(r.__views.pickerWrap),n.destroy=function(){},_.extend(r,r.__views);var c=[{title:L("spam"),data:{id:1}},{title:L("not_relevant"),data:{id:2}},{title:L("misleading"),data:{id:3}},{title:L("not_real"),data:{id:4}},{title:L("other"),data:{id:5}}];r.subject.value=c[0].title;var u,y=arguments[0].dealWindow||!1,p=Alloy.Globals.indicator;try{u=Alloy.Collections.publicDeals.where({id:arguments[0].id})[0].toJSON()}catch(b){try{u=Alloy.Collections.similarDeals.where({id:arguments[0].id})[0].toJSON()}catch(b){u=Alloy.Collections.homeDeals.where({id:arguments[0].id})[0].toJSON()}}var h=0;d["$.__views.complainwin!click!blur"]&&r.__views.complainwin.addEventListener("click",e),d["$.__views.subject!click!clickSubject"]&&r.__views.subject.addEventListener("click",a),d["$.__views.text!focus!focus"]&&r.__views.text.addEventListener("focus",l),d["$.__views.sendButton!touchstart!buttonTouchStart"]&&r.__views.sendButton.addEventListener("touchstart",i),d["$.__views.sendButton!touchend!buttonTouchEnd"]&&r.__views.sendButton.addEventListener("touchend",s),_.extend(r,n)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;