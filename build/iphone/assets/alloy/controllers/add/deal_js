function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(){if(B){if(Q.openIndicator(),E.title.value=B.name,E.price.value=B.price,E.description.value=B.description,j=JSON.parse(B.subCategories),E.button.title=L("update_deal_button"),E.switch_.value=B.active,E.renewDeal.value=B.renewDays,E.delete_button.visible=!0,E.vouchers.value=B.vouchers,E.dealType.value=Alloy.Globals.core.dealType[B.dealtype].title,lt=B.dealtype,B.startTime&&(E.timepicker_switch.value=!0,E.startTime.value=Alloy.Globals.core.createTime(B.startTime).toLocaleTimeString(),z=B.startTime,E.timeInputs.height=q),B.endTime&&(E.timepicker_switch.value=!0,E.endTime.value=Alloy.Globals.core.createTime(B.endTime).toLocaleTimeString(),H=B.endTime,E.timeInputs.height=q),E.startDate.value=B.startDate?new Date(B.startDate).toLocaleDateString():"",Y=B.startDate,E.dealType.value=Alloy.Globals.core.dealType[B.dealtype].title,B.images){B.images=JSON.parse(B.images);for(var e=0;e<B.images.length;e++)h("http://"+Ti.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/image/"+B.images[e]+Alloy.Globals.imageSizes.deal.row(),B.images[e])}J.selectedCategoriesInEdit={};for(var e=0;e<j.length;++e){var t=j[e];J.subCategories.select({categoryId:t.CategoryId,id:t.Id},J.selectedCategoriesInEdit)}V="",u(),Q.closeIndicator()}else V="newdealer",Alloy.Globals.core.selectedNewDealsCategories={}}function t(e){l(e)}function l(e){"description"!==e.source.id&&E.description.blur(),"dealType"!==e.source.id&&"startDate"!==e.source.id&&"startTime"!==e.source.id&&"endTime"!==e.source.id&&"renewDeal"!==e.source.id&&E.pickerWrap.removeAllChildren(),"title"!==e.source.id&&E.title.blur(),"price"!==e.source.id&&E.price.blur(),"vouchers"!==e.source.id&&E.vouchers.blur()}function o(e){l(e)}function i(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBgOnTap}function s(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBg;var t=e.source.id;switch(t){case"button":Q.openIndicator(),r();break;case"delete_button":Q.openIndicator(),x();break;case"cancel_button":a()}}function a(){E.window.close()}function r(){if(Q.openIndicator(),!Alloy.Globals.core.apiToken()){var e=Titanium.UI.createAlertDialog({title:L("signup_or_signin_title"),message:L("signup_or_signin_message"),buttonNames:[L("no"),L("yes")],cancel:0});return e.addEventListener("click",function(e){e.cancel!==e.index&&!0!==e.cancel&&Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount)}),Q.closeIndicator(),void e.show()}if(!Alloy.Globals.profile||!Alloy.Globals.profile.supplier){var e=Titanium.UI.createAlertDialog({title:L("should_be_company_title"),message:L("should_be_company_message"),buttonNames:[L("no"),L("yes")],cancel:0});return e.addEventListener("click",function(e){e.cancel!==e.index&&!0!==e.cancel&&Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount)}),Q.closeIndicator(),void e.show()}if(0==j.length)return Q.closeIndicator(),void Alloy.Globals.core.showErrorDialog(L("please_select_category"));for(var t=[],l=0;l<j.length;++l){var o=j[l];t.push(o.Id?o.Id:o)}var i={name:E.title.value,price:E.price.value,description:E.description.value,subCategories:JSON.stringify(t),active:E.switch_.value,renewDays:E.renewDeal.value,dealtype:lt>=0?lt:B.dealtype};if(0!=Y&&(i.startDate=Y),i.vouchers=E.voucher_switch.value?E.vouchers.value:0,E.timepicker_switch.value&&(0!=z&&(i.starttime=z),0!=H&&(i.endtime=H)),B&&(i.id=B.id),P&&3===P.length){var s=3!=Alloy.Globals.profile.status?Alloy.Globals.profile.status:0;if(2!==s){var a=P[s];if(i.renewDays>a){var r="";switch(s){case 0:var c=P[1];c>i.renewDays?r=r+L("silver")+L("maxRenew_separator")+L("gold"):r+=L("gold");break;case 1:r+=L("gold")}var e=Titanium.UI.createAlertDialog({title:L("upgrade_membership"),message:L("maxRenew_part1")+r+L("maxRenew_part2"),buttonNames:[L("upgrade"),L("OK")]});return e.addEventListener("click",function(e){if(!e.index){var t=Alloy.createController("account/upgradeSelect").getView();Alloy.Globals.tabGroup.activeTab.open(t)}}),e.show(),void Q.closeIndicator()}}}var i=Alloy.createModel("deal",i);if(i.localValidate(d)){if(1===E.images.children.length)return Alloy.Globals.core.showErrorDialog(L("image_require")),void Q.closeIndicator();i.save({},{success:function(e,t){for(var l=0;l<E.images.children.length;l++){var o=E.images.children[l].image;if(o&&!o.serverId){if("string"!=typeof o){var i=1,s=600,a=E.images.children[l],r=o.height,d=o.width,c=Ti.UI.createImageView({image:a.image,width:d,height:r});r>d?(i=d/r,c.height=s,c.width=s*i):(i=r/d,c.width=s,c.height=s*i),o=c.toImage()}K.push(o)}}if(K.length>0||X.length>0){var _=Alloy.Globals.upload;M.openBar(),_.start({type:_.types.deal,id:t,blobs:K,"delete":JSON.stringify(X),onerror:function(){Alloy.Globals.core.showErrorDialog(L("error_loading_image")),Q.closeIndicator(),M.closeBar()},onload:function(){M.setBarValue(1),M.closeBar(),n()},onsendstream:function(e){M.setBarValue(e.progress),Ti.API.info("progress - "+e.progress)}})}else Q.closeIndicator(),n();Q.closeIndicator()},error:function(e,t){if(t&&t.maxDeals){var l=Titanium.UI.createAlertDialog({title:L("upgrade_membership"),message:L("limit")+" "+t.maxDeals+" "+L("limit_deals"),buttonNames:[L("upgrade"),L("OK")]});l.addEventListener("click",function(e){if(!e.index){var t=Alloy.createController("account/upgradeSelect").getView();Alloy.Globals.tabGroup.activeTab.open(t)}}),l.show()}else t&&t.Message&&Alloy.Globals.core.showErrorDialog(t.Message);Q.closeIndicator()}})}else Q.closeIndicator()}function n(){if(B)Q.closeIndicator(),Alloy.Globals.core.showErrorDialog(L("deal_updated_label")),Ti.App.fireEvent("account:updateDeals"),O&&O(),E.window.close();else{E.itemIsLoad.visible=!0,address=!1,j=[],image=!1,E.title.value="",E.price.value="",E.description.value="",E.switch_.value=!0;var e=Titanium.UI.createAlertDialog({title:L("deal_added_title"),message:L("deal_added_label"),buttonNames:[L("ok"),L("support")],cancel:0});e.addEventListener("click",function(e){return e.cancel===e.index||!0===e.cancel?(Alloy.Collections.deals.fetch(),void E.window.close()):(R||E.window.close(),void Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAppreciation))}),Q.closeIndicator(),e.show()}}function d(e){switch(e){case Z.NO_TITLE:E.title.focus();break;case Z.NO_PRICE:E.price.focus();break;case Z.INVALID_PRICE:E.price.focus();break;case Z.MANY_RENEW:return}Alloy.Globals.core.showError(e)}function c(){var e=Alloy.createController("categories/index",{closeCallback:function(){if(j=[],J.currentSectionCategories()._1&&J.currentSectionCategories()._1.lenght){findAdverts=!0;for(var e in J.currentSectionCategories()._1)j.push(J.currentSectionCategories()._1[e])}else for(var t in J.currentSectionCategories()){var l=J.currentSectionCategories()[t];for(var e in l)j.push(l[e])}u()},sectionName:V,win:F,forDeals:!0}).getView();F&&F.open(e)}function u(){E.selectedCategories.text="";for(var e in J.currentSectionCategories())if(Object.size(J.currentSectionCategories()[e])>0){e=e.replace("_","");var t=Alloy.Collections.categories.get(e);E.selectedCategories.text+=""==E.selectedCategories.text?t.attributes.name:", "+t.attributes.name}}function y(){tt.show()}function p(){Titanium.Media.openPhotoGallery({success:function(e){if(e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO){var t=e.media;h(t)}}})}function h(e,t){Q.openIndicator();var l=Ti.UI.createImageView({image:e,width:"55dp",height:"55dp",right:"5dp",bottom:"5dp",serverId:t||!1}),o=E.addPhoto;E.images.remove(E.addPhoto),E.images.add(l),E.images.add(o),Q.closeIndicator(),E.howToDeleteImageLbl.visible=!0,ot++}function b(){Titanium.Media.showCamera({success:function(e){e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO&&h(e.media)},cancel:function(){},error:function(){}})}function f(e){"[object TiUIImageView]"===e.source.toString()&&(e.source.serverId&&X.push(e.source.serverId),E.images.remove(e.source),ot--,0==ot&&(E.howToDeleteImageLbl.visible=!1))}function g(){var e=Alloy.createController("picker/number",{callback:function(e,t){E.renewDeal.value=item,t&&(E.pickerWrap.removeAllChildren(),$=!1)},maxValue:D}).getView();I(),E.pickerWrap.removeAllChildren(),E.pickerWrap.add(e),$=!0}function w(){var e=Alloy.createController("picker/date",{callback:function(e,t){Y=e.toDateString(),E.startDate.value=e.toLocaleDateString(),t&&(E.pickerWrap.removeAllChildren(),$=!1)}}).getView();I(),E.pickerWrap.removeAllChildren(),E.pickerWrap.add(e),$=!0}function v(){var e=Alloy.createController("picker/dealtype",{callback:function(e,t,l){E.dealType.value=e,l>=0&&(lt=l),t&&(E.pickerWrap.removeAllChildren(),$=!1)},rowIndex:lt}).getView();I(),E.pickerWrap.removeAllChildren(),E.pickerWrap.add(e),$=!0}function A(){var e=Alloy.createController("picker/time",{callback:function(e,t){z=60*e.getUTCHours()+e.getUTCMinutes(),E.startTime.value=e.toLocaleTimeString(),Ti.API.info(e.getUTCHours(),e.getUTCMinutes(),z),t&&(E.pickerWrap.removeAllChildren(),$=!1)}}).getView();I(),E.pickerWrap.removeAllChildren(),E.pickerWrap.add(e),$=!0}function m(){var e=Alloy.createController("picker/time",{callback:function(e,t){H=60*e.getUTCHours()+e.getUTCMinutes(),E.endTime.value=e.toLocaleTimeString(),Ti.API.info(e.getUTCHours(),e.getUTCMinutes(),z),t&&(E.pickerWrap.removeAllChildren(),$=!1)}}).getView();I(),E.pickerWrap.removeAllChildren(),E.pickerWrap.add(e),$=!0}function S(){}function I(){for(var e=0;e<it.length;e++)it[e].blur()}function T(){var e=Titanium.UI.createAlertDialog({message:L("show_help_durning")});e.show()}function G(){var e=Titanium.UI.createAlertDialog({message:L("show_help_renew")});e.show()}function C(){var e=Titanium.UI.createAlertDialog({message:L("show_help_vouchers")});e.show()}function x(){var e=Titanium.UI.createAlertDialog({title:L("delete_deal_title"),message:L("delete_deal_message"),buttonNames:[L("no"),L("yes")],cancel:0});e.addEventListener("click",function(e){Q.closeIndicator(),1==e.index&&Alloy.Collections.deals.where({id:B.id})[0].destroy({success:function(){Ti.App.fireEvent("account:updateDeals"),E.window.close()},error:function(){}})}),e.show()}function k(){O&&O(),Q.closeIndicator()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="add/deal",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var E=this,U={},N={};E.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"absolute",fullscreen:"true",id:"window",height:Ti.UI.FILL,titleid:"new_deal"}),E.__views.window&&E.addTopLevelView(E.__views.window),k?E.__views.window.addEventListener("close",k):N["$.__views.window!close!onClose"]=!0,e?E.__views.window.addEventListener("open",e):N["$.__views.window!open!open"]=!0,t?E.__views.window.addEventListener("click",t):N["$.__views.window!click!blur"]=!0,E.__views.form=Ti.UI.createScrollView({layout:"vertical",left:"20dp",right:"20dp",id:"form",top:"0"}),E.__views.window.add(E.__views.form),E.__views.__alloyId139=Ti.UI.createView({height:"20dp",width:Ti.UI.FILL,id:"__alloyId139"}),E.__views.form.add(E.__views.__alloyId139),E.__views.categoriesLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"categoriesLbl",textid:"categories"}),E.__views.form.add(E.__views.categoriesLbl),E.__views.categories=Ti.UI.createButton({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,textAlign:"left",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,title:"",id:"categories"}),E.__views.form.add(E.__views.categories),c?E.__views.categories.addEventListener("click",c):N["$.__views.categories!click!categories"]=!0,E.__views.__alloyId140=Ti.UI.createLabel({width:Ti.UI.SIZE,left:"5dp",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:"15dp",fontFamily:"Arial"},textid:"select_category",id:"__alloyId140"}),E.__views.categories.add(E.__views.__alloyId140),E.__views.selectedCategories=Ti.UI.createLabel({height:"20dp",left:"52dp",right:"15dp",top:"7dp",color:"#aaa",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:"12dp",fontFamily:"Arial"},id:"selectedCategories"}),E.__views.categories.add(E.__views.selectedCategories),E.__views.__alloyId141=Ti.UI.createLabel({width:"20dp",height:"20dp",right:"5dp",top:"5dp",backgroundImage:"images/icon_listItem.png",backgroundRepeat:!1,id:"__alloyId141"}),E.__views.categories.add(E.__views.__alloyId141),E.__views.titleLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"titleLbl",textid:"title"}),E.__views.form.add(E.__views.titleLbl),E.__views.title=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"title"}),E.__views.form.add(E.__views.title),o?E.__views.title.addEventListener("focus",o):N["$.__views.title!focus!focus"]=!0,E.__views.priceLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"priceLbl",textid:"deal_price"}),E.__views.form.add(E.__views.priceLbl),E.__views.price=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"price",keyboardType:Ti.UI.KEYBOARD_DECIMAL_PAD}),E.__views.form.add(E.__views.price),o?E.__views.price.addEventListener("focus",o):N["$.__views.price!focus!focus"]=!0,E.__views.dealtypeLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"dealtypeLbl",textid:"dealtype"}),E.__views.form.add(E.__views.dealtypeLbl),E.__views.dealType=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"dealType",enabled:"false"}),E.__views.form.add(E.__views.dealType),v?E.__views.dealType.addEventListener("click",v):N["$.__views.dealType!click!setDealType"]=!0,E.__views.descriptionLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"descriptionLbl",textid:"description"}),E.__views.form.add(E.__views.descriptionLbl),E.__views.description=Ti.UI.createTextArea(function(){var e={};return Alloy.Globals.isHe&&_.extend(e,{textAlign:"right"}),_.extend(e,{width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputAreaHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"description",suppressReturn:"false",returnKeyType:Ti.UI.RETURNKEY_NEXT}),e}()),E.__views.form.add(E.__views.description),o?E.__views.description.addEventListener("focus",o):N["$.__views.description!focus!focus"]=!0,E.__views.startDateLbl=Ti.UI.createLabel({width:"85dp",height:Ti.UI.SIZE,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"startDateLbl",textid:"start_date"}),E.__views.form.add(E.__views.startDateLbl),E.__views.startDate=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"startDate",enabled:"false"}),E.__views.form.add(E.__views.startDate),w?E.__views.startDate.addEventListener("click",w):N["$.__views.startDate!click!setStartDate"]=!0,E.__views.__alloyId142=Ti.UI.createLabel({width:"85dp",height:Ti.UI.SIZE,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"deal_renew",id:"__alloyId142"}),E.__views.form.add(E.__views.__alloyId142),E.__views.renewDeal=Ti.UI.createTextField({width:"150dp",height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"0",left:Alloy.Globals.Styles.textboxLeft,right:Alloy.Globals.Styles.textboxRight,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"renewDeal",enabled:"false"}),E.__views.form.add(E.__views.renewDeal),g?E.__views.renewDeal.addEventListener("click",g):N["$.__views.renewDeal!click!setAutoRenew"]=!0,E.__views.__alloyId143=Ti.UI.createLabel({width:"30dp",height:"30dp",top:"-30dp",bottom:"10dp",right:Alloy.Globals.Styles.tooltipRight,left:Alloy.Globals.Styles.tooltipLeft,borderRadius:"15dp",color:"#ffffff",backgroundColor:"#007aff",textAlign:"center",text:"?",id:"__alloyId143"}),E.__views.form.add(E.__views.__alloyId143),G?E.__views.__alloyId143.addEventListener("click",G):N["$.__views.__alloyId143!click!showHelpRenew"]=!0,E.__views.__alloyId144=Ti.UI.createLabel({width:"140dp",height:Ti.UI.SIZE,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"deal_is_active_during",id:"__alloyId144"}),E.__views.form.add(E.__views.__alloyId144),E.__views.timepicker_switch=Ti.UI.createSwitch({height:Alloy.Globals.Styles.inputAreaHeight,width:"20dp",top:Alloy.Globals.Styles.inputUp,bottom:"0",right:Alloy.Globals.Styles.rightSwitchLong,left:Alloy.Globals.Styles.leftSwitchLong,value:!1,id:"timepicker_switch"}),E.__views.form.add(E.__views.timepicker_switch),E.__views.__alloyId145=Ti.UI.createLabel({width:"30dp",height:"30dp",top:"-60dp",bottom:"30dp",right:Alloy.Globals.Styles.tooltipRight,left:Alloy.Globals.Styles.tooltipLeft,borderRadius:"15dp",color:"#ffffff",backgroundColor:"#007aff",textAlign:"center",text:"?",id:"__alloyId145"}),E.__views.form.add(E.__views.__alloyId145),T?E.__views.__alloyId145.addEventListener("click",T):N["$.__views.__alloyId145!click!showHelpDurning"]=!0,E.__views.timeInputs=Ti.UI.createView({id:"timeInputs",layout:"vertical",visible:"false",height:"0",top:"-20dp"}),E.__views.form.add(E.__views.timeInputs),E.__views.startTimeLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Ti.UI.SIZE,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"startTimeLbl",textid:"start_time"}),E.__views.timeInputs.add(E.__views.startTimeLbl),E.__views.startTime=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"startTime",enabled:"false"}),E.__views.timeInputs.add(E.__views.startTime),A?E.__views.startTime.addEventListener("click",A):N["$.__views.startTime!click!setStartTime"]=!0,E.__views.endTimeLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"endTimeLbl",textid:"end_time"}),E.__views.timeInputs.add(E.__views.endTimeLbl),E.__views.endTime=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"endTime",enabled:"false"}),E.__views.timeInputs.add(E.__views.endTime),m?E.__views.endTime.addEventListener("click",m):N["$.__views.endTime!click!setEndTime"]=!0,E.__views.__alloyId146=Ti.UI.createLabel({width:"140dp",height:Ti.UI.SIZE,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"use_vouchers",id:"__alloyId146"}),E.__views.form.add(E.__views.__alloyId146),E.__views.voucher_switch=Ti.UI.createSwitch({height:Alloy.Globals.Styles.inputAreaHeight,width:"20dp",top:Alloy.Globals.Styles.inputUp,bottom:"0",right:Alloy.Globals.Styles.rightSwitchLong,left:Alloy.Globals.Styles.leftSwitchLong,value:!1,id:"voucher_switch"}),E.__views.form.add(E.__views.voucher_switch),E.__views.__alloyId147=Ti.UI.createLabel({width:"30dp",height:"30dp",top:"-60dp",bottom:"30dp",right:Alloy.Globals.Styles.tooltipRight,left:Alloy.Globals.Styles.tooltipLeft,borderRadius:"15dp",color:"#ffffff",backgroundColor:"#007aff",textAlign:"center",text:"?",id:"__alloyId147"}),E.__views.form.add(E.__views.__alloyId147),C?E.__views.__alloyId147.addEventListener("click",C):N["$.__views.__alloyId147!click!showHelpVouchers"]=!0,E.__views.voucherInputs=Ti.UI.createView({id:"voucherInputs",layout:"vertical",visible:"false",height:"0",top:"-20dp"}),E.__views.form.add(E.__views.voucherInputs),E.__views.vouchersLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"vouchersLbl",textid:"vouchers"}),E.__views.voucherInputs.add(E.__views.vouchersLbl),E.__views.vouchers=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"vouchers",keyboardType:Ti.UI.KEYBOARD_NUMBER_PAD}),E.__views.voucherInputs.add(E.__views.vouchers),S?E.__views.vouchers.addEventListener("click",S):N["$.__views.vouchers!click!setVouchers"]=!0,o?E.__views.vouchers.addEventListener("focus",o):N["$.__views.vouchers!focus!focus"]=!0,E.__views.imageLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"imageLbl",textid:"images"}),E.__views.form.add(E.__views.imageLbl),E.__views.__alloyId148=Ti.UI.createView({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:Alloy.Globals.Styles.inputUp,left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",id:"__alloyId148"}),E.__views.form.add(E.__views.__alloyId148),E.__views.images=Ti.UI.createView({height:Ti.UI.SIZE,top:"5dp",left:"5dp",id:"images",layout:"horizontal"}),E.__views.__alloyId148.add(E.__views.images),f?E.__views.images.addEventListener("click",f):N["$.__views.images!click!onClickImages"]=!0,E.__views.addPhoto=Ti.UI.createButton({width:"56dp",height:"56dp",right:"5dp",bottom:"5dp",backgroundColor:Alloy.Globals.Styles.buttonBg,backgroundImage:"images/icon_gallery.png",id:"addPhoto"}),E.__views.images.add(E.__views.addPhoto),y?E.__views.addPhoto.addEventListener("click",y):N["$.__views.addPhoto!click!addPhoto"]=!0,E.__views.howToDeleteImageLbl=Ti.UI.createLabel({width:Ti.UI.FILL,height:"20dp",bottom:"10dp",textAlign:Alloy.Globals.Styles.imageSelectTipTextAlign,font:{fontFamily:"Avenir Next Condensed",fontSize:"12dp"},color:"#555",id:"howToDeleteImageLbl",textid:"tap_to_delete_image",visible:"false"}),E.__views.form.add(E.__views.howToDeleteImageLbl),E.__views.switchLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"switchLbl",textid:"active"}),E.__views.form.add(E.__views.switchLbl),E.__views.switch_=Ti.UI.createSwitch({height:Alloy.Globals.Styles.inputAreaHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,value:!0,id:"switch_"}),E.__views.form.add(E.__views.switch_),E.__views.itemIsLoad=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"itemIsLoad",textid:"itemIsLoad",visible:"false"}),E.__views.form.add(E.__views.itemIsLoad),E.__views.button=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,titleid:"add_deal_button",id:"button"}),E.__views.form.add(E.__views.button),i?E.__views.button.addEventListener("touchstart",i):N["$.__views.button!touchstart!buttonTouchStart"]=!0,s?E.__views.button.addEventListener("touchend",s):N["$.__views.button!touchend!buttonTouchEnd"]=!0,E.__views.cancel_button=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,titleid:"cancel",id:"cancel_button"}),E.__views.form.add(E.__views.cancel_button),i?E.__views.cancel_button.addEventListener("touchstart",i):N["$.__views.cancel_button!touchstart!buttonTouchStart"]=!0,s?E.__views.cancel_button.addEventListener("touchend",s):N["$.__views.cancel_button!touchend!buttonTouchEnd"]=!0,E.__views.delete_button=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,titleid:"delete_deal_button",id:"delete_button",visible:"false"}),E.__views.form.add(E.__views.delete_button),i?E.__views.delete_button.addEventListener("touchstart",i):N["$.__views.delete_button!touchstart!buttonTouchStart"]=!0,s?E.__views.delete_button.addEventListener("touchend",s):N["$.__views.delete_button!touchend!buttonTouchEnd"]=!0,E.__views.pickerWrap=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,bottom:"0",id:"pickerWrap"}),E.__views.window.add(E.__views.pickerWrap),U.destroy=function(){},_.extend(E,E.__views);var P,D=1,F=arguments[0].tab||null,O=arguments[0].callback||!1,M=Alloy.Globals.progress,R=arguments[0].enterFromAccount||!1,$=!1;Alloy.Globals.core.maxDealRenew(function(e){P=JSON.parse(e),D=P[P.length-1]});var V;if(!Alloy.Globals.profile||!Alloy.Globals.profile.supplier){var W=Titanium.UI.createAlertDialog({title:L("should_be_company_title"),message:L("should_be_company_message"),buttonNames:[L("no"),L("yes")],cancel:0});W.addEventListener("click",function(e){return e.cancel===e.index||!0===e.cancel?void E.window.close():(E.window.close(),void(Alloy.Globals.tabGroup.activeTab.titleid!=Alloy.CFG.tabAccount.titleid&&Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount)))}),W.show()}var B=!1,z=0,H=0,Y=0,q="80dp";arguments[0]&&arguments[0].dealId&&(B=Alloy.Collections.deals.where({id:arguments[0].dealId})[0].toJSON());var O=!1;arguments[0]&&arguments[0].callback&&(O=arguments[0].callback);var Z=Alloy.Globals.errors,J=Alloy.Globals.core,j=[],K=[],X=[],Q=Alloy.Globals.indicator;E.timepicker_switch.addEventListener("change",function(){E.timepicker_switch.value?(E.timeInputs.visible=!0,E.timeInputs.height=q):(E.timeInputs.visible=!1,E.timeInputs.height="0dp")}),E.voucher_switch.addEventListener("change",function(){E.voucher_switch.value?(E.voucherInputs.visible=!0,E.voucherInputs.height="40dp"):(E.voucherInputs.visible=!1,E.voucherInputs.height="0dp")}),E.vouchers.value&&(E.voucher_switch.value=!0,E.voucherInputs.height="40dp");var et={options:["Make Photo","Choose Photo","Cancel"],cancel:2},tt=Titanium.UI.createOptionDialog(et);tt.addEventListener("click",function(e){0==e.index&&b(),1==e.index&&p()});var lt,ot=0,it=[E.price,E.title,E.description,E.vouchers];N["$.__views.window!close!onClose"]&&E.__views.window.addEventListener("close",k),N["$.__views.window!open!open"]&&E.__views.window.addEventListener("open",e),N["$.__views.window!click!blur"]&&E.__views.window.addEventListener("click",t),N["$.__views.categories!click!categories"]&&E.__views.categories.addEventListener("click",c),N["$.__views.title!focus!focus"]&&E.__views.title.addEventListener("focus",o),N["$.__views.price!focus!focus"]&&E.__views.price.addEventListener("focus",o),N["$.__views.dealType!click!setDealType"]&&E.__views.dealType.addEventListener("click",v),N["$.__views.description!focus!focus"]&&E.__views.description.addEventListener("focus",o),N["$.__views.startDate!click!setStartDate"]&&E.__views.startDate.addEventListener("click",w),N["$.__views.renewDeal!click!setAutoRenew"]&&E.__views.renewDeal.addEventListener("click",g),N["$.__views.__alloyId143!click!showHelpRenew"]&&E.__views.__alloyId143.addEventListener("click",G),N["$.__views.__alloyId145!click!showHelpDurning"]&&E.__views.__alloyId145.addEventListener("click",T),N["$.__views.startTime!click!setStartTime"]&&E.__views.startTime.addEventListener("click",A),N["$.__views.endTime!click!setEndTime"]&&E.__views.endTime.addEventListener("click",m),N["$.__views.__alloyId147!click!showHelpVouchers"]&&E.__views.__alloyId147.addEventListener("click",C),N["$.__views.vouchers!click!setVouchers"]&&E.__views.vouchers.addEventListener("click",S),N["$.__views.vouchers!focus!focus"]&&E.__views.vouchers.addEventListener("focus",o),N["$.__views.images!click!onClickImages"]&&E.__views.images.addEventListener("click",f),N["$.__views.addPhoto!click!addPhoto"]&&E.__views.addPhoto.addEventListener("click",y),N["$.__views.button!touchstart!buttonTouchStart"]&&E.__views.button.addEventListener("touchstart",i),N["$.__views.button!touchend!buttonTouchEnd"]&&E.__views.button.addEventListener("touchend",s),N["$.__views.cancel_button!touchstart!buttonTouchStart"]&&E.__views.cancel_button.addEventListener("touchstart",i),N["$.__views.cancel_button!touchend!buttonTouchEnd"]&&E.__views.cancel_button.addEventListener("touchend",s),N["$.__views.delete_button!touchstart!buttonTouchStart"]&&E.__views.delete_button.addEventListener("touchstart",i),N["$.__views.delete_button!touchend!buttonTouchEnd"]&&E.__views.delete_button.addEventListener("touchend",s),_.extend(E,U)
}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;