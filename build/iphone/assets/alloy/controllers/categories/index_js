function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(t){if(!t||!t.fromAdapter){e.opts||{};for(var l=s(d),o=l.length,i=[],r=0;o>r;r++){var n=l[r];n.__transform={};var c=Alloy.createController("categories/row",{$model:n});i.push(c.getViewEx({recurse:!0}))}a.__views.categories.setData(i)}}function t(){Ti.App.removeEventListener("categoryWindow:showSubCategories",o),Ti.App.removeEventListener("blockCategories",i),h&&h()}function l(){if(v.openIndicator(),Ti.App.addEventListener("blockCategories",i),Alloy.Collections.categories.fetch({cache:{name:"categories",validMinutes:60},success:function(){Ti.API.info("loaded")}}),Ti.App.addEventListener("categoryWindow:showSubCategories",o),Alloy.Collections.categories.length>0){var e=a.categories.data[0].rows;g&&e.length>0&&i()}v.closeIndicator()}function o(e){v.openIndicator();var t=Alloy.createController("subCategories/index",{closeCallback:function(e){for(item in w.currentSectionCategories())0==Object.size(w.currentSectionCategories()[item])&&delete w.currentSectionCategories()[item];if(e){for(var t=0;t<a.categories.data[0].rows.length;t++){var l=a.categories.data[0].rows[t];if(l.children[0].categoryId==e){var o=Alloy.Collections.subCategories.where({categoryId:e}),s=Alloy.Globals.core.currentSectionCategories()["_"+e];l.item.setIsChecked(s,o);break}}g&&i()}},categoryId:e.categoryId,categoryName:e.categoryName,sectionName:b,win:u}).getView();v.closeIndicator(),u.open(t)}function i(){if(g){var e=0,t=!1;if(Alloy.Globals.core.currentSectionCategories()._1&&Object.size(Alloy.Globals.core.currentSectionCategories()._1)>0&&(e=1,t=!1),!w.currentSectionCategories()._1&&0==Object.size(w.currentSectionCategories()._1)&&Object.size(w.currentSectionCategories())>0){e=1;var l=a.categories.data[0].rows[0];l.hasChild=!1,l.children[0].color="#c7c7c7",t=!0}else 0==Object.size(w.currentSectionCategories())&&(e=0,t=!0);for(var o=e;o<a.categories.data[0].rows.length;o++){var l=a.categories.data[0].rows[o];l.hasChild=t,l.children[0].color=t?"#007aff":"#c7c7c7"}}}function s(e){return y?e.where({forDeals:!0}):p?e.where({forDeals:!1}):e.models}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="categories/index",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var a=this,r={},n={};a.__views.window=Ti.UI.createWindow({backgroundImage:"images/background.png",layout:"vertical",fullscreen:"true",titleid:"choose_category",id:"window"}),a.__views.window&&a.addTopLevelView(a.__views.window),t?a.__views.window.addEventListener("close",t):n["$.__views.window!close!onClose"]=!0,l?a.__views.window.addEventListener("open",l):n["$.__views.window!open!open"]=!0,a.__views.categories=Ti.UI.createTableView({backgroundColor:"#00ffffff",top:"20dp",bottom:"20dp",id:"categories",separatorColor:"transparent"}),a.__views.window.add(a.__views.categories);var d=Alloy.Collections.categories||categories;d.on("fetch destroy change add remove reset",e),r.destroy=function(){d.off("fetch destroy change add remove reset",e)},_.extend(a,a.__views);var c=arguments[0]||{},u=c.win,y=c.forDeals||!1,p=c.forAdverts||!1,h=c.closeCallback||!1,b=c.sectionName||!1,g=c.withblock||!1;Alloy.Globals.core.currentSection=b;var w=Alloy.Globals.core,f=Ti.UI.createButton({title:L("ok")});f.addEventListener("click",function(){a.window.close()}),a.window.setLeftNavButton(f);var v=Alloy.Globals.indicator;Ti.API.info("category opened"),n["$.__views.window!close!onClose"]&&a.__views.window.addEventListener("close",t),n["$.__views.window!open!open"]&&a.__views.window.addEventListener("open",l),_.extend(a,r)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;