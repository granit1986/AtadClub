function __processArg(e,t){var o=null;return e&&(o=e[t]||null,delete e[t]),o}function Controller(){function e(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBgOnTap}function t(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBg,"update"==e.source.id?c():"customLocation"==e.source.id?r():"upgrade"==e.source.id&&s()}function o(e){l(e)}function l(e){e.source.id!==g.firstName.id&&g.firstName.blur(),e.source.id!==g.lastName.id&&g.lastName.blur(),e.source.id!==g.email.id&&g.email.blur(),e.source.id!==g.phone.id&&g.phone.blur(),e.source.id!==g.address.id&&g.address.blur(),e.source.id!==g.password.id&&g.password.blur(),e.source.id!==g.confirmPassword.id&&g.confirmPassword.blur()}function i(e){l(e)}function s(){var e=Alloy.createController("account/upgradeSelect",{callback:function(){h()}}).getView();Alloy.CFG.tabAccount.open(e)}function a(){g.address.setHintText(L("enter_address")),Alloy.Globals.profile&&Alloy.Globals.profile.endStatusDate&&h()}function r(){m.openIndicator();var e=Alloy.Globals.geo;e.checkLocation(function(){return e.location.status!=e.errors.NONE?(Alloy.Globals.core.showErrorDialog(L(e.location.status.message)),void m.closeIndicator()):void e.reverseGeocoding(e.location.latitude,e.location.longitude,function(e){m.closeIndicator(),e&&e.error?Alloy.Globals.core.showErrorDialog(L(e.message?e.message:e.error)):e&&e.response&&(e.response.results&&e.response.results[0]&&e.response.results[0].formatted_address?g.address.value=e.response.results[0].formatted_address:e.response.resourceSets&&e.response.resourceSets[0]&&e.response.resourceSets[0].resources&&e.response.resourceSets[0].resources[0]&&e.response.resourceSets[0].resources[0].address&&e.response.resourceSets[0].resources[0].address.formattedAddress&&(g.address.value=e.response.resourceSets[0].resources[0].address.formattedAddress))})})}function n(){geo.geocoding(g.address.value,function(e){if(e.error)return void Alloy.Globals.core.showErrorDialog(L(e.message));if(e.error==geo.elementStatuses.ZERO_RESULTS||e.error==geo.elementStatuses.NOT_FOUND)return m.closeIndicator(),Alloy.Globals.core.showErrorDialog(L("address_not_found")),void(S=!1);for(var t=[],o=0;o<e.response.results.length;o++){var l=e.response.results[o];t.push({title:l.formatted_address,data:{lat:l.geometry.location.lat,lng:l.geometry.location.lng}})}var i=Alloy.createController("picker/genericPicker",{callback:function(e,t,o){g.address.value=e.title?e.title:e,e.data&&(lat=e.data.lat,lng=e.data.lng),o&&(A=o),t&&g.pickerWrap.removeAllChildren(),S=!0},rowIndex:A,items:t}).getView();d(),g.pickerWrap.removeAllChildren(),g.pickerWrap.add(i)})}function d(){g.address.blur()}function c(){m.openIndicator(),v.set("firstName",g.firstName.value),v.set("lastName",g.lastName.value),v.set("email",g.email.value),v.set("phone",g.phone.value);var e=g.address.value.trim();v.set("address",e),v.set("newPassword",g.password.value),v.set("confirm",g.confirmPassword.value),""!=e?geo.geocoding(e,function(e){return e.error?void Alloy.Globals.core.showErrorDialog(L(e.message)):e.error==geo.elementStatuses.ZERO_RESULTS||e.error==geo.elementStatuses.NOT_FOUND?(m.closeIndicator(),void Alloy.Globals.core.showErrorDialog(L("address_not_found"))):void(v.localValidate(p)?u(v):m.closeIndicator())}):v.localValidate(p)?u(v):m.closeIndicator()}function u(e){e.save({},{success:function(){Ti.App.fireEvent("account:updateProfile"),Alloy.Globals.core.showErrorDialog(L("profile_save")),m.closeIndicator(),g.window.close()},error:function(e,t){m.closeIndicator(),t&&t.Message&&Alloy.Globals.core.showErrorDialog(L("server_"+t.Message,L("not_updated")))}})}function p(e){switch(e){case errors.NO_FIRST_NAME:g.firstName.focus();break;case errors.NO_EMAIL:case errors.INVALID_EMAIL:case errors.NOT_SIGNED:g.email.focus();break;case errors.INVALID_PHONE:g.phone.focus()}Alloy.Globals.core.showError(e)}function h(){if(0!=Alloy.Globals.profile.status){var e="";switch(Alloy.Globals.profile.status){case 1:e=L("silver_business");break;case 2:e=L("gold_business");break;case 3:e=L("gold_private")}var t=y(Alloy.Globals.profile.endStatusDate),o=t.getMonth()+"/"+t.getDate()+"/"+t.getFullYear();f(e,o)}}function y(e){var t=e.split(/[- :T]/);return new Date(t[0],t[1],t[2],t[3],t[4],0)}function f(e,t){var o=Ti.UI.createLabel({text:e,height:"20dp",width:Ti.UI.FILL,top:"10dp",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"#007aff",font:{fontSize:"20dp",fontFamily:"Avenir Next Condensed"}}),l=Ti.UI.createLabel({text:L("to_DATE")+" "+t,height:"20dp",width:Ti.UI.FILL,top:"40dp",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"#555",font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"}});g.accInfo.removeAllChildren(),g.accInfo.add(o),g.accInfo.add(l)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="account/profile",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var g=this,w={},b={};g.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"absolute",fullscreen:"true",titleid:"profile",id:"window"}),g.__views.window&&g.addTopLevelView(g.__views.window),a?g.__views.window.addEventListener("open",a):b["$.__views.window!open!open"]=!0,o?g.__views.window.addEventListener("click",o):b["$.__views.window!click!blur"]=!0,g.__views.__alloyId28=Ti.UI.createScrollView({layout:"vertical",left:"20dp",right:"20dp",top:"0",id:"__alloyId28"}),g.__views.window.add(g.__views.__alloyId28),g.__views.accInfo=Ti.UI.createView({id:"accInfo",height:Ti.UI.SIZE,layout:"absolute"}),g.__views.__alloyId28.add(g.__views.accInfo),g.__views.__alloyId29=Ti.UI.createView({height:"20dp",width:Ti.UI.FILL,id:"__alloyId29"}),g.__views.__alloyId28.add(g.__views.__alloyId29),g.__views.firstNameLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"firstNameLbl",textid:"firstname"}),g.__views.__alloyId28.add(g.__views.firstNameLbl),g.__views.firstName=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"firstName"}),g.__views.__alloyId28.add(g.__views.firstName),i?g.__views.firstName.addEventListener("focus",i):b["$.__views.firstName!focus!focus"]=!0,g.__views.lastNameLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"lastNameLbl",textid:"lastname"}),g.__views.__alloyId28.add(g.__views.lastNameLbl),g.__views.lastName=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"lastName"}),g.__views.__alloyId28.add(g.__views.lastName),i?g.__views.lastName.addEventListener("focus",i):b["$.__views.lastName!focus!focus"]=!0,g.__views.emailLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"emailLbl",textid:"email"}),g.__views.__alloyId28.add(g.__views.emailLbl),g.__views.email=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"email"}),g.__views.__alloyId28.add(g.__views.email),i?g.__views.email.addEventListener("focus",i):b["$.__views.email!focus!focus"]=!0,g.__views.phoneLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"phoneLbl",textid:"phone"}),g.__views.__alloyId28.add(g.__views.phoneLbl),g.__views.phone=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"phone",keyboardType:Titanium.UI.KEYBOARD_NUMBER_PAD}),g.__views.__alloyId28.add(g.__views.phone),i?g.__views.phone.addEventListener("focus",i):b["$.__views.phone!focus!focus"]=!0,g.__views.addressLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"addressLbl",textid:"address"}),g.__views.__alloyId28.add(g.__views.addressLbl),g.__views.__alloyId30=Ti.UI.createView({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputAreaHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"__alloyId30"}),g.__views.__alloyId28.add(g.__views.__alloyId30),g.__views.address=Ti.UI.createTextArea(function(){var e={};return Alloy.Globals.isHe&&_.extend(e,{textAlign:"right"}),_.extend(e,{width:"160dp",height:Alloy.Globals.Styles.inputAreaHeight,top:"0dp",left:"2dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},color:Alloy.Globals.Styles.inputColor,paddingLeft:"5dp",id:"address",returnKeyType:Ti.UI.RETURNKEY_SEARCH}),e}()),g.__views.__alloyId30.add(g.__views.address),n?g.__views.address.addEventListener("return",n):b["$.__views.address!return!search"]=!0,g.__views.customLocation=Ti.UI.createButton({width:"30dp",height:"30dp",bottom:"0dp",right:"0dp",font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,backgroundImage:"images/icon_location.png",backgroundRepeat:!1,id:"customLocation"}),g.__views.__alloyId30.add(g.__views.customLocation),e?g.__views.customLocation.addEventListener("touchstart",e):b["$.__views.customLocation!touchstart!buttonTouchStart"]=!0,t?g.__views.customLocation.addEventListener("touchend",t):b["$.__views.customLocation!touchend!buttonTouchEnd"]=!0,i?g.__views.customLocation.addEventListener("focus",i):b["$.__views.customLocation!focus!focus"]=!0,g.__views.newPasswordLbl=Ti.UI.createLabel({width:"85dp",height:Ti.UI.SIZE,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"newPasswordLbl",textid:"new_password"}),g.__views.__alloyId28.add(g.__views.newPasswordLbl),g.__views.password=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"password",passwordMask:"true"}),g.__views.__alloyId28.add(g.__views.password),i?g.__views.password.addEventListener("focus",i):b["$.__views.password!focus!focus"]=!0,g.__views.confirmPasswordLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"confirmPasswordLbl",textid:"confirm"}),g.__views.__alloyId28.add(g.__views.confirmPasswordLbl),g.__views.confirmPassword=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"confirmPassword",passwordMask:"true"}),g.__views.__alloyId28.add(g.__views.confirmPassword),i?g.__views.confirmPassword.addEventListener("focus",i):b["$.__views.confirmPassword!focus!focus"]=!0,g.__views.update=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"update",titleid:"update"}),g.__views.__alloyId28.add(g.__views.update),e?g.__views.update.addEventListener("touchstart",e):b["$.__views.update!touchstart!buttonTouchStart"]=!0,t?g.__views.update.addEventListener("touchend",t):b["$.__views.update!touchend!buttonTouchEnd"]=!0,g.__views.upgrade=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"upgrade",titleid:"upgrade"}),g.__views.__alloyId28.add(g.__views.upgrade),e?g.__views.upgrade.addEventListener("touchstart",e):b["$.__views.upgrade!touchstart!buttonTouchStart"]=!0,t?g.__views.upgrade.addEventListener("touchend",t):b["$.__views.upgrade!touchend!buttonTouchEnd"]=!0,g.__views.pickerWrap=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,bottom:"0",id:"pickerWrap"}),g.__views.window.add(g.__views.pickerWrap),w.destroy=function(){},_.extend(g,g.__views);var v=Alloy.createModel("profile"),m=Alloy.Globals.indicator;v.fetch({success:function(){var e=v.toJSON();g.firstName.value=e.firstName,g.lastName.value=e.lastName,g.email.value=e.email,g.phone.value=e.phone,g.address.value=e.address},error:function(){}});var A,S=!1;b["$.__views.window!open!open"]&&g.__views.window.addEventListener("open",a),b["$.__views.window!click!blur"]&&g.__views.window.addEventListener("click",o),b["$.__views.firstName!focus!focus"]&&g.__views.firstName.addEventListener("focus",i),b["$.__views.lastName!focus!focus"]&&g.__views.lastName.addEventListener("focus",i),b["$.__views.email!focus!focus"]&&g.__views.email.addEventListener("focus",i),b["$.__views.phone!focus!focus"]&&g.__views.phone.addEventListener("focus",i),b["$.__views.address!return!search"]&&g.__views.address.addEventListener("return",n),b["$.__views.customLocation!touchstart!buttonTouchStart"]&&g.__views.customLocation.addEventListener("touchstart",e),b["$.__views.customLocation!touchend!buttonTouchEnd"]&&g.__views.customLocation.addEventListener("touchend",t),b["$.__views.customLocation!focus!focus"]&&g.__views.customLocation.addEventListener("focus",i),b["$.__views.password!focus!focus"]&&g.__views.password.addEventListener("focus",i),b["$.__views.confirmPassword!focus!focus"]&&g.__views.confirmPassword.addEventListener("focus",i),b["$.__views.update!touchstart!buttonTouchStart"]&&g.__views.update.addEventListener("touchstart",e),b["$.__views.update!touchend!buttonTouchEnd"]&&g.__views.update.addEventListener("touchend",t),b["$.__views.upgrade!touchstart!buttonTouchStart"]&&g.__views.upgrade.addEventListener("touchstart",e),b["$.__views.upgrade!touchend!buttonTouchEnd"]&&g.__views.upgrade.addEventListener("touchend",t),_.extend(g,w)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;