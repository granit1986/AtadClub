function __processArg(e,t){var n=null;return e&&(n=e[t]||null,delete e[t]),n}function Controller(){function t(){var e=Alloy.Globals.geo;e.checkLocation(function(){return e.location.status!=e.errors.NONE?void Alloy.Globals.core.showErrorDialog(L(e.location.status.message)):void e.reverseGeocoding(e.location.latitude,e.location.longitude,function(e){e.error?Alloy.Globals.core.showErrorDialog(L(e.error)):(l.address.value=e.response.results[0].formatted_address,g=e.response.results[0].geometry.location.lat,m=e.response.results[0].geometry.location.lng)})})}function n(){if(!Alloy.Globals.core.apiToken()){var e=Titanium.UI.createAlertDialog({title:L("signup_or_signin_title"),message:L("signup_or_signin_message"),buttonNames:[L("no"),L("yes")],cancel:0});return e.addEventListener("click",function(e){e.cancel!==e.index&&!0!==e.cancel&&Alloy.Globals.core.activeTab("tabAccount")}),void e.show()}if(0==y.length)return void Alloy.Globals.core.showErrorDialog(L("please_select_category"));var t=Alloy.createModel("advert",{name:l.title.value,price:l.price.value,description:l.description.value,address:l.address.value,lat:parseFloat(g),lng:parseFloat(m),subCategories:JSON.stringify(y)});t.localValidate(i)&&(g&&m&&l.address.value===p||geo.geocoding(l.address.value,function(e){return e.error?void Alloy.Globals.core.showErrorDialog(L(e.error)):(t.attributes.lat=parseFloat(e.response.results[0].geometry.location.lat),t.attributes.lng=parseFloat(e.response.results[0].geometry.location.lng),void t.save({},{success:function(e,t){if(v){var n=Alloy.Globals.upload;n.start({type:n.types.advert,id:t,blob:v,onerror:function(){},onload:function(){p=!1,y=[],v=!1,l.title.value="",l.price.value="",l.description.value="",l.address.value="",l.imageView.image=null;var e=Alloy.createController("add/views/advertAdded").getView();Alloy.CFG.tabAdd.open(e)}})}else{p=!1,y=[],v=!1,l.title.value="",l.price.value="",l.description.value="",l.address.value="",l.imageView.image=null;var i=Alloy.createController("add/views/advertAdded").getView();Alloy.CFG.tabAdd.open(i)}},error:function(){var e=Alloy.createController("add/views/advertAdded").getView();Alloy.CFG.tabAdd.open(e)}}))}))}function i(e){switch(e){case f.NO_TITLE:l.title.focus();break;case f.NO_PRICE:l.price.focus();break;case f.INVALID_PRICE:l.price.focus();break;case f.NO_ADDRESS:l.address.focus()}Alloy.Globals.core.showError(e)}function r(){Alloy.CFG.tabAdd.open(Alloy.createController("subCategories/index",{categoryId:1,categoryName:L("categories"),closeCallback:function(){if(y=[],d.selectedCategories._1)for(var e in d.selectedCategories._1)y.push(d.selectedCategories._1[e])}}).getView())}function o(){Titanium.Media.openPhotoGallery({success:function(e){e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO&&(v=e.media,l.imageView.image=v,l.deleteImage.visible=!0,l.gallery.visible=!1,l.camera.visible=!1)}})}function a(){Titanium.Media.showCamera({success:function(){e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO&&(v=e.media,l.imageView.image=v,l.deleteImage.visible=!0,l.gallery.visible=!1,l.camera.visible=!1)},cancel:function(){},error:function(){}})}function s(){v=!1,l.imageView.image=null,l.deleteImage.visible=!1,l.gallery.visible=!0,l.camera.visible=!0}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="account/adverts/advert.REMOVED",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var l=this,c={},u={};l.__views.window=Ti.UI.createWindow({backgroundImage:"images/background.png",layout:"vertical",id:"window",fullscreen:"true"}),l.__views.window&&l.addTopLevelView(l.__views.window),l.__views.__alloyId34=Ti.UI.createScrollView({layout:"vertical",id:"__alloyId34"}),l.__views.window.add(l.__views.__alloyId34),l.__views.categoriesLbl=Ti.UI.createLabel({width:"80dp",height:"30dp",color:"#007aff",left:"30dp",right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},top:"30dp",text:"Category",id:"categoriesLbl"}),l.__views.__alloyId34.add(l.__views.categoriesLbl),l.__views.categories=Ti.UI.createButton({width:"180dp",height:"30dp",right:"30dp",top:"30dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:"#007aff",id:"categories",titleid:"Select"}),l.__views.__alloyId34.add(l.__views.categories),r?l.__views.categories.addEventListener("click",r):u["$.__views.categories!click!categories"]=!0,l.__views.titleLbl=Ti.UI.createLabel({width:"80dp",height:"30dp",color:"#007aff",left:"30dp",right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},top:"70dp",text:"Title",id:"titleLbl"}),l.__views.__alloyId34.add(l.__views.titleLbl),l.__views.title=Ti.UI.createTextField({width:"180dp",height:"30dp",right:"30dp",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",font:{fontSize:"13dp",fontFamily:"Arial"},backgroundColor:"#fff",top:"70dp",id:"title"}),l.__views.__alloyId34.add(l.__views.title),l.__views.priceLbl=Ti.UI.createLabel({width:"80dp",height:"30dp",color:"#007aff",left:"30dp",right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},top:"110dp",text:"Price",id:"priceLbl"}),l.__views.__alloyId34.add(l.__views.priceLbl),l.__views.price=Ti.UI.createTextField({width:"180dp",height:"30dp",right:"30dp",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",font:{fontSize:"13dp",fontFamily:"Arial"},backgroundColor:"#fff",top:"110dp",keyboardType:Titanium.UI.KEYBOARD_DECIMAL_PAD,id:"price"}),l.__views.__alloyId34.add(l.__views.price),l.__views.descriptionLbl=Ti.UI.createLabel({width:"80dp",height:"30dp",color:"#007aff",left:"30dp",right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},top:"150dp",text:"Description",id:"descriptionLbl"}),l.__views.__alloyId34.add(l.__views.descriptionLbl),l.__views.description=Ti.UI.createTextArea(function(){var e={};return _.extend(e,{width:"180dp",height:"70dp",right:"30dp",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",font:{fontSize:"13dp",fontFamily:"Arial"},backgroundColor:"#fff"}),Alloy.Globals.isHe&&_.extend(e,{textAlign:"right"}),_.extend(e,{top:"150dp",id:"description"}),e}()),l.__views.__alloyId34.add(l.__views.description),l.__views.addressLbl=Ti.UI.createLabel({width:"80dp",height:"30dp",color:"#007aff",left:"30dp",right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},top:"230dp",text:"Address",id:"addressLbl"}),l.__views.__alloyId34.add(l.__views.addressLbl),l.__views.address=Ti.UI.createTextArea(function(){var e={};return _.extend(e,{width:"180dp",height:"70dp",right:"30dp",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",font:{fontSize:"13dp",fontFamily:"Arial"},backgroundColor:"#fff"}),Alloy.Globals.isHe&&_.extend(e,{textAlign:"right"}),_.extend(e,{top:"230dp",hintText:L("address"),id:"address"}),e}()),l.__views.__alloyId34.add(l.__views.address),l.__views.currenLocationLbl=Ti.UI.createLabel({width:"150dp",height:"30dp",right:"60dp",top:"300dp",titleid:"Use my current location",font:{fontFamily:"Avenir Next Condensed",fontSize:"12dp"},color:"#555",id:"currenLocationLbl",text:"Use my current location"}),l.__views.__alloyId34.add(l.__views.currenLocationLbl),l.__views.currenLocation=Ti.UI.createButton({width:"30dp",height:"30dp",right:"30dp",top:"300dp",font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:"#007aff",backgroundImage:"images/icon_location.png",backgroundRepeat:!1,id:"currenLocation"}),l.__views.__alloyId34.add(l.__views.currenLocation),t?l.__views.currenLocation.addEventListener("click",t):u["$.__views.currenLocation!click!currenLocation"]=!0,l.__views.imageLbl=Ti.UI.createLabel({width:"80dp",height:"30dp",color:"#007aff",left:"30dp",right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"15dp",fontFamily:"Avenir Next Condensed"},top:"340dp",text:"Image",id:"imageLbl"}),l.__views.__alloyId34.add(l.__views.imageLbl),l.__views.imageView=Ti.UI.createImageView({top:"340dp",right:"30dp",width:"180pd",height:"180dp",borderColor:"#ccc",borderWidth:"1dp",backgroundColor:"#fff",id:"imageView"}),l.__views.__alloyId34.add(l.__views.imageView),l.__views.gallery=Ti.UI.createButton({width:"40dp",height:"40dp",right:"125dp",top:"410dp",zIndex:"10",backgroundColor:"#007aff",backgroundImage:"images/icon_gallery.png",id:"gallery"}),l.__views.__alloyId34.add(l.__views.gallery),o?l.__views.gallery.addEventListener("click",o):u["$.__views.gallery!click!openGallery"]=!0,l.__views.camera=Ti.UI.createButton({width:"40dp",height:"40dp",right:"75dp",top:"410dp",zIndex:"10",backgroundColor:"#007aff",backgroundImage:"images/icon_camera.png",id:"camera"}),l.__views.__alloyId34.add(l.__views.camera),a?l.__views.camera.addEventListener("click",a):u["$.__views.camera!click!showCamera"]=!0,l.__views.deleteImage=Ti.UI.createButton({width:"40dp",height:"40dp",right:"30dp",top:"480dp",zIndex:"10",backgroundColor:"#007aff",backgroundImage:"images/icon_delete.png",id:"deleteImage",visible:"false"}),l.__views.__alloyId34.add(l.__views.deleteImage),s?l.__views.deleteImage.addEventListener("click",s):u["$.__views.deleteImage!click!deleteImage"]=!0,l.__views.button=Ti.UI.createButton({width:"100dp",height:"40dp",top:"530dp",bottom:"20dp",left:"110dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:"#007aff",titleid:"Save",id:"button"}),l.__views.__alloyId34.add(l.__views.button),n?l.__views.button.addEventListener("click",n):u["$.__views.button!click!onClick"]=!0,c.destroy=function(){},_.extend(l,l.__views);var d=Alloy.Globals.core,h=Alloy.Collections.adverts.where({id:arguments[0].id})[0];l.window.title=h.attributes.name,l.title.value=h.attributes.name,l.price.value=h.attributes.price,l.description.value=h.attributes.description,l.address.value=h.attributes.address,l.imageView.image=h.attributes.image+Alloy.Globals.imageSizes.advert.edit();var f=Alloy.Globals.errors,d=Alloy.Globals.core,p=h.attributes.address,g=h.attributes.address.lat,m=h.attributes.address.lng,y=[]||JSON.parse(h.attributes.subCategories),v=h.attributes.image+Alloy.Globals.imageSizes.advert.edit();for(var w in y)d.subCategories.select({categoryId:1,id:y[w]});u["$.__views.categories!click!categories"]&&l.__views.categories.addEventListener("click",r),u["$.__views.currenLocation!click!currenLocation"]&&l.__views.currenLocation.addEventListener("click",t),u["$.__views.gallery!click!openGallery"]&&l.__views.gallery.addEventListener("click",o),u["$.__views.camera!click!showCamera"]&&l.__views.camera.addEventListener("click",a),u["$.__views.deleteImage!click!deleteImage"]&&l.__views.deleteImage.addEventListener("click",s),u["$.__views.button!click!onClick"]&&l.__views.button.addEventListener("click",n),_.extend(l,c)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;