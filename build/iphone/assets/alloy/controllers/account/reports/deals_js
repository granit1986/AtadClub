function __processArg(e,t){var o=null;return e&&(o=e[t]||null,delete e[t]),o}function Controller(){function e(t){if(!t||!t.fromAdapter){e.opts||{};for(var o=d.models,i=o.length,r=[],n=0;i>n;n++){var c=o[n];c.__transform=l(c);var u=Alloy.createController("account/reports/row",{$model:c,__parentSymbol:s});r.push(u.getViewEx({recurse:!0}))}a.__views.deals.setData(r)}}function t(){for(var e=a.deals.data[0].rows,t=e.length,o=0;t>o;o++){var l=e[o];h?(l.hasCheck=!1,t-1===o&&(Alloy.Collections.selectedDeals=[])):(l.hasCheck=!0,Alloy.Collections.selectedDeals.push({id:l.rowid,title:l.dealTitle}))}h=!h}function o(){for(var e=a.deals.data[0].rows.length,t=Alloy.Collections.selectedDeals.length,o=0;e>o;o++)for(var l=a.deals.data[0].rows[o],i=0;t>i;i++){var s=Alloy.Collections.selectedDeals[i].id;if(s===l.rowid){l.hasCheck=!0;break}}}function l(e){var t=e.toJSON();return t.price=t.currency+" "+t.price,t.images=t.images&&t.images.length>0?JSON.parse(t.images):[],t.images.length>0&&(t.image="http://"+Ti.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/image/"+t.images[0]+Alloy.Globals.imageSizes.deal.row()),t}function i(){p&&p()}if(require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="account/reports/deals",arguments[0]){var s=__processArg(arguments[0],"__parentSymbol");__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate")}var a=this,r={},n={};a.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"vertical",id:"window",fullscreen:"true",titleid:"choose_deals"}),a.__views.window&&a.addTopLevelView(a.__views.window),i?a.__views.window.addEventListener("close",i):n["$.__views.window!close!close"]=!0,a.__views.deals=Ti.UI.createTableView({backgroundColor:"transparent",id:"deals",separatorColor:"transparent"}),a.__views.window.add(a.__views.deals);var d=Alloy.Collections.deals||deals;d.on("fetch destroy change add remove reset",e),r.destroy=function(){d.off("fetch destroy change add remove reset",e)},_.extend(a,a.__views);var c=Alloy.Collections.deals,u=Alloy.Globals.indicator,p=arguments[0].callback||!1,h=!1;u.openIndicator();var y=Ti.UI.createButton({title:L("select_all")});a.window.setRightNavButton(y),c.fetch({success:function(){setTimeout(function(){u.closeIndicator(),h=c.length==Alloy.Collections.selectedDeals.length,o(),y.addEventListener("click",t)},500)},error:function(){u.closeIndicator()}}),n["$.__views.window!close!close"]&&a.__views.window.addEventListener("close",i),_.extend(a,r)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;