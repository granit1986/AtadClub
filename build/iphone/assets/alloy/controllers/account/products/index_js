function __processArg(e,t){var o=null;return e&&(o=e[t]||null,delete e[t]),o}function Controller(){function e(t){if(!t||!t.fromAdapter){e.opts||{};for(var o=a.models,l=o.length,r=[],s=0;l>s;s++){var d=o[s];d.__transform=i(d);var c=Alloy.createController("account/products/row",{$model:d});r.push(c.getViewEx({recurse:!0}))}n.__views.products.setData(r)}}function t(){c&&Alloy.Globals.core.showErrorDialog(L("can_add_product")),Ti.App.addEventListener("account:updateProducts",function(){l()}),l()}function o(){Ti.App.removeEventListener("account:updateProducts",function(){l()})}function l(){Alloy.Globals.core.apiToken()&&(u.openIndicator(),Alloy.Collections.products.fetch({success:function(){u.closeIndicator()},error:function(){u.closeIndicator()}}))}function i(e){var t=e.toJSON();return t.price=t.currency+" "+t.price,t.images=t.images&&t.images.length>0?JSON.parse(t.images):[],t.images.length>0&&(t.image="http://"+Ti.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/image/"+t.images[0]+Alloy.Globals.imageSizes.product.row()),t}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="account/products/index",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var n=this,r={},s={};n.__views.window=Ti.UI.createWindow({backgroundImage:"images/background.png",layout:"vertical",id:"window",fullscreen:"true",titleid:"my_products"}),n.__views.window&&n.addTopLevelView(n.__views.window),t?n.__views.window.addEventListener("open",t):s["$.__views.window!open!open"]=!0,o?n.__views.window.addEventListener("close",o):s["$.__views.window!close!close"]=!0,n.__views.products=Ti.UI.createTableView({backgroundColor:"#00ffffff",id:"products"}),n.__views.window.add(n.__views.products);var a=Alloy.Collections.products||products;a.on("fetch destroy change add remove reset",e),r.destroy=function(){a.off("fetch destroy change add remove reset",e)},_.extend(n,n.__views);var d=Ti.UI.createButton({titleid:"add"});d.addEventListener("click",function(){Alloy.CFG.tabAccount.open(Alloy.createController("account/products/product").getView())}),n.window.setRightNavButton(d);var c=!1;arguments[0]&&(c=arguments[0].alert||!1);var u=Alloy.Globals.indicator;s["$.__views.window!open!open"]&&n.__views.window.addEventListener("open",t),s["$.__views.window!close!close"]&&n.__views.window.addEventListener("close",o),_.extend(n,r)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;