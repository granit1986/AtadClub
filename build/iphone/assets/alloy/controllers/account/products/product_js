function __processArg(e,t){var o=null;return e&&(o=e[t]||null,delete e[t]),o}function Controller(){function e(e){t(e)}function t(e){e.source.id!==y.title.id&&y.title.blur(),e.source.id!==y.description.id&&y.description.blur(),e.source.id!==y.price.id&&y.price.blur()}function o(e){t(e)}function l(){if(b){if(y.window.title=b.name,v.openIndicator(),subCategories=JSON.parse(b.subCategories),y.title.value=b.name,y.price.value=b.price,y.description.value=b.description,y.switch_.value=b.active,y.button.title=L("update"),y.delete_button.visible=!0,b.images){b.images=JSON.parse(b.images);for(var e=0;e<b.images.length;e++)u("http://"+Ti.App.serverDomain+"/api/"+Titanium.App.ApiVersion+"/image/"+b.images[e]+Alloy.Globals.imageSizes.product.row(),b.images[e])}S="",Alloy.Globals.core.currentSection=S,I.selectedCategoriesInEdit={};for(var e=0;e<subCategories.length;++e){var t=subCategories[e];I.subCategories.select({categoryId:t.CategoryId,id:t.Id},I.selectedCategoriesInEdit)}a(),v.closeIndicator()}else I.selectedProducts={}}function i(){if(v.openIndicator(),!Alloy.Globals.core.apiToken()){var e=Titanium.UI.createAlertDialog({title:L("signup_or_signin_title"),message:L("signup_or_signin_message"),buttonNames:[L("no"),L("yes")],cancel:0});return e.addEventListener("click",function(e){v.closeIndicator(),e.cancel!==e.index&&!0!==e.cancel&&Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabAccount)}),void e.show()}if(0==subCategories.length)return v.closeIndicator(),void Alloy.Globals.core.showErrorDialog(L("please_select_category"));for(var t=[],o=0;o<subCategories.length;++o){var l=subCategories[o];t.push(l.Id?l.Id:l)}var i={name:y.title.value,price:y.price.value,description:y.description.value,subCategories:JSON.stringify(t),active:y.switch_.value};if(b&&(i.id=b.id),i=Alloy.createModel("product",i),v.closeIndicator(),i.localValidate(r)){if(1===y.images.children.length)return void Alloy.Globals.core.showErrorDialog(L("image_require"));v.openIndicator(),i.save({},{success:function(e,t){v.closeIndicator();for(var o=0;o<y.images.children.length;o++){var l=y.images.children[o].image;if(l&&!l.serverId){if("string"!=typeof l){var i=1,r=400,n=y.images.children[o],a=l.height,d=l.width,c=Ti.UI.createImageView({image:n.image,width:d,height:a});a>d?(i=d/a,c.height=r,c.width=r*i):(i=a/d,c.width=r,c.height=r*i),l=c.toImage()}images.push(l)}}if(images.length>0||imagesToDelete.length>0){var u=Alloy.Globals.upload;A.openBar(),u.start({type:u.types.product,id:t,blobs:images,"delete":JSON.stringify(imagesToDelete),onerror:function(){v.closeIndicator(),A.closeBar(),Alloy.Globals.core.showErrorDialog(L("error_loading_image"))},onload:function(){A.setBarValue(1),A.closeBar(),s()},onsendstream:function(e){A.setBarValue(e.progress),Ti.API.info("progress - "+e.progress)}})}else v.closeIndicator(),s()},error:function(e,t){if(t&&t.maxProducts){var o=Titanium.UI.createAlertDialog({title:L("upgrade_membership"),message:L("limit")+" "+t.maxProducts+" "+L("limit_products"),buttonNames:[L("upgrade"),L("OK")]});o.addEventListener("click",function(e){if(!e.index){var t=Alloy.createController("account/upgradeSelect").getView();Alloy.Globals.tabGroup.activeTab.open(t)}}),o.show()}else t&&t.Message&&Alloy.Globals.core.showErrorDialog(t.Message);v.closeIndicator()}})}}function s(){if(b)v.closeIndicator(),imagesToDelete=[],Alloy.Globals.core.showErrorDialog(L("product_updated_label")),Ti.App.fireEvent("account:updateProducts"),m&&m(),y.window.close();else{address=!1,subCategories=[],images=[],imagesToDelete=[],y.title.value="",y.price.value="",y.description.value="",y.images.removeAllChildren(),y.switch_.value=!1;var e=Titanium.UI.createAlertDialog({title:L("product_added_label")});e.addEventListener("click",function(){Ti.App.fireEvent("account:updateProducts"),y.window.close()}),e.show(),v.closeIndicator()}}function r(e){switch(e){case T.NO_TITLE:y.title.focus();break;case T.NO_PRICE:y.price.focus();break;case T.INVALID_PRICE:y.price.focus();break;case T.NO_ADDRESS:y.address.focus();break;case T.NO_DESCRIPTION:y.description.focus()}Alloy.Globals.core.showError(e)}function n(){var e=Alloy.createController("categories/index",{closeCallback:function(){if(subCategories=[],I.currentSectionCategories()._1&&I.currentSectionCategories()._1.lenght){findAdverts=!0;for(var e in I.currentSectionCategories()._1)subCategories.push(I.currentSectionCategories()._1[e])}else for(var t in I.currentSectionCategories()){var o=I.currentSectionCategories()[t];for(var e in o)subCategories.push(o[e])}a()},win:Alloy.CFG.tabAccount,forDeals:!0,sectionName:S}).getView();Alloy.CFG.tabAccount.open(e)}function a(){y.selectedCategories.text="";for(var e in I.currentSectionCategories())if(Object.size(I.currentSectionCategories()[e])>0){e=e.replace("_","");var t=Alloy.Collections.categories.get(e);t&&(y.selectedCategories.text+=""==y.selectedCategories.text?t.attributes.name:", "+t.attributes.name)}}function d(){x.show()}function c(){Titanium.Media.openPhotoGallery({success:function(e){e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO&&u(e.media)}})}function c(){Titanium.Media.openPhotoGallery({success:function(e){e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO&&u(e.media)}})}function u(e,t){v.openIndicator();var o=Ti.UI.createImageView({image:e,width:"55dp",height:"55dp",right:"5dp",bottom:"5dp",serverId:t||!1}),l=y.addPhoto;y.images.remove(y.addPhoto),y.images.add(o),y.images.add(l),v.closeIndicator(),y.howToDeleteImageLbl.visible=!0,C++}function h(){Titanium.Media.showCamera({success:function(e){e.mediaType==Titanium.Media.MEDIA_TYPE_PHOTO&&u(e.media)},cancel:function(){},error:function(){}})}function p(e){"[object TiUIImageView]"===e.source.toString()&&(e.source.serverId&&imagesToDelete.push(e.source.serverId),y.images.remove(e.source),C--,0==C&&(y.howToDeleteImageLbl.visible=!1))}function f(){var e=Titanium.UI.createAlertDialog({title:L("delete_product_title"),message:L("delete_product_message"),buttonNames:[L("no"),L("yes")],cancel:0});e.addEventListener("click",function(e){1==e.index&&Alloy.Collections.products.where({id:b.id})[0].destroy({success:function(){Ti.App.fireEvent("account:updateProducts"),m&&m(),y.window.close()},error:function(){}})}),e.show()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="account/products/product",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var y=this,g={},w={};y.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"vertical",id:"window",fullscreen:"true",titleid:"win_new_product"}),y.__views.window&&y.addTopLevelView(y.__views.window),e?y.__views.window.addEventListener("click",e):w["$.__views.window!click!blur"]=!0,l?y.__views.window.addEventListener("open",l):w["$.__views.window!open!open"]=!0,y.__views.__alloyId89=Ti.UI.createScrollView({layout:"vertical",left:"20dp",right:"20dp",id:"__alloyId89"}),y.__views.window.add(y.__views.__alloyId89),y.__views.__alloyId90=Ti.UI.createView({height:"20dp",width:Ti.UI.FILL,id:"__alloyId90"}),y.__views.__alloyId89.add(y.__views.__alloyId90),y.__views.categoriesLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"categoriesLbl",textid:"categories"}),y.__views.__alloyId89.add(y.__views.categoriesLbl),y.__views.categories=Ti.UI.createButton({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,textAlign:"left",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,title:"",id:"categories"}),y.__views.__alloyId89.add(y.__views.categories),n?y.__views.categories.addEventListener("click",n):w["$.__views.categories!click!categories"]=!0,y.__views.__alloyId91=Ti.UI.createLabel({width:Ti.UI.SIZE,left:"5dp",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:"15dp",fontFamily:"Arial"},textid:"select_category",id:"__alloyId91"}),y.__views.categories.add(y.__views.__alloyId91),y.__views.selectedCategories=Ti.UI.createLabel({height:"20dp",left:"52dp",right:"15dp",top:"7dp",color:"#aaa",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:"12dp",fontFamily:"Arial"},id:"selectedCategories"}),y.__views.categories.add(y.__views.selectedCategories),y.__views.__alloyId92=Ti.UI.createLabel({width:"20dp",height:"20dp",right:"5dp",top:"5dp",backgroundImage:"images/icon_listItem.png",backgroundRepeat:!1,id:"__alloyId92"}),y.__views.categories.add(y.__views.__alloyId92),y.__views.titleLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"titleLbl",textid:"title"}),y.__views.__alloyId89.add(y.__views.titleLbl),y.__views.title=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"title"}),y.__views.__alloyId89.add(y.__views.title),o?y.__views.title.addEventListener("focus",o):w["$.__views.title!focus!focus"]=!0,y.__views.priceLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"priceLbl",textid:"price"}),y.__views.__alloyId89.add(y.__views.priceLbl),y.__views.price=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"price",keyboardType:Ti.UI.KEYBOARD_DECIMAL_PAD}),y.__views.__alloyId89.add(y.__views.price),o?y.__views.price.addEventListener("focus",o):w["$.__views.price!focus!focus"]=!0,y.__views.descriptionLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"descriptionLbl",textid:"description"}),y.__views.__alloyId89.add(y.__views.descriptionLbl),y.__views.description=Ti.UI.createTextArea(function(){var e={};return Alloy.Globals.isHe&&_.extend(e,{textAlign:"right"}),_.extend(e,{width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputAreaHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"description",suppressReturn:"false",returnKeyType:Ti.UI.RETURNKEY_NEXT}),e}()),y.__views.__alloyId89.add(y.__views.description),o?y.__views.description.addEventListener("focus",o):w["$.__views.description!focus!focus"]=!0,y.__views.imageLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"imageLbl",textid:"images"}),y.__views.__alloyId89.add(y.__views.imageLbl),y.__views.__alloyId93=Ti.UI.createView({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:Alloy.Globals.Styles.inputUp,left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",id:"__alloyId93"}),y.__views.__alloyId89.add(y.__views.__alloyId93),y.__views.images=Ti.UI.createView({height:Ti.UI.SIZE,top:"5dp",left:"5dp",id:"images",layout:"horizontal"}),y.__views.__alloyId93.add(y.__views.images),p?y.__views.images.addEventListener("click",p):w["$.__views.images!click!onClickImages"]=!0,y.__views.addPhoto=Ti.UI.createButton({width:"56dp",height:"56dp",right:"5dp",bottom:"5dp",backgroundColor:Alloy.Globals.Styles.buttonBg,backgroundImage:"images/icon_gallery.png",id:"addPhoto"}),y.__views.images.add(y.__views.addPhoto),d?y.__views.addPhoto.addEventListener("click",d):w["$.__views.addPhoto!click!addPhoto"]=!0,y.__views.howToDeleteImageLbl=Ti.UI.createLabel({width:Ti.UI.FILL,height:"20dp",bottom:"10dp",textAlign:Alloy.Globals.Styles.imageSelectTipTextAlign,font:{fontFamily:"Avenir Next Condensed",fontSize:"12dp"},color:"#555",id:"howToDeleteImageLbl",textid:"tap_to_delete_image",visible:"false"}),y.__views.__alloyId89.add(y.__views.howToDeleteImageLbl),y.__views.switchLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"switchLbl",textid:"active"}),y.__views.__alloyId89.add(y.__views.switchLbl),y.__views.switch_=Ti.UI.createSwitch({height:Alloy.Globals.Styles.inputAreaHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,value:!0,id:"switch_"}),y.__views.__alloyId89.add(y.__views.switch_),y.__views.button=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,titleid:"add_product_button",id:"button"}),y.__views.__alloyId89.add(y.__views.button),i?y.__views.button.addEventListener("click",i):w["$.__views.button!click!onClick"]=!0,y.__views.delete_button=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,titleid:"delete_product_button",id:"delete_button",visible:"false"}),y.__views.__alloyId89.add(y.__views.delete_button),f?y.__views.delete_button.addEventListener("click",f):w["$.__views.delete_button!click!deleteProduct"]=!0,g.destroy=function(){},_.extend(y,y.__views);var b=!1;arguments[0]&&arguments[0].productId&&(b=Alloy.Collections.products.where({id:arguments[0].productId})[0].toJSON());var v=Alloy.Globals.indicator,m=!1,A=Alloy.Globals.progress;arguments[0]&&arguments[0].callback&&(m=arguments[0].callback);var S="products",T=Alloy.Globals.errors,I=Alloy.Globals.core;subCategories=[],images=[],imagesToDelete=[];var G={options:["Make Photo","Choose Photo","Cancel"],cancel:2},x=Titanium.UI.createOptionDialog(G);x.addEventListener("click",function(e){0==e.index&&h(),1==e.index&&c()});var C=0;w["$.__views.window!click!blur"]&&y.__views.window.addEventListener("click",e),w["$.__views.window!open!open"]&&y.__views.window.addEventListener("open",l),w["$.__views.categories!click!categories"]&&y.__views.categories.addEventListener("click",n),w["$.__views.title!focus!focus"]&&y.__views.title.addEventListener("focus",o),w["$.__views.price!focus!focus"]&&y.__views.price.addEventListener("focus",o),w["$.__views.description!focus!focus"]&&y.__views.description.addEventListener("focus",o),w["$.__views.images!click!onClickImages"]&&y.__views.images.addEventListener("click",p),w["$.__views.addPhoto!click!addPhoto"]&&y.__views.addPhoto.addEventListener("click",d),w["$.__views.button!click!onClick"]&&y.__views.button.addEventListener("click",i),w["$.__views.delete_button!click!deleteProduct"]&&y.__views.delete_button.addEventListener("click",f),_.extend(y,g)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;