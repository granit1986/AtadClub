function __processArg(e,t){var o=null;return e&&(o=e[t]||null,delete e[t]),o}function Controller(){function e(e){t(e)}function t(e){e.source.id!==w.login.id&&w.login.blur(),e.source.id!==w.password.id&&w.password.blur()}function o(e){t(e)}function l(e){e.source.backgroundColor="facebookSignIn"===e.source.id?"#193776":Alloy.Globals.Styles.buttonBgOnTap}function i(e){S.openIndicator(),e.source.backgroundColor="facebookSignIn"===e.source.id?"#3b5998":Alloy.Globals.Styles.buttonBg,n(e)}function s(e){e.source.color="#008aa9"}function a(e){S.openIndicator(),e.source.color="#00accb","resetPassword"==e.source.id&&c()}function r(){var e=w.login.value;Ti.App.fireEvent("app:userblocked",{email:e}),Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabContact),w.sendAdmin.visible=!1,w.sendAdmin.height=0}function n(e){switch(e.source.id){case"facebookSignIn":u();break;case"signIn":h(e);break;case"signUp":f(e)}}function d(){var e=Ti.UI.createWindow({top:0,left:0,layout:"absolute",backgroundColor:"rgba(255,255,255,0.7)"}),t=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,bottom:"0"}),o=Alloy.Globals.core.currencyItems,l=0,i=Alloy.createController("picker/genericPicker",{items:o,rowIndex:l,callback:function(t,o){t.data&&(v=t.data.id),o&&(Alloy.Globals.profile.supplier&&Ti.App.fireEvent("account:itIsSupplier"),Alloy.Globals.chat.openConnect(),e.close(),m.set("currencyCode",v),m.save({},{}))}}).getView();t.add(i),e.add(t),e.open()}function c(){var e=Alloy.createModel("reset",{email:w.login.value});e.localValidate(y)&&e.save({},{success:function(e,t){Alloy.Globals.core.showErrorDialog(L(t)),S.closeIndicator(),w.resetPasswordWrap.visible=!1,w.resetPasswordWrap.height=0},error:function(e,t){t&&t.Message&&Alloy.Globals.core.showErrorDialog(L(t.Message)),S.closeIndicator()}})}function u(){Ti.Facebook.appid="1437623056473639",Ti.Facebook.permissions=["publish_stream","offline_access","email"],Ti.Facebook.addEventListener("login",p),Ti.Facebook.authorize()}function p(e){e.success?(e.data.email||(e.data.email=e.data.username+"@facebook.com"),I(e.data)):e.error?(Alloy.Globals.core.showErrorDialog(e.error),S.closeIndicator()):e.cancelled&&(Alloy.Globals.core.showErrorDialog("Canceled"),S.closeIndicator()),Ti.Facebook.removeEventListener("login",p)}function h(){var e=Alloy.createModel("signin",{login:w.login.value,password:w.password.value,appInstallId:Alloy.Globals.core.installId,appVersion:Ti.App.version,platformModel:Ti.Platform.model,platformVersion:Ti.Platform.version,platformOSName:Ti.Platform.osname,language:Ti.Locale.currentLanguage});e.localValidate(y)&&e.save({},{success:function(e,t){w.sendAdmin.visible=!1,w.sendAdmin.height=0,Alloy.Globals.core.apiToken(t.UUID),S.closeIndicator(),w.resetPasswordWrap.visible=!1,w.resetPasswordWrap.height=0,Ti.App.fireEvent("account:updateProfile"),Alloy.Collections.adverts=Alloy.createCollection("advert"),Ti.App.fireEvent("account:showAccount")},error:function(e,t){S.closeIndicator(),t&&t.Message?(Alloy.Globals.core.showErrorDialog(L(t.Message)),w.resetPasswordWrap.visible=!0,w.resetPasswordWrap.height=Ti.UI.SIZE):t&&!t.blocked?Alloy.Globals.core.showErrorDialog(L("not_signed")):t&&t.blocked&&(w.sendAdmin.visible=!0,w.sendAdmin.height=Ti.UI.SIZE)}})}function y(e){switch(e){case A.NO_EMAIL:case A.INVALID_EMAIL:w.login.focus();break;case A.NO_PASSWORD:w.password.focus();break;case A.NOT_SIGNED:w.login.focus()}S.closeIndicator(),Alloy.Globals.core.showError(e)}function f(){S.closeIndicator(),Ti.App.fireEvent("account:showSignUp")}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="account/sign/in_",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var w=this,g={},b={};w.__views.in_=Ti.UI.createScrollView({layout:"vertical",left:"20dp",right:"20dp",id:"in_"}),w.__views.in_&&w.addTopLevelView(w.__views.in_),e?w.__views.in_.addEventListener("click",e):b["$.__views.in_!click!blur"]=!0,w.__views.__alloyId115=Ti.UI.createLabel({height:"80dp",width:Ti.UI.FILL,textAlign:"center",color:Alloy.Globals.Styles.titleColor,font:{fontSize:"25dp",fontFamily:"OleoScriptSwashCaps-Regular"},textid:"signin",id:"__alloyId115"}),w.__views.in_.add(w.__views.__alloyId115),w.__views.loginLbl=Ti.UI.createLabel({width:"95dp",height:Ti.UI.SIZE,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"loginLbl",textid:"login"}),w.__views.in_.add(w.__views.loginLbl),w.__views.login=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"login",keyboardType:Ti.UI.KEYBOARD_EMAIL}),w.__views.in_.add(w.__views.login),o?w.__views.login.addEventListener("focus",o):b["$.__views.login!focus!focus"]=!0,w.__views.passwordLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"passwordLbl",textid:"password"}),w.__views.in_.add(w.__views.passwordLbl),w.__views.password=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"0",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"password",passwordMask:"true"}),w.__views.in_.add(w.__views.password),o?w.__views.password.addEventListener("focus",o):b["$.__views.password!focus!focus"]=!0,w.__views.resetPasswordWrap=Ti.UI.createView({id:"resetPasswordWrap",height:"0",visible:"false",layout:"vertical"}),w.__views.in_.add(w.__views.resetPasswordWrap),w.__views.__alloyId116=Ti.UI.createLabel({width:Ti.UI.FILL,height:"15dp",textAlign:Alloy.Globals.Styles.imageSelectTipTextAlign,font:{fontFamily:"Avenir Next Condensed",fontSize:"16dp"},color:"#555",text:"That's not the right password.",textid:"not_right_pass",id:"__alloyId116"}),w.__views.resetPasswordWrap.add(w.__views.__alloyId116),w.__views.resetPassword=Ti.UI.createLabel({width:Ti.UI.FILL,height:"15dp",textAlign:Alloy.Globals.Styles.imageSelectTipTextAlign,font:{fontFamily:"Avenir Next Condensed",fontSize:"16dp"},color:"#00accb",text:"Please try again or request a new one.",id:"resetPassword",textid:"try_again_or_rquest"}),w.__views.resetPasswordWrap.add(w.__views.resetPassword),s?w.__views.resetPassword.addEventListener("touchstart",s):b["$.__views.resetPassword!touchstart!linkTouchStart"]=!0,a?w.__views.resetPassword.addEventListener("touchend",a):b["$.__views.resetPassword!touchend!linkTouchEnd"]=!0,w.__views.sendAdmin=Ti.UI.createView({id:"sendAdmin",height:"0",visible:"false",layout:"vertical"}),w.__views.in_.add(w.__views.sendAdmin),w.__views.__alloyId117=Ti.UI.createLabel({width:"190dp",height:Ti.UI.SIZE,textAlign:Alloy.Globals.Styles.imageSelectTipTextAlign,font:{fontFamily:"Avenir Next Condensed",fontSize:"16dp"},color:"#555",textid:"blocked",right:"0",id:"__alloyId117"}),w.__views.sendAdmin.add(w.__views.__alloyId117),w.__views.__alloyId118=Ti.UI.createLabel({width:Ti.UI.FILL,height:"15dp",textAlign:Alloy.Globals.Styles.imageSelectTipTextAlign,font:{fontFamily:"Avenir Next Condensed",fontSize:"16dp"},color:"#00accb",textid:"contact_administrator",id:"__alloyId118"}),w.__views.sendAdmin.add(w.__views.__alloyId118),r?w.__views.__alloyId118.addEventListener("click",r):b["$.__views.__alloyId118!click!contactClick"]=!0,w.__views.__alloyId119=Ti.UI.createView({height:"20dp",width:Ti.UI.FILL,id:"__alloyId119"}),w.__views.in_.add(w.__views.__alloyId119),w.__views.signIn=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"signIn",titleid:"signin"}),w.__views.in_.add(w.__views.signIn),l?w.__views.signIn.addEventListener("touchstart",l):b["$.__views.signIn!touchstart!buttonTouchStart"]=!0,i?w.__views.signIn.addEventListener("touchend",i):b["$.__views.signIn!touchend!buttonTouchEnd"]=!0,w.__views.facebookSignIn=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:"#3b5998",id:"facebookSignIn",titleid:"facebook_signin"}),w.__views.in_.add(w.__views.facebookSignIn),l?w.__views.facebookSignIn.addEventListener("touchstart",l):b["$.__views.facebookSignIn!touchstart!buttonTouchStart"]=!0,i?w.__views.facebookSignIn.addEventListener("touchend",i):b["$.__views.facebookSignIn!touchend!buttonTouchEnd"]=!0,w.__views.signUp=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"signUp",titleid:"signup"}),w.__views.in_.add(w.__views.signUp),l?w.__views.signUp.addEventListener("touchstart",l):b["$.__views.signUp!touchstart!buttonTouchStart"]=!0,i?w.__views.signUp.addEventListener("touchend",i):b["$.__views.signUp!touchend!buttonTouchEnd"]=!0,g.destroy=function(){},_.extend(w,w.__views);var v,m,A=Alloy.Globals.errors,S=Alloy.Globals.indicator,I=function(e){var t=Alloy.createModel("facebooklogin",{firstName:e.first_name,lastName:e.last_name,email:e.email,facebookId:e.id,appInstallId:Alloy.Globals.core.installId,appVersion:Ti.App.version,platformModel:Ti.Platform.model,platformVersion:Ti.Platform.version,platformOSName:Ti.Platform.osname,language:Ti.Locale.currentLanguage,currency:v});t.localValidate(y)&&t.save({},{success:function(e,t){Alloy.Globals.core.apiToken(t.UUID),m=Alloy.createModel("profile"),m.fetch({success:function(){w.resetPasswordWrap.visible=!1,w.resetPasswordWrap.height=0,w.sendAdmin.visible=!1,w.sendAdmin.height=0,S.closeIndicator(),Alloy.Globals.profile=m.toJSON(),Alloy.Globals.profile.supplier&&Ti.App.fireEvent("account:itIsSupplier"),Alloy.Globals.profile.currency||null!==Alloy.Globals.profile.currency?Ti.App.fireEvent("account:updateProfile"):d()},error:function(){S.closeIndicator()}}),Alloy.Collections.adverts=Alloy.createCollection("advert"),Ti.App.fireEvent("account:showAccount")},error:function(e,t){S.closeIndicator(),t&&!t.blocked?y(A.CAN_NOT_CREATE_ACCOUNT):w.sendAdmin.visible=!0,w.sendAdmin.height=Ti.UI.SIZE}})};b["$.__views.in_!click!blur"]&&w.__views.in_.addEventListener("click",e),b["$.__views.login!focus!focus"]&&w.__views.login.addEventListener("focus",o),b["$.__views.password!focus!focus"]&&w.__views.password.addEventListener("focus",o),b["$.__views.resetPassword!touchstart!linkTouchStart"]&&w.__views.resetPassword.addEventListener("touchstart",s),b["$.__views.resetPassword!touchend!linkTouchEnd"]&&w.__views.resetPassword.addEventListener("touchend",a),b["$.__views.__alloyId118!click!contactClick"]&&w.__views.__alloyId118.addEventListener("click",r),b["$.__views.signIn!touchstart!buttonTouchStart"]&&w.__views.signIn.addEventListener("touchstart",l),b["$.__views.signIn!touchend!buttonTouchEnd"]&&w.__views.signIn.addEventListener("touchend",i),b["$.__views.facebookSignIn!touchstart!buttonTouchStart"]&&w.__views.facebookSignIn.addEventListener("touchstart",l),b["$.__views.facebookSignIn!touchend!buttonTouchEnd"]&&w.__views.facebookSignIn.addEventListener("touchend",i),b["$.__views.signUp!touchstart!buttonTouchStart"]&&w.__views.signUp.addEventListener("touchstart",l),b["$.__views.signUp!touchend!buttonTouchEnd"]&&w.__views.signUp.addEventListener("touchend",i),_.extend(w,g)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;