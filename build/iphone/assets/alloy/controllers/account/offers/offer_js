function __processArg(e,t){var o=null;return e&&(o=e[t]||null,delete e[t]),o}function Controller(){function e(){Alloy.Collections.offers.fetch({success:function(){},error:function(){}})}function t(e){e.source.id!==d.answer.id&&d.answer.blur()}function o(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBgOnTap}function i(e){f.openIndicator(),e.source.backgroundColor=Alloy.Globals.Styles.buttonBg,"accept"==e.source.id?r():"decline"==e.source.id&&a()}function l(){f.openIndicator(),h.fetch({data:{id:p},success:function(){switch(offer=h.where({id:p})[0].toJSON(),d.advert.text=offer.advert,offer.imageId&&(d.imageLbl.visible=!0,image=offer.imageServer+"/"+offer.imageId+Alloy.Globals.imageSizes.supplier.edit(),d.imageView.image=image,d.imageView.height=Ti.UI.SIZE,d.imageView.bottom="10dp",d.scrollView.remove(d.price),d.scrollView.remove(d.priceLbl)),d.user.text=offer.user,d.email.text=offer.email,d.phone.text=offer.phone,offer.state){case 1:default:offer.state=L("new"),d.accept.visible=!0,d.decline.visible=!0,d.answerLbl.visible=!0,d.answer.visible=!0;break;case 3:offer.state=L("declined"),d.answerLbl.visible=!0;break;case 4:offer.state=L("accepted"),d.answerLbl.visible=!0}d.state.text=offer.state,offer.price&&(d.price.visible=!0,d.priceLbl.visible=!0,d.price.text=offer.price,d.scrollView.remove(d.imageLbl),d.scrollView.remove(d.imageView)),d.description.text=offer.description,""!==offer.answer&&(d.answerMsg.text=offer.answer,d.answerMsg.show(),d.scrollView.remove(d.answer)),f.closeIndicator()},error:function(){f.closeIndicator()}})}function n(){}function s(){Titanium.Platform.openURL("tel:"+offer.phone)}function r(){var e=Alloy.createModel("offer",{id:offer.id,answer:d.answer.value,state:4});e.save({},{success:function(){f.closeIndicator(),d.accept.visible=!1,d.decline.visible=!1,d.answerMsg.text=d.answer.value,d.scrollView.remove(d.answer),d.answerMsg.visible=!0,d.state.text=L("accepted"),Ti.App.fireEvent("offers:update")},error:function(){f.closeIndicator()}})}function a(){var e=Alloy.createModel("offer",{id:offer.id,answer:d.answer.value,state:3});e.save({},{success:function(){f.closeIndicator(),d.accept.visible=!1,d.decline.visible=!1,d.state.text=L("declined"),d.answerMsg.text=d.answer.value,d.scrollView.remove(d.answer),d.answerMsg.visible=!0,Ti.App.fireEvent("offers:update")},error:function(){f.closeIndicator()}})}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="account/offers/offer",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var d=this,c={},u={};d.__views.window=Ti.UI.createWindow({backgroundImage:"images/background.png",layout:"vertical",fullscreen:"true",id:"window",titleid:"offer"}),d.__views.window&&d.addTopLevelView(d.__views.window),l?d.__views.window.addEventListener("open",l):u["$.__views.window!open!open"]=!0,e?d.__views.window.addEventListener("close",e):u["$.__views.window!close!close"]=!0,t?d.__views.window.addEventListener("click",t):u["$.__views.window!click!blur"]=!0,d.__views.scrollView=Ti.UI.createScrollView({layout:"vertical",left:"20dp",right:"20dp",id:"scrollView"}),d.__views.window.add(d.__views.scrollView),d.__views.__alloyId66=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"advert",id:"__alloyId66"}),d.__views.scrollView.add(d.__views.__alloyId66),d.__views.advert=Ti.UI.createLabel({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"-28dp",bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,right:Alloy.Globals.Styles.inputRight,textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},color:"#555",id:"advert"}),d.__views.scrollView.add(d.__views.advert),d.__views.fromLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"from",id:"fromLbl"}),d.__views.scrollView.add(d.__views.fromLbl),d.__views.user=Ti.UI.createLabel({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"-28dp",bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,right:Alloy.Globals.Styles.inputRight,textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},color:"#555",id:"user"}),d.__views.scrollView.add(d.__views.user),d.__views.__alloyId67=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"__alloyId67"}),d.__views.scrollView.add(d.__views.__alloyId67),d.__views.email=Ti.UI.createLabel({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"-28dp",bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,right:Alloy.Globals.Styles.inputRight,textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},color:"#555",id:"email"}),d.__views.scrollView.add(d.__views.email),n?d.__views.email.addEventListener("click",n):u["$.__views.email!click!onClickEmail"]=!0,d.__views.__alloyId68=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"__alloyId68"}),d.__views.scrollView.add(d.__views.__alloyId68),d.__views.phone=Ti.UI.createLabel({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"-28dp",bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,right:Alloy.Globals.Styles.inputRight,textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},color:"#555",id:"phone"}),d.__views.scrollView.add(d.__views.phone),s?d.__views.phone.addEventListener("click",s):u["$.__views.phone!click!phoneCall"]=!0,d.__views.imageLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"imageLbl",textid:"barter_image"}),d.__views.scrollView.add(d.__views.imageLbl),d.__views.imageView=Ti.UI.createImageView({width:Alloy.Globals.Styles.inputWidth,bottom:"40dp",top:Alloy.Globals.Styles.inputUp,left:Alloy.Globals.Styles.inputLeft,id:"imageView"}),d.__views.scrollView.add(d.__views.imageView),d.__views.priceLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"priceLbl",textid:"price",visible:"false"}),d.__views.scrollView.add(d.__views.priceLbl),d.__views.price=Ti.UI.createLabel({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"-28dp",bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,right:Alloy.Globals.Styles.inputRight,textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},color:"#555",id:"price",visible:"false"}),d.__views.scrollView.add(d.__views.price),d.__views.__alloyId69=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"description",id:"__alloyId69"}),d.__views.scrollView.add(d.__views.__alloyId69),d.__views.description=Ti.UI.createLabel({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"-28dp",bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,right:Alloy.Globals.Styles.inputRight,textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},color:"#555",id:"description"}),d.__views.scrollView.add(d.__views.description),d.__views.__alloyId70=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"state",id:"__alloyId70"}),d.__views.scrollView.add(d.__views.__alloyId70),d.__views.state=Ti.UI.createLabel({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"-28dp",bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,right:Alloy.Globals.Styles.inputRight,textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},color:"#555",id:"state"}),d.__views.scrollView.add(d.__views.state),d.__views.answerLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"answerLbl",textid:"answer",visible:"false"}),d.__views.scrollView.add(d.__views.answerLbl),d.__views.answer=Ti.UI.createTextArea(function(){var e={};return _.extend(e,{top:"-30dp",width:"180dp",height:"70dp",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",font:{fontSize:"13dp",fontFamily:"Arial"},backgroundColor:"#fff"}),Alloy.Globals.isHe&&_.extend(e,{textAlign:"right"}),_.extend(e,{width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputAreaHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"answer",visible:"false"}),e}()),d.__views.scrollView.add(d.__views.answer),d.__views.answerMsg=Ti.UI.createLabel({width:Alloy.Globals.Styles.inputWidth,height:Ti.UI.SIZE,top:"-28dp",bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,right:Alloy.Globals.Styles.inputRight,textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},color:"#555",id:"answerMsg",visible:"false"}),d.__views.scrollView.add(d.__views.answerMsg),d.__views.accept=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"accept",titleid:"accept",visible:"false"}),d.__views.scrollView.add(d.__views.accept),o?d.__views.accept.addEventListener("touchstart",o):u["$.__views.accept!touchstart!buttonTouchStart"]=!0,i?d.__views.accept.addEventListener("touchend",i):u["$.__views.accept!touchend!buttonTouchEnd"]=!0,d.__views.decline=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,id:"decline",titleid:"decline",visible:"false"}),d.__views.scrollView.add(d.__views.decline),o?d.__views.decline.addEventListener("touchstart",o):u["$.__views.decline!touchstart!buttonTouchStart"]=!0,i?d.__views.decline.addEventListener("touchend",i):u["$.__views.decline!touchend!buttonTouchEnd"]=!0,c.destroy=function(){},_.extend(d,d.__views);var h=Alloy.createCollection("offer"),f=Alloy.Globals.indicator,p=arguments[0].offerId;u["$.__views.window!open!open"]&&d.__views.window.addEventListener("open",l),u["$.__views.window!close!close"]&&d.__views.window.addEventListener("close",e),u["$.__views.window!click!blur"]&&d.__views.window.addEventListener("click",t),u["$.__views.email!click!onClickEmail"]&&d.__views.email.addEventListener("click",n),u["$.__views.phone!click!phoneCall"]&&d.__views.phone.addEventListener("click",s),u["$.__views.accept!touchstart!buttonTouchStart"]&&d.__views.accept.addEventListener("touchstart",o),u["$.__views.accept!touchend!buttonTouchEnd"]&&d.__views.accept.addEventListener("touchend",i),u["$.__views.decline!touchstart!buttonTouchStart"]&&d.__views.decline.addEventListener("touchstart",o),u["$.__views.decline!touchend!buttonTouchEnd"]&&d.__views.decline.addEventListener("touchend",i),_.extend(d,c)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;