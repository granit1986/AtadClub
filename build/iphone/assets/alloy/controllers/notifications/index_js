function __processArg(e,t){var l=null;return e&&(l=e[t]||null,delete e[t]),l}function Controller(){function e(e){e.source.id!==w.period.id&&e.source.id!==w.for_.id&&e.source.id!==w.start.id&&e.source.id!==w.end.id&&w.pickerWrap.removeAllChildren()}function t(){C=!0;for(var e=0,t=0;t<G.length;t++){var l=G[t];if(l.data.id==f)break;e++}U=e,w.period.value=G[U].title;var i=new Date,a=new Date(i.getFullYear(),i.getMonth(),i.getDate(),9,0,0);V=a,w.start.value=a.toLocaleTimeString(),A=60*a.getUTCHours()+a.getUTCMinutes();var s=new Date(i.getFullYear(),i.getMonth(),i.getDate(),19,0,0);F=s,w.end.value=s.toLocaleTimeString(),I=60*s.getUTCHours()+s.getUTCMinutes(),o(S),v.selectedNotificationsCategories={},m>0&&(N=m-1),w.for_.value=T[N].title,p()}function l(){if(E=Alloy.Globals.notify){h=JSON.parse(E.subCategories),v.currentSection=x,v.selectedNotificationsCategories={};for(var e=0;e<h.length;++e){var t=h[e];v.subCategories.select({categoryId:t.CategoryId,id:t.Id},v.selectedNotificationsCategories)}a(),f=E.period,m=E.for_,A=E.from,I=E.to,S=E.distance,m>0&&(N=m-1),w.for_.value=T[N].title;for(var l=0,e=0;e<G.length;e++){var i=G[e];if(i.data.id==f)break;l++}if(U=l,w.period.value=G[U].title,A>0){var s=Alloy.Globals.core.createTime(A);w.start.value=s.toLocaleTimeString(),V=s}if(I>0){var s=Alloy.Globals.core.createTime(I);w.end.value=s.toLocaleTimeString(),F=s}o(S),Ti.App.fireEvent("home:defaultsearch")}}function o(e){switch(e){case 100:w.scrollView.contentOffset={x:0,y:0};break;case 250:w.scrollView.contentOffset={x:65,y:0};break;case 500:w.scrollView.contentOffset={x:130,y:0};break;case 750:w.scrollView.contentOffset={x:195,y:0};break;case 1e3:w.scrollView.contentOffset={x:260,y:0};break;case 2e3:w.scrollView.contentOffset={x:325,y:0}}}function i(){var e=Alloy.createController("categories/index",{closeCallback:function(){h=[];for(var e in v.selectedNotificationsCategories){var t=v.selectedNotificationsCategories[e];for(var l in t)h.push(t[l])}a()},sectionName:x,win:Alloy.CFG.tabNotifications,forDeals:!0}).getView();Ti.API.info("view created"),Alloy.CFG.tabNotifications.open(e)}function a(){w.selectedCategories.text="";for(var e in v.currentSectionCategories())if(Object.size(v.currentSectionCategories()[e])>0){e=e.replace("_","");var t=Alloy.Collections.categories.get(e);t&&(w.selectedCategories.text+=""==w.selectedCategories.text?t.attributes.name:", "+t.attributes.name)}}function s(){var e=Alloy.createController("picker/genericPicker",{items:G,rowIndex:U,callback:function(e,t,l){w.period.value=e.title?e.title:e,e.data&&(f=e.data.id),l>=0&&(U=l),t&&w.pickerWrap.removeAllChildren()}}).getView();w.pickerWrap.removeAllChildren(),w.pickerWrap.add(e)}function r(){var e=Alloy.createController("picker/genericPicker",{items:T,rowIndex:N,callback:function(e,t,l){w.for_.value=e.title?e.title:e,e.data&&(m=e.data.id),l>=0&&(N=l),t&&w.pickerWrap.removeAllChildren()}}).getView();w.pickerWrap.removeAllChildren(),w.pickerWrap.add(e)}function n(){var e=Alloy.createController("picker/time",{maxTime:F,callback:function(e,t){V=e,A=60*e.getUTCHours()+e.getUTCMinutes(),w.start.value=e.toLocaleTimeString(),Ti.API.info(e.getUTCHours(),e.getUTCMinutes(),A),t&&w.pickerWrap.removeAllChildren()}}).getView();w.pickerWrap.removeAllChildren(),w.pickerWrap.add(e)}function d(){var e=Alloy.createController("picker/time",{minTime:V,callback:function(e,t){F=e,I=60*e.getUTCHours()+e.getUTCMinutes(),w.end.value=e.toLocaleTimeString(),Ti.API.info(e.getUTCHours(),e.getUTCMinutes(),A),t&&w.pickerWrap.removeAllChildren()}}).getView();w.pickerWrap.removeAllChildren(),w.pickerWrap.add(e)}function c(){k.openIndicator();for(var e=[],t=0;t<h.length;++t){var l=h[t];e.push(l.Id?l.Id:l)}var o=Alloy.Globals.core.deviceToken;"Simulator"==Ti.Platform.model&&(o="fake_device_ token");var i=Alloy.createModel("notify",{deviceToken:o,subCategories:JSON.stringify(e),period:f,for_:m,from:A,to:I,distance:S,appInstallId:Alloy.Globals.core.installId,appVersion:Ti.App.version,platformModel:Ti.Platform.model,platformVersion:Ti.Platform.version,platformOSName:Ti.Platform.osname,language:Ti.Locale.currentLanguage,offset:(new Date).getTimezoneOffset()}),a=Alloy.Globals.geo;a.checkLocation(function(){i.attributes.lat=a.location.latitude,i.attributes.lng=a.location.longitude,i.save({},{success:function(){if(k.closeIndicator(),Ti.API.info(C),!C){var e=Titanium.UI.createAlertDialog({title:L("notyfication_settings_updated")});e.addEventListener("click",function(){Ti.App.fireEvent("home:defaultsearch"),Alloy.Globals.tabGroup.setActiveTab(Alloy.CFG.tabHome)}),e.show()}i=i.toJSON(),Alloy.Globals.notify={id:i.id,subCategories:i.subcategories,period:i.period,for_:i.for_,from:i.from,to:i.to,deviceToken:i.devicetoken,lat:i.lat,lng:i.lng,distance:i.distance},Alloy.Collections.homeDeals.reset(),C=!1,Alloy.Globals.notify=i,Ti.App.Properties.setObject("notify",Alloy.Globals.notify)},error:function(e,t){Ti.API.info(t.status),k.closeIndicator()}})})}function u(e){e.source.backgroundColor=Alloy.Globals.Styles.buttonBgOnTap}function y(e){switch(k.openIndicator(),e.source.backgroundColor=Alloy.Globals.Styles.buttonBg,e.source.id){case"update":p();break;case"cancel":l()}}function p(){return Ti.Network.online?(k.closeIndicator(),void c()):(k.closeIndicator(),void Alloy.Globals.core.showErrorDialog(L("network_off_line")))}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="notifications/index",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var w=this,b={},g={};w.__views.window=Ti.UI.createWindow({backgroundImage:Alloy.Globals.Styles.backgroundImage,layout:"absolute",id:"window",fullscreen:"true",titleid:"notifications",height:Ti.UI.FILL}),w.__views.window&&w.addTopLevelView(w.__views.window),e?w.__views.window.addEventListener("click",e):g["$.__views.window!click!blur"]=!0,w.__views.__alloyId282=Ti.UI.createScrollView({layout:"vertical",left:"20dp",right:"20dp",top:"0",id:"__alloyId282"}),w.__views.window.add(w.__views.__alloyId282),w.__views.__alloyId283=Ti.UI.createLabel({height:"80dp",width:Ti.UI.FILL,textAlign:"center",color:Alloy.Globals.Styles.titleColor,font:{fontSize:"25dp",fontFamily:"OleoScriptSwashCaps-Regular"},textid:"notifications",id:"__alloyId283"}),w.__views.__alloyId282.add(w.__views.__alloyId283),w.__views.categoriesLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"categoriesLbl",textid:"categories"}),w.__views.__alloyId282.add(w.__views.categoriesLbl),w.__views.categories=Ti.UI.createView({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,textAlign:"left",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"categories"}),w.__views.__alloyId282.add(w.__views.categories),i?w.__views.categories.addEventListener("click",i):g["$.__views.categories!click!clickCategories"]=!0,w.__views.__alloyId284=Ti.UI.createLabel({width:Ti.UI.SIZE,left:"5dp",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:"15dp",fontFamily:"Arial"},textid:"select_category",id:"__alloyId284"}),w.__views.categories.add(w.__views.__alloyId284),w.__views.selectedCategories=Ti.UI.createLabel({height:"20dp",left:"52dp",right:"15dp",top:"7dp",color:"#aaa",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:"12dp",fontFamily:"Arial"},id:"selectedCategories"}),w.__views.categories.add(w.__views.selectedCategories),w.__views.__alloyId285=Ti.UI.createLabel({width:"20dp",height:"20dp",right:"5dp",top:"5dp",backgroundImage:"images/icon_listItem.png",backgroundRepeat:!1,id:"__alloyId285"}),w.__views.categories.add(w.__views.__alloyId285),w.__views.periodLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"periodLbl",textid:"period"}),w.__views.__alloyId282.add(w.__views.periodLbl),w.__views.period=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"period",enabled:"false",value:L("_15_min")}),w.__views.__alloyId282.add(w.__views.period),s?w.__views.period.addEventListener("click",s):g["$.__views.period!click!clickPeriod"]=!0,w.__views.forLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"forLbl",textid:"for_"}),w.__views.__alloyId282.add(w.__views.forLbl),w.__views.for_=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"for_",enabled:"false",value:L("new_deals")}),w.__views.__alloyId282.add(w.__views.for_),r?w.__views.for_.addEventListener("click",r):g["$.__views.for_!click!clickFor"]=!0,w.__views.hoursLbl=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},id:"hoursLbl",textid:"hours_start"}),w.__views.__alloyId282.add(w.__views.hoursLbl),w.__views.start=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"start",enabled:"false",value:"00:00"}),w.__views.__alloyId282.add(w.__views.start),n?w.__views.start.addEventListener("click",n):g["$.__views.start!click!clickStart"]=!0,w.__views.__alloyId286=Ti.UI.createLabel({width:Alloy.Globals.Styles.labelWidth,height:Alloy.Globals.Styles.labelHeight,color:Alloy.Globals.Styles.labelColor,left:Alloy.Globals.Styles.labelLeft,right:Alloy.Globals.Styles.labelRight,textAlign:Alloy.Globals.Styles.labelTextAlign,font:{fontSize:"17dp",fontFamily:"Avenir Next Condensed"},textid:"hours_finish",id:"__alloyId286"}),w.__views.__alloyId282.add(w.__views.__alloyId286),w.__views.end=Ti.UI.createTextField({width:Alloy.Globals.Styles.inputWidth,height:Alloy.Globals.Styles.inputHeight,top:Alloy.Globals.Styles.inputUp,bottom:"10dp",left:Alloy.Globals.Styles.inputLeft,borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",textAlign:Alloy.Globals.Styles.inputTextAlign,font:{fontSize:"15dp",fontFamily:"Arial"},backgroundColor:"#fff",color:Alloy.Globals.Styles.inputColor,id:"end",enabled:"false",value:"00:00"}),w.__views.__alloyId282.add(w.__views.end),d?w.__views.end.addEventListener("click",d):g["$.__views.end!click!clickEnd"]=!0,w.__views.scrollView=Ti.UI.createScrollView({layout:"horizontal",width:"280dp",height:Alloy.Globals.Styles.inputHeight,top:"10dp",bottom:"20dp",left:"0dp",borderColor:"#ccc",borderStyle:1,borderWidth:"1dp",backgroundColor:"#fff",backgroundImage:"images/icon_horizontalPicker.png",id:"scrollView",borderRadius:"10dp"}),w.__views.__alloyId282.add(w.__views.scrollView),w.__views.__alloyId287=Ti.UI.createView({width:"50dp",height:"30dp",distance:"0",id:"__alloyId287"}),w.__views.scrollView.add(w.__views.__alloyId287),w.__views.__alloyId288=Ti.UI.createView({width:"65dp",height:"30dp",distance:"0",id:"__alloyId288"}),w.__views.scrollView.add(w.__views.__alloyId288),w.__views.__alloyId289=Ti.UI.createLabel({color:Alloy.Globals.Styles.titleColor,font:{fontSize:"15dp",fontFamily:"OleoScriptSwashCaps-Regular"},textid:"distance_wheel",id:"__alloyId289"}),w.__views.__alloyId288.add(w.__views.__alloyId289),w.__views.__alloyId290=Ti.UI.createView({width:"65dp",height:"30dp",distance:"100",id:"__alloyId290"}),w.__views.scrollView.add(w.__views.__alloyId290),w.__views.__alloyId291=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"100 m",id:"__alloyId291"}),w.__views.__alloyId290.add(w.__views.__alloyId291),w.__views.__alloyId292=Ti.UI.createView({width:"65dp",height:"30dp",distance:"250",id:"__alloyId292"}),w.__views.scrollView.add(w.__views.__alloyId292),w.__views.__alloyId293=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"250 m",id:"__alloyId293"}),w.__views.__alloyId292.add(w.__views.__alloyId293),w.__views.__alloyId294=Ti.UI.createView({width:"65dp",height:"30dp",distance:"500",id:"__alloyId294"}),w.__views.scrollView.add(w.__views.__alloyId294),w.__views.__alloyId295=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"500 m",id:"__alloyId295"}),w.__views.__alloyId294.add(w.__views.__alloyId295),w.__views.__alloyId296=Ti.UI.createView({width:"65dp",height:"30dp",distance:"750",id:"__alloyId296"}),w.__views.scrollView.add(w.__views.__alloyId296),w.__views.__alloyId297=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"750 m",id:"__alloyId297"}),w.__views.__alloyId296.add(w.__views.__alloyId297),w.__views.__alloyId298=Ti.UI.createView({width:"65dp",height:"30dp",distance:"1000",id:"__alloyId298"}),w.__views.scrollView.add(w.__views.__alloyId298),w.__views.__alloyId299=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"1000 m",id:"__alloyId299"}),w.__views.__alloyId298.add(w.__views.__alloyId299),w.__views.__alloyId300=Ti.UI.createView({width:"65dp",height:"30dp",distance:"2000",id:"__alloyId300"}),w.__views.scrollView.add(w.__views.__alloyId300),w.__views.__alloyId301=Ti.UI.createLabel({height:Alloy.Globals.Styles.inputHeight,textAlign:"center",color:"#000",font:{fontFamily:"Avenir Next Condensed",fontSize:"15dp"},text:"2000 m",id:"__alloyId301"}),w.__views.__alloyId300.add(w.__views.__alloyId301),w.__views.__alloyId302=Ti.UI.createView({width:"65dp",height:"30dp",distance:"0",id:"__alloyId302"}),w.__views.scrollView.add(w.__views.__alloyId302),w.__views.__alloyId303=Ti.UI.createLabel({color:Alloy.Globals.Styles.titleColor,font:{fontSize:"15dp",fontFamily:"OleoScriptSwashCaps-Regular"},textid:"distance_wheel",id:"__alloyId303"}),w.__views.__alloyId302.add(w.__views.__alloyId303),w.__views.__alloyId304=Ti.UI.createView({width:"37dp",height:"30dp",distance:"0",id:"__alloyId304"}),w.__views.scrollView.add(w.__views.__alloyId304),w.__views.update=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,titleid:"update",id:"update"}),w.__views.__alloyId282.add(w.__views.update),u?w.__views.update.addEventListener("touchstart",u):g["$.__views.update!touchstart!buttonTouchStart"]=!0,y?w.__views.update.addEventListener("touchend",y):g["$.__views.update!touchend!buttonTouchEnd"]=!0,w.__views.cancel=Ti.UI.createButton({width:"120dp",height:"40dp",bottom:"20dp",style:Titanium.UI.iPhone.SystemButtonStyle.PLAIN,font:{fontFamily:"Avenir Next Condensed",fontSize:"20dp"},color:"#fff",textAlign:"center",verticalAlign:"center",backgroundColor:Alloy.Globals.Styles.buttonBg,titleid:"cancel",id:"cancel"}),w.__views.__alloyId282.add(w.__views.cancel),u?w.__views.cancel.addEventListener("touchstart",u):g["$.__views.cancel!touchstart!buttonTouchStart"]=!0,y?w.__views.cancel.addEventListener("touchend",y):g["$.__views.cancel!touchend!buttonTouchEnd"]=!0,w.__views.pickerWrap=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,bottom:"0",id:"pickerWrap"}),w.__views.window.add(w.__views.pickerWrap),b.destroy=function(){},_.extend(w,w.__views);var v=Alloy.Globals.core,h=[],f=240,m=1,A=0,I=0,S=500,T=[{title:L("new_deals"),data:{id:1}},{title:L("all_deals"),data:{id:2}}],G=[{title:L("_1_hour"),data:{id:60}},{title:L("_2_hour"),data:{id:120}},{title:L("_3_hour"),data:{id:180}},{title:L("_4_hour"),data:{id:240}},{title:L("_5_hour"),data:{id:300}}],x="notifications",C=!1,k=Alloy.Globals.indicator;Ti.App.addEventListener("notify:notifyload",function(){l()}),Ti.App.addEventListener("notify:newnotify",function(){t()});var E=!1;"Simulator"==Ti.Platform.model&&(Alloy.CFG.deviceToken="fake_device_ token"),w.scrollView.addEventListener("scroll",function(e){S=e.x>=325?2e3:e.x>=260?1e3:e.x>=195?750:e.x>=130?500:e.x>=65?250:100});var U=3,N=0,V=!1,F=!1,k=Alloy.Globals.indicator;g["$.__views.window!click!blur"]&&w.__views.window.addEventListener("click",e),g["$.__views.categories!click!clickCategories"]&&w.__views.categories.addEventListener("click",i),g["$.__views.period!click!clickPeriod"]&&w.__views.period.addEventListener("click",s),g["$.__views.for_!click!clickFor"]&&w.__views.for_.addEventListener("click",r),g["$.__views.start!click!clickStart"]&&w.__views.start.addEventListener("click",n),g["$.__views.end!click!clickEnd"]&&w.__views.end.addEventListener("click",d),g["$.__views.update!touchstart!buttonTouchStart"]&&w.__views.update.addEventListener("touchstart",u),g["$.__views.update!touchend!buttonTouchEnd"]&&w.__views.update.addEventListener("touchend",y),g["$.__views.cancel!touchstart!buttonTouchStart"]&&w.__views.cancel.addEventListener("touchstart",u),g["$.__views.cancel!touchend!buttonTouchEnd"]&&w.__views.cancel.addEventListener("touchend",y),_.extend(w,b)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;