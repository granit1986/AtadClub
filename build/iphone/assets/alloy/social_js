function hex_sha1(e){return binb2hex(core_sha1(str2binb(e),e.length*chrsz))}function b64_sha1(e){return binb2b64(core_sha1(str2binb(e),e.length*chrsz))}function str_sha1(e){return binb2str(core_sha1(str2binb(e),e.length*chrsz))}function hex_hmac_sha1(e,t){return binb2hex(core_hmac_sha1(e,t))}function b64_hmac_sha1(e,t){return binb2b64(core_hmac_sha1(e,t))}function str_hmac_sha1(e,t){return binb2str(core_hmac_sha1(e,t))}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc")}function core_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var n=Array(80),r=1732584193,a=-271733879,s=-1732584194,i=271733878,o=-1009589776,u=0;u<e.length;u+=16){for(var c=r,d=a,h=s,l=i,f=o,_=0;80>_;_++){n[_]=16>_?e[u+_]:rol(n[_-3]^n[_-8]^n[_-14]^n[_-16],1);var m=safe_add(safe_add(rol(r,5),sha1_ft(_,a,s,i)),safe_add(safe_add(o,n[_]),sha1_kt(_)));o=i,i=s,s=rol(a,30),a=r,r=m}r=safe_add(r,c),a=safe_add(a,d),s=safe_add(s,h),i=safe_add(i,l),o=safe_add(o,f)}return Array(r,a,s,i,o)}function sha1_ft(e,t,n,r){return 20>e?t&n|~t&r:40>e?t^n^r:60>e?t&n|t&r|n&r:t^n^r}function sha1_kt(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function core_hmac_sha1(e,t){var n=str2binb(e);n.length>16&&(n=core_sha1(n,e.length*chrsz));for(var r=Array(16),a=Array(16),s=0;16>s;s++)r[s]=909522486^n[s],a[s]=1549556828^n[s];var i=core_sha1(r.concat(str2binb(t)),512+t.length*chrsz);return core_sha1(a.concat(i),672)}function safe_add(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function rol(e,t){return e<<t|e>>>32-t}function str2binb(e){for(var t=Array(),n=(1<<chrsz)-1,r=0;r<e.length*chrsz;r+=chrsz)t[r>>5]|=(e.charCodeAt(r/chrsz)&n)<<32-chrsz-r%32;return t}function binb2str(e){for(var t="",n=(1<<chrsz)-1,r=0;r<32*e.length;r+=chrsz)t+=String.fromCharCode(e[r>>5]>>>32-chrsz-r%32&n);return t}function binb2hex(e){for(var t=hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>8*(3-r%4)+4&15)+t.charAt(e[r>>2]>>8*(3-r%4)&15);return n}function binb2b64(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=0;r<4*e.length;r+=3)for(var a=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,s=0;4>s;s++)n+=8*r+6*s>32*e.length?b64pad:t.charAt(a>>6*(3-s)&63);return n}var hexcase=0,b64pad="",chrsz=8,OAuth;null==OAuth&&(OAuth={}),OAuth.setProperties=function(e,t){if(null!=e&&null!=t)for(var n in t)e[n]=t[n];return e},OAuth.setProperties(OAuth,{percentEncode:function(e){if(null==e)return"";if(e instanceof Array){for(var t="",n=0;n<e.length;++e)""!=t&&(t+="&"),t+=OAuth.percentEncode(e[n]);return t}return e=encodeURIComponent(e),e=e.replace(/\!/g,"%21"),e=e.replace(/\*/g,"%2A"),e=e.replace(/\'/g,"%27"),e=e.replace(/\(/g,"%28"),e=e.replace(/\)/g,"%29")},decodePercent:function(e){return null!=e&&(e=e.replace(/\+/g," ")),decodeURIComponent(e)},getParameterList:function(e){if(null==e)return[];if("object"!=typeof e)return OAuth.decodeForm(e+"");if(e instanceof Array)return e;var t=[];for(var n in e)t.push([n,e[n]]);return t},getParameterMap:function(e){if(null==e)return{};if("object"!=typeof e)return OAuth.getParameterMap(OAuth.decodeForm(e+""));if(e instanceof Array){for(var t={},n=0;n<e.length;++n){var r=e[n][0];void 0===t[r]&&(t[r]=e[n][1])}return t}return e},getParameter:function(e,t){if(e instanceof Array){for(var n=0;n<e.length;++n)if(e[n][0]==t)return e[n][1];return null}return OAuth.getParameterMap(e)[t]},formEncode:function(e){for(var t="",n=OAuth.getParameterList(e),r=0;r<n.length;++r){var a=n[r][1];null==a&&(a=""),""!=t&&(t+="&"),t+=OAuth.percentEncode(n[r][0])+"="+OAuth.percentEncode(a)}return t},decodeForm:function(e){for(var t=[],n=e.split("&"),r=0;r<n.length;++r){var a=n[r];if(""!=a){var s,i,o=a.indexOf("=");0>o?(s=OAuth.decodePercent(a),i=null):(s=OAuth.decodePercent(a.substring(0,o)),i=OAuth.decodePercent(a.substring(o+1))),t.push([s,i])}}return t},setParameter:function(e,t,n){var r=e.parameters;if(r instanceof Array){for(var a=0;a<r.length;++a)r[a][0]==t&&(void 0===n?r.splice(a,1):(r[a][1]=n,n=void 0));void 0!==n&&r.push([t,n])}else r=OAuth.getParameterMap(r),r[t]=n,e.parameters=r},setParameters:function(e,t){for(var n=OAuth.getParameterList(t),r=0;r<n.length;++r)OAuth.setParameter(e,n[r][0],n[r][1])},completeRequest:function(e,t){null==e.method&&(e.method="GET");var n=OAuth.getParameterMap(e.parameters);null==n.oauth_consumer_key&&OAuth.setParameter(e,"oauth_consumer_key",t.consumerKey||""),null==n.oauth_token&&null!=t.token&&OAuth.setParameter(e,"oauth_token",t.token),null==n.oauth_version&&OAuth.setParameter(e,"oauth_version","1.0"),null==n.oauth_timestamp&&OAuth.setParameter(e,"oauth_timestamp",OAuth.timestamp()),null==n.oauth_nonce&&OAuth.setParameter(e,"oauth_nonce",OAuth.nonce(6)),OAuth.SignatureMethod.sign(e,t)},setTimestampAndNonce:function(e){OAuth.setParameter(e,"oauth_timestamp",OAuth.timestamp()),OAuth.setParameter(e,"oauth_nonce",OAuth.nonce(6))},addToURL:function(e,t){if(newURL=e,null!=t){var n=OAuth.formEncode(t);if(n.length>0){var r=e.indexOf("?");newURL+=0>r?"?":"&",newURL+=n}}return newURL},getAuthorizationHeader:function(e,t){for(var n='OAuth realm="'+OAuth.percentEncode(e)+'"',r=OAuth.getParameterList(t),a=0;a<r.length;++a){var s=r[a],i=s[0];0==i.indexOf("oauth_")&&(n+=","+OAuth.percentEncode(i)+'="'+OAuth.percentEncode(s[1])+'"')}return n},correctTimestampFromSrc:function(e){e=e||"oauth_timestamp";var t=document.getElementsByTagName("script");if(null!=t&&t.length){var n=t[t.length-1].src;if(n){var r=n.indexOf("?");if(!(0>r)){parameters=OAuth.getParameterMap(OAuth.decodeForm(n.substring(r+1)));var a=parameters[e];null!=a&&OAuth.correctTimestamp(a)}}}},correctTimestamp:function(e){OAuth.timeCorrectionMsec=1e3*e-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var e=(new Date).getTime()+OAuth.timeCorrectionMsec;return""+Math.floor(e/1e3)},nonce:function(e){for(var t=OAuth.nonce.CHARS,n="",r=0;e>r;++r){var a=Math.floor(Math.random()*t.length);n+=t.substring(a,a+1)}return n}}),OAuth.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",OAuth.declareClass=function(e,t,n){var r=e[t];if(e[t]=n,null!=n&&null!=r)for(var a in r)"prototype"!=a&&(n[a]=r[a]);return n},OAuth.declareClass(OAuth,"SignatureMethod",function(){}),OAuth.setProperties(OAuth.SignatureMethod.prototype,{sign:function(e){var t=OAuth.SignatureMethod.getBaseString(e),n=this.getSignature(t);return OAuth.setParameter(e,"oauth_signature",n),n},initialize:function(e,t){var n;n=null!=t.accessorSecret&&e.length>9&&"-Accessor"==e.substring(e.length-9)?t.accessorSecret:t.consumerSecret,this.key=OAuth.percentEncode(n)+"&"+OAuth.percentEncode(t.tokenSecret)}}),OAuth.setProperties(OAuth.SignatureMethod,{sign:function(e,t){var n=OAuth.getParameterMap(e.parameters).oauth_signature_method;(null==n||""==n)&&(n="HMAC-SHA1",OAuth.setParameter(e,"oauth_signature_method",n)),OAuth.SignatureMethod.newMethod(n,t).sign(e)},newMethod:function(e,t){var n=OAuth.SignatureMethod.REGISTERED[e];if(null!=n){var r=new n;return r.initialize(e,t),r}var a=new Error("signature_method_rejected"),s="";for(var i in OAuth.SignatureMethod.REGISTERED)""!=s&&(s+="&"),s+=OAuth.percentEncode(i);throw a.oauth_acceptable_signature_methods=s,a},REGISTERED:{},registerMethodClass:function(e,t){for(var n=0;n<e.length;++n)OAuth.SignatureMethod.REGISTERED[e[n]]=t},makeSubclass:function(e){var t=OAuth.SignatureMethod,n=function(){t.call(this)};return n.prototype=new t,n.prototype.getSignature=e,n.prototype.constructor=n,n},getBaseString:function(e){var t,n=e.action,r=n.indexOf("?");if(0>r)t=e.parameters;else{t=OAuth.decodeForm(n.substring(r+1));for(var a=OAuth.getParameterList(e.parameters),s=0;s<a.length;++s)t.push(a[s])}return OAuth.percentEncode(e.method.toUpperCase())+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeUrl(n))+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeParameters(t))},normalizeUrl:function(e){var t=OAuth.SignatureMethod.parseUri(e),n=t.protocol.toLowerCase(),r=t.authority.toLowerCase(),a="http"==n&&80==t.port||"https"==n&&443==t.port;if(a){var s=r.lastIndexOf(":");s>=0&&(r=r.substring(0,s))}var i=t.path;return i||(i="/"),n+"://"+r+i},parseUri:function(e){for(var t={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=t.parser.strict.exec(e),r={},a=14;a--;)r[t.key[a]]=n[a]||"";return r},normalizeParameters:function(e){if(null==e)return"";for(var t=OAuth.getParameterList(e),n=[],r=0;r<t.length;++r){var a=t[r];"oauth_signature"!=a[0]&&n.push([OAuth.percentEncode(a[0])+" "+OAuth.percentEncode(a[1]),a])}n.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0});for(var s=[],i=0;i<n.length;++i)s.push(n[i][1]);return OAuth.formEncode(s)}}),OAuth.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],OAuth.SignatureMethod.makeSubclass(function(){return this.key})),OAuth.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],OAuth.SignatureMethod.makeSubclass(function(e){b64pad="=";var t=b64_hmac_sha1(this.key,e);return t}));try{OAuth.correctTimestampFromSrc()}catch(e){}var OAuthAdapter=function(e,t,n){function r(){b||(b=!0,M&&(M.value=0),w=S?"tokenRequest":"pageLoad",O[w]||(O[w]=S?2e3:1e3),S=!1,k=(new Date).getTime(),L=setInterval(a,30),y&&y.hide(),M&&M.show(),T&&T.show())}function a(){M&&(M.value=((new Date).getTime()-k)/O[w])}function s(e){var t=e.source.evalJS('(p = document.getElementById("oauth_pin")) && p.innerHTML;');t?(c=t.split("<code>")[1].split("</code>")[0],D(),v()):(M&&M.hide(),T&&T.hide(),y&&y.show()),b=!1,clearInterval(L),O[w]=(new Date).getTime()-k,Ti.App.Properties.setString("Social-LoadingEstimates",JSON.stringify(O))}var i=e,o=t,u=n,c=null,d=null,h=null,l=null,f=null,_={consumerSecret:i,tokenSecret:""},m=null,g=null,y=null,M=null,T=null,v=null,A={};this.loadAccessToken=function(e){var t;if(A[e])t=A[e];else{var n=Ti.App.Properties.getString("Social.js-AccessToken-"+e,"");if(!n)return;try{t=A[e]=JSON.parse(n)}catch(r){return Ti.API.error("Failed to parse stored access token for "+e+"!"),void Ti.API.error(r)}}t.accessToken&&(l=t.accessToken),t.accessTokenSecret&&(f=t.accessTokenSecret)},this.saveAccessToken=function(e){A[e]={accessToken:l,accessTokenSecret:f},Ti.App.Properties.setString("Social.js-AccessToken-"+e,JSON.stringify(A[e]))},this.clearAccessToken=function(e){delete A[e],Ti.App.Properties.setString("Social.js-AccessToken-"+e,null),l=null,f=null},this.isAuthorized=function(){return null!=l&&null!=f};var Y=function(e){var t={action:e,method:"POST",parameters:[]};return t.parameters.push(["oauth_consumer_key",o]),t.parameters.push(["oauth_signature_method",u]),t};this.getPin=function(){return c},this.getRequestToken=function(e,t){_.tokenSecret="";var n=Y(e);OAuth.setTimestampAndNonce(n),OAuth.SignatureMethod.sign(n,_);var r=!1,a=Ti.Network.createHTTPClient({onload:function(){var e=OAuth.getParameterMap(this.responseText);d=e.oauth_token,h=e.oauth_token_secret,t({success:!0,token:this.responseText}),r=!0},onerror:function(){Ti.API.error("Social.js: FAILED to getRequestToken!"),Ti.API.error(this.responseText),t({success:!1}),r=!0}});a.open("POST",e),a.send(OAuth.getParameterMap(n.parameters))};var w,k,D=function(){if(null!=m)try{y.removeEventListener("load",s),y.removeEventListener("beforeload",r),M.hide(),m.close(),b=null,y=null,M=null,b=!1,S=!0,g=null,m=null}catch(e){Ti.API.debug("Cannot destroy the authorize UI. Ignoring.")}},S=!0,b=!1,O=JSON.parse(Ti.App.Properties.getString("Social-LoadingEstimates","{}")),L=0;this.showLoadingUI=function(){var e=require("alloy/animation"),t=parseInt(Ti.Platform.version,10)>6?!0:!1;m=Ti.UI.createWindow({backgroundColor:"transparent",zIndex:1e3,opacity:0,navBarHidden:!0}),g=Ti.UI.createView({top:t?"30dp":"10dp",right:"10dp",bottom:"10dp",left:"10dp",backgroundColor:"#52D3FE",border:10,borderColor:"#52D3FE",borderRadius:10,borderWidth:4,zIndex:-1});var n=Ti.UI.createView({top:t?"20dp":"0dp",right:0,height:"30dp",width:"32dp"}),a=Ti.UI.createButton({font:{fontSize:"12sp",fontWeight:"bold"},backgroundColor:"#52D3FE",borderColor:"#52D3FE",color:"#fff",style:0,borderRadius:6,title:"X",top:"3dp",right:"3dp",width:"25dp",height:"25dp"});n.addEventListener("click",D),m.open(),T=Ti.UI.createView({backgroundColor:"#fff"}),M=Ti.UI.createProgressBar({min:0,max:1,value:.5,message:"Loading, please wait.",backgroundColor:"#fff",font:{fontSize:"14sp",fontWeight:"bold"},style:0}),g.add(T),T.add(M),M.show(),n.add(a),m.add(g),m.add(n),e.popIn(m),r()},this.showAuthorizeUI=function(e,t){v=t,y=Ti.UI.createWebView({url:e,autoDetect:[Ti.UI.AUTODETECT_NONE]}),y.addEventListener("beforeload",r),y.addEventListener("load",s),g.add(y)},this.getAccessToken=function(e,t){_.tokenSecret=h;var n=Y(e);n.parameters.push(["oauth_token",d]),n.parameters.push(["oauth_verifier",c]),OAuth.setTimestampAndNonce(n),OAuth.SignatureMethod.sign(n,_);var r=OAuth.getParameterMap(n.parameters),a=Ti.Network.createHTTPClient({onload:function(){var e=OAuth.getParameterMap(this.responseText),n=e.user_id,r=e.screen_name;l=e.oauth_token,f=e.oauth_token_secret,t({success:!0,username:r,userid:n})},onerror:function(){Ti.API.error("Social.js: FAILED to getAccessToken!"),Ti.API.error(this.responseText),t({success:!1})}});a.open("POST",e),a.send(r)},this.send=function(e){var t=e.url,n=e.parameters,r=(e.title,e.onSuccess),a=e.onError;if(null==l||null==f)return void Ti.API.debug("The send status cannot be processed as the client doesn't have an access token. Authorize before trying to send.");_.tokenSecret=f;var s=Y(t);s.parameters.push(["oauth_token",l]);for(p in n)s.parameters.push(n[p]);OAuth.setTimestampAndNonce(s),OAuth.SignatureMethod.sign(s,_);var i=OAuth.getParameterMap(s.parameters),o=Ti.Network.createHTTPClient({onload:function(){200==o.status?r&&r(this.responseText):a&&a(this.responseText)},onerror:function(){Ti.API.error("Social.js: FAILED to send a request!"),a&&a(this.responseText)}});o.open("POST",t),o.send(i)}},supportedSites={twitter:{accessToken:"https://api.twitter.com/oauth/access_token",requestToken:"https://api.twitter.com/oauth/request_token",authorize:"https://api.twitter.com/oauth/authorize?",update:"https://api.twitter.com/1.1/statuses/update.json"}};exports.create=function(e){var t=(e.site||"twitter").toLowerCase(),n=new OAuthAdapter(e.consumerSecret,e.consumerKey,"HMAC-SHA1");n.loadAccessToken(t);var r=supportedSites[t];return null==r?(alert("The Social.js module does not support "+t+" yet!"),null):{isAuthorized:function(){return n.isAuthorized()},deauthorize:function(){n.clearAccessToken(t)},authorize:function(e){function a(){n.getAccessToken(r.accessToken,function(r){r.success?(n.saveAccessToken(t),e&&e({username:r.username,userid:r.userid})):alert("Twitter did not give us an access token!")})}n.isAuthorized()?e&&e():(n.showLoadingUI(),n.getRequestToken(r.requestToken,function(e){e.success?n.showAuthorizeUI(r.authorize+e.token,a):alert("Twitter did not give us a request token!")}))},share:function(e){this.authorize(function(){n.send({url:r.update,parameters:[["status",e.message]],title:"Twitter",onSuccess:e.success,onError:e.error})})}}};